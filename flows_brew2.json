[{"id":"cae39ee2.e2c898","type":"tab","label":"Temperatures","disabled":false,"info":"Temperature readings, triggered every 2 \nseconds (note that the PID algorith has this \nfrequency hard coded into it, and those \nfunctions will need to be modified if the \ntrigger frequency is changed). Also smoothing \nand formating for temperature display."},{"id":"28484198.eb083e","type":"tab","label":"Mash buttons","disabled":false,"info":"Buttons for mash control. These also display \nstate."},{"id":"4ef08725.8fbdd","type":"tab","label":"PID outputs","disabled":false,"info":"This flow displays output from the PID \nalgorithm. This can be useful for tuning \npurposes."},{"id":"cdc1c9a3.021f58","type":"tab","label":"Mash controller","disabled":false,"info":"Everything related to mash/RIMS PID control, in\naddition to interlock features to prevent RIMS\nuse when pump is inactive or when the boil \nelement is in use."},{"id":"70d4070b.e447b8","type":"tab","label":"Boil buttons","disabled":false,"info":"Buttons related to controlling the boil.\nThese buttons also display state."},{"id":"1e878673.29136a","type":"tab","label":"Boil controller","disabled":false,"info":"PID functionality, as well as an interlock \nscheme to prevent multiple elements from being\nused at one time."},{"id":"44130c7e.f0c1fc","type":"tab","label":"Element outputs","disabled":false,"info":"Routing to GPIO, as well as displays for element\noutput in duty %"},{"id":"2d8e58d.7555ca8","type":"tab","label":"Pump control","disabled":false,"info":"This flow provides a button to turn a pump on \nand off. The colour of the pump button reflects\nits status. The pump has one restriction in that \nit can not be turned off while RIMS is active.\nSuch attempts are blocked, with a notification\nprovided to the user."},{"id":"b764cb6a.5d4448","type":"tab","label":"UI navigation and style","disabled":false,"info":"This tab contains a collection of UI features.\n* CSS overide to ensure dashboard is only 1 or 2 columns\n* Centre \"group\" titles\n* Navigation buttons"},{"id":"364af11b.32788e","type":"tab","label":"Bolt indicators","disabled":false,"info":"* Bolts indicating element activity"},{"id":"e2318.a76b94e88","type":"tab","label":"Logging","disabled":false,"info":""},{"id":"63bf5070.3b5ef","type":"tab","label":"Mash Schedule","disabled":false,"info":""},{"id":"b2a662aa.2b752","type":"tab","label":"Volume","disabled":true,"info":"A pressure sensor is read by an analog input\nboard. The pressure reading is then converted\nto cmH20 and volume and displayed."},{"id":"9a84d01.8fdf3b","type":"tab","label":"Tap list","disabled":false,"info":""},{"id":"a61a257b.7ba4d","type":"tab","label":"Mash Schedule Erik","disabled":true,"info":""},{"id":"7fa64790.3f4f4","type":"ui_base","theme":{"name":"theme-custom","lightTheme":{"default":"#0094CE","baseColor":"#77bb40","baseFont":"Tahoma,Geneva,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#094779","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Green","default":"#4B7930","baseColor":"#669d34","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","reset":false},"themeState":{"base-color":{"default":"#32A359","value":"#669d34","edited":true},"page-titlebar-backgroundColor":{"value":"#669d34","edited":true},"page-backgroundColor":{"value":"#ffffff","edited":true},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#669d34","edited":true},"group-borderColor":{"value":"#ffffff","edited":true},"group-backgroundColor":{"value":"#ffffff","edited":true},"widget-textColor":{"value":"#111111","edited":true},"widget-backgroundColor":{"value":"#669d34","edited":true},"widget-borderColor":{"value":"#ffffff","edited":true},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"brew2","hideToolbar":"true","allowSwipe":"false","allowTempTheme":"false","dateFormat":"DD/MM/YYYY","sizes":{"sx":60,"sy":50,"gx":1,"gy":0,"cx":0,"cy":2,"px":1,"py":1},"lockMenu":"false"}},{"id":"bde8848e.1d357","type":"ui_tab","z":"","name":"Brew","icon":"","order":1,"disabled":false,"hidden":true},{"id":"f6e1ef23.f6f118","type":"ui_group","z":"","name":"MASH","tab":"bde8848e.1d357","order":1,"disp":false,"width":"6","collapse":false},{"id":"9fe30f36.92cc2","type":"ui_group","z":"","name":"BOIL","tab":"bde8848e.1d357","order":2,"disp":false,"width":"6","collapse":false},{"id":"f3e4e5c9.37f76","type":"ui_group","z":"","name":"BOIL SETTINGS","tab":"4adcb434.78650c","order":2,"disp":true,"width":"6","collapse":false},{"id":"321aaa6a.377d5e","type":"ui_group","z":"","name":"OUTER LOOP","tab":"f33d4d52.4eb478","order":1,"disp":true,"width":"6","collapse":false},{"id":"f33d4d52.4eb478","type":"ui_tab","z":"","name":"Mash Settings","icon":"","order":3,"disabled":false,"hidden":false},{"id":"4adcb434.78650c","type":"ui_tab","z":"","name":"Boil Settings","icon":"","order":4,"disabled":false,"hidden":true},{"id":"7311bc5c.585f8c","type":"ui_group","z":"","name":"BOTTOM","tab":"bde8848e.1d357","order":3,"disp":false,"width":"6","collapse":false},{"id":"63e15812.768e7","type":"influxdb","z":"","hostname":"localhost","port":"8086","protocol":"http","database":"brew2","name":"","usetls":false,"tls":""},{"id":"c8c78fe4.1dbea","type":"ui_tab","z":"","name":"General Settings","icon":"dashboard","order":5,"disabled":false,"hidden":true},{"id":"8d73628b.8b862","type":"ui_group","z":"","name":"LOGGING","tab":"c8c78fe4.1dbea","order":1,"disp":true,"width":"6","collapse":false},{"id":"3664e4b.5830a9c","type":"ui_group","z":"","name":"INNER LOOP","tab":"f33d4d52.4eb478","order":2,"disp":true,"width":"6","collapse":false},{"id":"b8742957.c17f98","type":"ui_tab","z":"","name":"Settings","icon":"dashboard","order":2,"disabled":false,"hidden":false},{"id":"cafd8af.6569df8","type":"ui_group","z":"","name":"SETTINGS","tab":"b8742957.c17f98","order":1,"disp":true,"width":"6","collapse":false},{"id":"44727e58.1ef0a","type":"ui_spacer","name":"spacer","group":"cafd8af.6569df8","order":5,"width":"6","height":1},{"id":"d950fab6.61d3c8","type":"ui_spacer","name":"spacer","group":"10ebbb77.a2d955","order":1,"width":"7","height":1},{"id":"6596f4fa.8b2834","type":"ui_spacer","name":"spacer","group":"f3e4e5c9.37f76","order":10,"width":"6","height":1},{"id":"548241a6.996af","type":"ui_tab","z":"","name":"Mash Schedule","icon":"dashboard","order":6,"disabled":false,"hidden":false},{"id":"e069eb40.1f1bf8","type":"ui_group","z":"","name":"MASH SCHEDULE","tab":"548241a6.996af","order":1,"disp":true,"width":"7","collapse":false},{"id":"1179e97f.bc9af7","type":"ui_group","z":"","name":"Rest1","tab":"548241a6.996af","order":5,"disp":false,"width":"7","collapse":false},{"id":"90c79ee1.d905d","type":"ui_group","z":"","name":"Rest2","tab":"548241a6.996af","order":6,"disp":false,"width":"7","collapse":false},{"id":"9dc5814c.bca5a8","type":"ui_group","z":"","name":"Rest3","tab":"548241a6.996af","order":7,"disp":false,"width":"7","collapse":false},{"id":"f84fb672.0531a","type":"ui_group","z":"","name":"Rest4","tab":"548241a6.996af","order":8,"disp":false,"width":"7","collapse":false},{"id":"906481c9.a63c5","type":"ui_group","z":"","name":"Bottom","tab":"548241a6.996af","order":18,"disp":false,"width":"7","collapse":false},{"id":"252bb944.ff43b6","type":"ui_group","z":"","name":"Control1","tab":"548241a6.996af","order":3,"disp":false,"width":"7","collapse":false},{"id":"172eb1b5.c3e3ee","type":"ui_group","z":"","name":"Control2","tab":"548241a6.996af","order":4,"disp":false,"width":"7","collapse":false},{"id":"ad953891.db7388","type":"ui_spacer","name":"spacer","group":"252bb944.ff43b6","order":1,"width":1,"height":1},{"id":"6163cae5.3e12e4","type":"ui_spacer","name":"spacer","group":"252bb944.ff43b6","order":3,"width":1,"height":1},{"id":"c19be58a.0f388","type":"ui_spacer","name":"spacer","group":"","order":1,"width":1,"height":1},{"id":"658b2796.c2ef38","type":"ui_spacer","name":"spacer","group":"","order":3,"width":1,"height":1},{"id":"d360e2ce.52a2e","type":"ui_group","z":"","name":"Control3","tab":"548241a6.996af","order":17,"disp":false,"width":"7","collapse":false},{"id":"f7a33371.a7eca","type":"ui_spacer","name":"spacer","group":"d360e2ce.52a2e","order":1,"width":1,"height":1},{"id":"b59f33cb.d3fc08","type":"ui_spacer","name":"spacer","group":"d360e2ce.52a2e","order":3,"width":1,"height":1},{"id":"43d5cbaa.89bee4","type":"ui_spacer","name":"spacer","group":"906481c9.a63c5","order":1,"width":1,"height":1},{"id":"fd56c931.a0f7c8","type":"ui_spacer","name":"spacer","group":"906481c9.a63c5","order":3,"width":1,"height":1},{"id":"beea0165.6e28f8","type":"ui_group","z":"","name":"Control4","tab":"548241a6.996af","order":16,"disp":false,"width":"7","collapse":false},{"id":"856ac1c.2d87cc","type":"ui_spacer","name":"spacer","group":"e069eb40.1f1bf8","order":1,"width":1,"height":1},{"id":"81e6038c.004538","type":"ui_spacer","name":"spacer","group":"e069eb40.1f1bf8","order":3,"width":1,"height":1},{"id":"29628e25.36ae0a","type":"ui_group","z":"","name":"MASH SCHEDULE2","tab":"548241a6.996af","order":9,"disp":false,"width":"7","collapse":false},{"id":"b76f307e.2dd36","type":"ui_spacer","name":"spacer","group":"29628e25.36ae0a","order":1,"width":1,"height":1},{"id":"54695f19.a72ce","type":"ui_spacer","name":"spacer","group":"29628e25.36ae0a","order":3,"width":1,"height":1},{"id":"5b29068c.7d2828","type":"ui_group","z":"","name":"Control1b","tab":"548241a6.996af","order":10,"disp":true,"width":"7","collapse":false},{"id":"b5fb2432.934c6","type":"ui_group","z":"","name":"Control2b","tab":"548241a6.996af","order":11,"disp":true,"width":"7","collapse":false},{"id":"15398f9f.83813","type":"ui_group","z":"","name":"Rest1b","tab":"548241a6.996af","order":12,"disp":false,"width":"7","collapse":false},{"id":"410f13bb.574dec","type":"ui_group","z":"","name":"Rest2b","tab":"548241a6.996af","order":13,"disp":false,"width":"7","collapse":false},{"id":"7bfe7533.f2722c","type":"ui_group","z":"","name":"Rest3b","tab":"548241a6.996af","order":14,"disp":false,"width":"7","collapse":false},{"id":"9ba87c4a.b57c6","type":"ui_group","z":"","name":"Rest4b","tab":"548241a6.996af","order":15,"disp":false,"width":"7","collapse":false},{"id":"83f17780.f786e8","type":"ui_group","z":"","name":"Control0","tab":"548241a6.996af","order":2,"disp":false,"width":"7","collapse":false},{"id":"2802b2da.5888fe","type":"ui_spacer","name":"spacer","group":"15398f9f.83813","order":1,"width":1,"height":1},{"id":"e433e988.07384","type":"ui_spacer","name":"spacer","group":"410f13bb.574dec","order":1,"width":1,"height":1},{"id":"624e9891.cbefa","type":"ui_spacer","name":"spacer","group":"7bfe7533.f2722c","order":1,"width":1,"height":1},{"id":"c099a37a.77611","type":"ui_spacer","name":"spacer","group":"9ba87c4a.b57c6","order":1,"width":1,"height":1},{"id":"620587b.7d6e278","type":"ui_spacer","name":"spacer","group":"15398f9f.83813","order":3,"width":1,"height":1},{"id":"e3457c5a.de99b","type":"ui_spacer","name":"spacer","group":"410f13bb.574dec","order":3,"width":1,"height":1},{"id":"638246e0.5c8ab","type":"ui_spacer","name":"spacer","group":"7bfe7533.f2722c","order":3,"width":1,"height":1},{"id":"31ec1026.4a60b","type":"ui_spacer","name":"spacer","group":"9ba87c4a.b57c6","order":3,"width":1,"height":1},{"id":"8a84c26b.ba2ef","type":"ui_group","name":"Group 19","tab":"548241a6.996af","order":19,"disp":true,"width":6},{"id":"8abb88e3.0fb52","type":"ui_spacer","name":"spacer","group":"83f17780.f786e8","order":1,"width":1,"height":1},{"id":"b579ecaf.f22628","type":"ui_spacer","name":"spacer","group":"83f17780.f786e8","order":3,"width":1,"height":1},{"id":"bb44269d.2df1a","type":"ui_tab","z":"","name":"Tap List","icon":"dashboard","order":7,"disabled":false,"hidden":false},{"id":"cd0d2150.b06378","type":"ui_group","z":"","name":"Left taps","tab":"bb44269d.2df1a","order":1,"disp":false,"width":"6","collapse":false},{"id":"24e45ac3.c18436","type":"ui_group","z":"","name":"Bottom","tab":"bb44269d.2df1a","order":5,"disp":false,"width":"6","collapse":false},{"id":"23a56f9a.194898","type":"ui_group","z":"","name":"Right taps","tab":"bb44269d.2df1a","order":3,"disp":false,"width":"6","collapse":false},{"id":"7afb5092.447728","type":"ui_group","z":"","name":"REMOTE DISPLAY","tab":"c8c78fe4.1dbea","order":2,"disp":true,"width":"6","collapse":false},{"id":"10ebbb77.a2d955","type":"ui_group","z":"","name":"BOTTOM","tab":"c8c78fe4.1dbea","order":3,"disp":false,"width":"6","collapse":false},{"id":"899e3587.a3ad4","type":"ui_spacer","name":"spacer","group":"cd0d2150.b06378","order":3,"width":"6","height":1},{"id":"800695e9.9cacc8","type":"ui_spacer","name":"spacer","group":"23a56f9a.194898","order":3,"width":"6","height":1},{"id":"6c6390f5.e3c7a8","type":"ui_spacer","name":"spacer","group":"24e45ac3.c18436","order":1,"width":"6","height":1},{"id":"251416bf.2d8d1a","type":"ui_group","z":"","name":"Strike","tab":"548241a6.996af","order":5,"disp":false,"width":7,"collapse":false},{"id":"c1e75384.e3fe88","type":"ui_group","z":"","name":"NextStep","tab":"548241a6.996af","order":19,"disp":false,"width":7,"collapse":false},{"id":"bb7be4a7.22f658","type":"ui_spacer","name":"spacer","group":"321aaa6a.377d5e","order":11,"width":1,"height":1},{"id":"6dd54734.d9b6f","type":"ui_spacer","name":"spacer","group":"321aaa6a.377d5e","order":13,"width":1,"height":1},{"id":"44209088.806eb","type":"ui_spacer","name":"spacer","group":"3664e4b.5830a9c","order":11,"width":6,"height":1},{"id":"8be32ec8.c5e058","type":"ui_spacer","name":"spacer","group":"f6e1ef23.f6f118","order":4,"width":1,"height":1},{"id":"146d646b.c2428c","type":"ui_spacer","name":"spacer","group":"f6e1ef23.f6f118","order":6,"width":1,"height":1},{"id":"dde486f1.c0a87","type":"ui_spacer","name":"spacer","group":"f6e1ef23.f6f118","order":9,"width":1,"height":1},{"id":"c7a3f5a2.002678","type":"ui_spacer","name":"spacer","group":"f6e1ef23.f6f118","order":10,"width":6,"height":1},{"id":"5fd06e0f.e0796","type":"ui_spacer","name":"spacer","group":"9fe30f36.92cc2","order":4,"width":1,"height":1},{"id":"c832c2d9.b8fe48","type":"ui_spacer","name":"spacer","group":"9fe30f36.92cc2","order":6,"width":1,"height":1},{"id":"d4cd13d.a5539f","type":"ui_spacer","name":"spacer","group":"9fe30f36.92cc2","order":9,"width":1,"height":1},{"id":"6d60268.dec5958","type":"ui_spacer","name":"spacer","group":"9fe30f36.92cc2","order":10,"width":6,"height":1},{"id":"6659a7c2.92285","type":"ui_spacer","name":"spacer","group":"7311bc5c.585f8c","order":1,"width":1,"height":1},{"id":"c99962bf.7e0af","type":"ui_spacer","name":"spacer","group":"7311bc5c.585f8c","order":3,"width":1,"height":1},{"id":"ba5b776f.cbd1c8","type":"smooth","z":"cae39ee2.e2c898","name":"","property":"payload","action":"mean","count":"5","round":"1","mult":"single","reduce":false,"x":720,"y":220,"wires":[["a75098b.40979e8"]]},{"id":"a4e3eea3.f3eb5","type":"range","z":"b2a662aa.2b752","minin":"0","maxin":"4096","minout":"0","maxout":"61.2","action":"scale","round":false,"property":"payload","name":"cmH₂O","x":180,"y":100,"wires":[["d9cde29d.b507b8"]]},{"id":"d9cde29d.b507b8","type":"smooth","z":"b2a662aa.2b752","name":"","property":"payload","action":"mean","count":"5","round":"2","mult":"single","x":220,"y":140,"wires":[["19f82bf2.0c68e4"]]},{"id":"25e729a4.95b7fe","type":"function","z":"b2a662aa.2b752","name":"Volume conversion","func":"msg.payload = 1.89 + (msg.payload * 21.5 * 21.5 * 3.141526 / 1000);\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":220,"wires":[["303cf1e8.cf7276"]]},{"id":"9bc8c2a5.7262b8","type":"ui_text","z":"b2a662aa.2b752","group":"f6e1ef23.f6f118","order":11,"width":3,"height":1,"name":"Mash volume display","label":"Volume","format":"{{msg.payload}}l H₂O","layout":"col-center","x":420,"y":300,"wires":[]},{"id":"19f82bf2.0c68e4","type":"function","z":"b2a662aa.2b752","name":"WC calibration","func":"msg.payload = -11.182129 + 1.392048*msg.payload \nreturn msg;","outputs":1,"noerr":0,"x":280,"y":180,"wires":[["25e729a4.95b7fe","b1b77e03.c2822"]]},{"id":"303cf1e8.cf7276","type":"function","z":"b2a662aa.2b752","name":"Minimum volume","func":"if(msg.payload <= 12.0){\n    msg.payload = \"<12.0\"\n} else {\n    msg.payload = msg.payload.toFixed(1);\n}\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":260,"wires":[["9bc8c2a5.7262b8"]]},{"id":"32fe6811.8055a8","type":"rpi-gpio out","z":"2d8e58d.7555ca8","name":"Pump GPIO","pin":"11","set":true,"level":"0","freq":"1","out":"out","x":510,"y":480,"wires":[]},{"id":"10f77280.873376","type":"inject","z":"1e878673.29136a","name":"Default Element Duty","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"1","topic":"","payload":"100","payloadType":"num","x":140,"y":520,"wires":[["91b3f0e4.35708","6284d63a.be6d48"]]},{"id":"59b941a3.ab6d08","type":"change","z":"1e878673.29136a","name":"bk_lock=true","rules":[{"t":"set","p":"bk_lock","pt":"global","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":850,"y":1680,"wires":[[]]},{"id":"d3ab8458.31cd","type":"change","z":"1e878673.29136a","name":"bk_on = bk_try","rules":[{"t":"set","p":"bk_on","pt":"global","to":"bk_try","tot":"flow"},{"t":"set","p":"payload","pt":"msg","to":"bk_try","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":1700,"wires":[["a6f48df.c6b5d7","45708f26.3186e"]]},{"id":"a6f48df.c6b5d7","type":"switch","z":"1e878673.29136a","name":"bk_on","property":"bk_on","propertyType":"global","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":690,"y":1700,"wires":[["59b941a3.ab6d08"],["d7e61db5.6a8ad8"]]},{"id":"b4c8849.8c2ce78","type":"switch","z":"1e878673.29136a","name":"Check rims_lock","property":"rims_lock","propertyType":"global","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":310,"y":1680,"wires":[["506d5f20.cd229"],["d3ab8458.31cd"]]},{"id":"59bfa59f.c292f4","type":"ui_toast","z":"1e878673.29136a","position":"top right","displayTime":"5","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"","name":"","x":570,"y":1620,"wires":[]},{"id":"506d5f20.cd229","type":"change","z":"1e878673.29136a","name":"Element lock message","rules":[{"t":"set","p":"payload","pt":"msg","to":"Can not access boil kettle element controls while RIMS element is active","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":1660,"wires":[["59bfa59f.c292f4"]]},{"id":"7bc5e770.8a03d","type":"change","z":"cdc1c9a3.021f58","name":"","rules":[{"t":"set","p":"inner_p","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":1120,"wires":[[]]},{"id":"ad2f3a20.1034f","type":"change","z":"cdc1c9a3.021f58","name":"","rules":[{"t":"set","p":"inner_i","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":1220,"wires":[["b1cf141f.84ac9"]]},{"id":"93be5173.c7aa2","type":"change","z":"cdc1c9a3.021f58","name":"","rules":[{"t":"set","p":"inner_d","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":1320,"wires":[[]]},{"id":"7eae3e81.46ee88","type":"change","z":"cdc1c9a3.021f58","name":"","rules":[{"t":"set","p":"mash_target","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":780,"y":480,"wires":[[]]},{"id":"a173c222.e1b86","type":"function","z":"cdc1c9a3.021f58","name":"Cascade PID - main","func":"// brew2 Cascade PID algorithm\n// Justin Angevaare\n// Nov. 2019 - Oct. 2020\n\n// Determine update interval\n// Will be NaN if first iteration\nmsg.epochseconds = new Date() / 1000\nmsg.interval = msg.epochseconds - flow.get('last_calc_time')\nflow.set('last_calc_time', msg.epochseconds)\n\n///////////////////////////////////////////////////////////////\n// Begin Outer Control Loop\n// Output from Outer Control will be the target RIMS delta T\n///////////////////////////////////////////////////////////////\n\n// Calculate outer error\nmsg.outer_target = flow.get('mash_target')\nmsg.outer_error = msg.outer_target - global.get('temp-MLT');\n\n// Calculate proportional action\nmsg.outer_output = msg.outer_error * flow.get('outer_p');\n\n// Update outer integrator and calculate integral action\n// Skip for first iteration\nif(!isNaN(msg.interval)){\n    msg.outer_integrator = flow.get('outer_integrator');\n\n    // For purposes of integrator, bound error by [-1, 1]\n    msg.outer_integrator += msg.interval * Math.max(Math.min(msg.outer_error, 1), -1)\n    \n    // Bound total outer integrator by absolute maximum\n    msg.outer_integrator = Math.max(Math.min(msg.outer_integrator, flow.get('outer_integrator_max')), -flow.get('outer_integrator_max'));\n\n    // Output updated integrator to flow context\n    flow.set('outer_integrator', msg.outer_integrator)\n    \n    // Calculate intergral action\n    msg.outer_output += msg.outer_integrator * flow.get('outer_i');\n}\n\n// Calculate derivate and derivative action\n// Skip for first iteration\nif(!isNaN(msg.interval)){\n    msg.outer_derivative = (msg.outer_error - flow.get('last_outer_error'))/msg.interval\n    msg.outer_output += msg.outer_derivative * flow.get('outer_d')\n}\n\n// Bound outer_output by [outer_min, outer_max]\nmsg.outer_output = Math.max(Math.min(msg.outer_output, flow.get('outer_max')), flow.get('outer_min'));\n\n// Set inner_target\nmsg.inner_target = Math.min(msg.outer_target + msg.outer_output, 90)\n\n// Output updated last_outer_error to flow context\nmsg.last_outer_error = msg.outer_error;\nflow.set('last_outer_error', msg.last_outer_error);\n\n///////////////////////////////////////////////////////////////\n// Begin Inner Control Loop\n// Output from inner control loop will be RIMS element duty %\n///////////////////////////////////////////////////////////////\n\n// Calculate inner error\nmsg.inner_error = msg.inner_target - global.get('temp-RIMS');\n\n// Calculate proportional action\nmsg.inner_output = msg.inner_error * flow.get('inner_p');\n\n// Update inner integrator and calculate integral action\n// Skip for first iteration\nif(!isNaN(msg.interval)){\n    msg.inner_integrator = flow.get('inner_integrator');\n    // For purposes of integrator, bound error by [-1, 1]\n    msg.inner_integrator += msg.interval * Math.max(Math.min(msg.inner_error, 1), -1);\n    \n    // Bound total inner integrator by absolute maximum\n    msg.inner_integrator = Math.max(Math.min(msg.inner_integrator, flow.get('inner_integrator_max')), -flow.get('inner_integrator_max'));\n    \n    // Output updated integrator to flow context\n    flow.set('inner_integrator', msg.inner_integrator);\n    \n    // Calculate intergral action\n    msg.inner_output += msg.inner_integrator * flow.get('inner_i');\n}\n\n// Calculate derivative action\n// Skip for first iteration\nif(!isNaN(msg.interval)){\n    msg.inner_derivative = (msg.inner_error - flow.get('last_inner_error'))/msg.interval;\n    msg.inner_output += msg.inner_derivative * flow.get('inner_d');\n}\n\n// Bound inner_output by [0.0, max_output]\nmsg.inner_output = Math.max(Math.min(msg.inner_output, flow.get('inner_max')), 0.0);\n\n// Output inner_output to flow context\nflow.set('inner_output', msg.inner_output);\n\n// Output updated last_inner_error to flow context\nmsg.last_inner_error = msg.inner_error;\nflow.set('last_inner_error', msg.last_inner_error);\n\n// Set payload to element output (inner_output)\nmsg.payload = msg.inner_output;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":140,"wires":[["d067663f.365a9","cfaeaee6.2a6ab","42931abc.fbf8b4"]]},{"id":"5bc7112c.6ca358","type":"change","z":"cdc1c9a3.021f58","name":"global.rims_lock, rims_on, rims_limiter = false","rules":[{"t":"set","p":"rims_lock","pt":"global","to":"false","tot":"bool"},{"t":"set","p":"rims_on","pt":"global","to":"false","tot":"bool"},{"t":"set","p":"rims_limiter","pt":"global","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":1740,"wires":[["9bd31a5b.f45448"]]},{"id":"26a7870c.b8ea4","type":"change","z":"cdc1c9a3.021f58","name":"Lock message","rules":[{"t":"set","p":"payload","pt":"msg","to":"Can not access RIMS element controls while boil kettle element is active","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":1940,"wires":[["2e4ea9b.ece48d6"]]},{"id":"2e4ea9b.ece48d6","type":"ui_toast","z":"cdc1c9a3.021f58","position":"top right","displayTime":"5","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"","name":"","x":670,"y":2000,"wires":[]},{"id":"6bfc6616.0a03","type":"switch","z":"cdc1c9a3.021f58","name":"Check bk_lock","property":"bk_lock","propertyType":"global","rules":[{"t":"true"},{"t":"false"}],"checkall":"false","repair":false,"outputs":2,"x":360,"y":2040,"wires":[["26a7870c.b8ea4","3cad8f0a.a02778"],["25ac40a0.3587f8"]]},{"id":"3d6a8f69.ac96","type":"change","z":"cdc1c9a3.021f58","name":"rims_try = payload","rules":[{"t":"set","p":"rims_try","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":330,"y":1980,"wires":[["6bfc6616.0a03"]]},{"id":"253becb4.eb09fc","type":"change","z":"cdc1c9a3.021f58","name":"rims_on = rims_try","rules":[{"t":"set","p":"rims_on","pt":"global","to":"rims_try","tot":"flow"},{"t":"set","p":"payload","pt":"msg","to":"rims_try","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":630,"y":2080,"wires":[["d6a6fe13.0dee2","9ae6b3bc.013dd8"]]},{"id":"d6a6fe13.0dee2","type":"switch","z":"cdc1c9a3.021f58","name":"","property":"rims_on","propertyType":"global","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":810,"y":2120,"wires":[["bce4461c.3e13c"],["e0211c1f.5c199"]]},{"id":"bce4461c.3e13c","type":"change","z":"cdc1c9a3.021f58","name":"rims_lock = true","rules":[{"t":"set","p":"rims_lock","pt":"global","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":980,"y":2100,"wires":[[]]},{"id":"ac7ff251.12f97","type":"change","z":"cdc1c9a3.021f58","name":"rims_lock = false","rules":[{"t":"set","p":"rims_lock","pt":"global","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1030,"y":2180,"wires":[["395c51b.611aa2e"]]},{"id":"e0211c1f.5c199","type":"delay","z":"cdc1c9a3.021f58","name":"","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":960,"y":2140,"wires":[["ac7ff251.12f97"]]},{"id":"6c4d238a.3d5554","type":"switch","z":"cdc1c9a3.021f58","name":"rims_on switch","property":"rims_on","propertyType":"global","rules":[{"t":"true"}],"checkall":"false","repair":false,"outputs":1,"x":280,"y":140,"wires":[["a173c222.e1b86"]]},{"id":"d7e61db5.6a8ad8","type":"delay","z":"1e878673.29136a","name":"","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":840,"y":1720,"wires":[["b08647e3.136be8"]]},{"id":"b08647e3.136be8","type":"change","z":"1e878673.29136a","name":"bk_lock = false","rules":[{"t":"set","p":"bk_lock","pt":"global","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":900,"y":1760,"wires":[["7eb452a8.843114"]]},{"id":"324b69ce.251146","type":"ui_text","z":"cdc1c9a3.021f58","group":"321aaa6a.377d5e","order":2,"width":2,"height":1,"name":"Mash target","label":"Target","format":"{{payload | number:1}}°C","layout":"col-center","x":750,"y":520,"wires":[]},{"id":"e34426e3.0824","type":"smooth","z":"cae39ee2.e2c898","name":"","property":"payload","action":"mean","count":"5","round":"1","mult":"single","reduce":false,"x":720,"y":780,"wires":[["baf3d7f8.899408"]]},{"id":"2b38bf4e.64a19","type":"smooth","z":"cae39ee2.e2c898","name":"","property":"payload","action":"mean","count":"5","round":"1","mult":"single","reduce":false,"x":720,"y":500,"wires":[["18ee3bec.ce8b64"]]},{"id":"33b1f220.5f8056","type":"link out","z":"cae39ee2.e2c898","name":"RIMS raw temperature","links":["89ec63cb.ac191","d20fe142.9dfcb8"],"x":675,"y":620,"wires":[]},{"id":"7eb452a8.843114","type":"link out","z":"1e878673.29136a","name":"Bolt update","links":["93befc16.2ca578","b05b4104.4b7748","a0d524b2.529a4","f8471ffc.3e73c","c315e88a.988b48","f6b4b919.bce3c"],"x":875,"y":1800,"wires":[]},{"id":"45708f26.3186e","type":"link out","z":"1e878673.29136a","name":"Bolt update","links":["93befc16.2ca578","b05b4104.4b7748","a0d524b2.529a4","f8471ffc.3e73c","c315e88a.988b48","f6b4b919.bce3c"],"x":655,"y":1740,"wires":[]},{"id":"395c51b.611aa2e","type":"link out","z":"cdc1c9a3.021f58","name":"Bolt update","links":["93befc16.2ca578","b05b4104.4b7748","a0d524b2.529a4","f8471ffc.3e73c","c315e88a.988b48","f6b4b919.bce3c"],"x":1175,"y":2180,"wires":[]},{"id":"9ae6b3bc.013dd8","type":"link out","z":"cdc1c9a3.021f58","name":"Bolt update","links":["93befc16.2ca578","b05b4104.4b7748","a0d524b2.529a4","f8471ffc.3e73c","c315e88a.988b48","f6b4b919.bce3c"],"x":775,"y":2080,"wires":[]},{"id":"b1b77e03.c2822","type":"function","z":"b2a662aa.2b752","name":"Minimum WC","func":"if(msg.payload <= 5.0){\n    msg.payload = \"<5.0\"\n} else {\n    msg.payload = msg.payload.toFixed(1);\n}\nreturn msg;","outputs":1,"noerr":0,"x":620,"y":260,"wires":[["1f2642b8.afc335"]]},{"id":"1f2642b8.afc335","type":"ui_text","z":"b2a662aa.2b752","group":"f6e1ef23.f6f118","order":12,"width":3,"height":1,"name":"Mash WC display","label":"Water column","format":"{{msg.payload}} cmH₂O","layout":"col-center","x":670,"y":300,"wires":[]},{"id":"780c3724.2e43a","type":"inject","z":"cdc1c9a3.021f58","name":"Default Inner Kp","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"0.1","topic":"","payload":"20.0","payloadType":"num","x":160,"y":1120,"wires":[["7bc5e770.8a03d","1d6efd72.32940b"]]},{"id":"16f886ce.38ae51","type":"inject","z":"cdc1c9a3.021f58","name":"Default Inner Ki","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"0.1","topic":"","payload":"1","payloadType":"num","x":160,"y":1220,"wires":[["ad2f3a20.1034f","a8a1ab35.09f4b"]]},{"id":"1e869377.fbf4ad","type":"inject","z":"cdc1c9a3.021f58","name":"Default Inner Kd","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"1","topic":"","payload":"30","payloadType":"num","x":160,"y":1320,"wires":[["93be5173.c7aa2","2999ac68.84d814"]]},{"id":"b8c19fef.ae0d88","type":"inject","z":"cdc1c9a3.021f58","name":"Default Target","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"1.0","topic":"","payload":"72","payloadType":"num","x":160,"y":460,"wires":[["159ea120.ea187f","cd6d1a4c.17c818"]]},{"id":"55776d2d.6c074c","type":"inject","z":"cdc1c9a3.021f58","name":"Default Inner Limit","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"1","topic":"","payload":"40","payloadType":"num","x":150,"y":1420,"wires":[["1b35e9ba.06cc26","dcebc6b2.bb8dd8"]]},{"id":"15d16967.4afe17","type":"ui_numeric","z":"cdc1c9a3.021f58","name":"","label":"Limiter max output","tooltip":"","group":"3664e4b.5830a9c","order":10,"width":6,"height":1,"wrap":false,"passthru":true,"topic":"","format":"{{value | number:0}}٪","min":"1","max":"99","step":1,"x":530,"y":1460,"wires":[["1b35e9ba.06cc26"]]},{"id":"1b35e9ba.06cc26","type":"change","z":"cdc1c9a3.021f58","name":"","rules":[{"t":"set","p":"inner_limit","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":770,"y":1420,"wires":[["eab00f4b.29e27"]]},{"id":"460819bf.fa184","type":"change","z":"cdc1c9a3.021f58","name":"","rules":[{"t":"set","p":"rims_limiter","pt":"global","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":1660,"wires":[["668f2b46.52004c"]]},{"id":"3516d1c2.6cbd6e","type":"sensor-ds18b20","z":"cae39ee2.e2c898","name":"temp-BK","sensorid":"28-0000062eaf09","timer":"2","repeat":false,"x":360,"y":200,"wires":[["c90f55.656610a8"]]},{"id":"c83a56a2.7af0c8","type":"sensor-ds18b20","z":"cae39ee2.e2c898","name":"temp-RIMS","sensorid":"28-0000062eb892","timer":"2","repeat":false,"x":350,"y":480,"wires":[["a389a899.753a1"]],"outputLabels":["temp"]},{"id":"598eede.4742214","type":"sensor-ds18b20","z":"cae39ee2.e2c898","name":"temp-MLT","sensorid":"28-000007c0cb12","timer":"2","repeat":false,"x":350,"y":760,"wires":[["f6a82310.6a1e"]]},{"id":"9699ad48.47c208","type":"inject","z":"cae39ee2.e2c898","name":"","props":[{"p":"timestamp","v":"","vt":"date"}],"repeat":"2.5","crontab":"","once":true,"onceDelay":0.1,"topic":"","x":130,"y":200,"wires":[["c83a56a2.7af0c8","3516d1c2.6cbd6e","598eede.4742214","cd172d96.3df1c","25d8fdfc.fc41fa"]]},{"id":"bc1c0af.df72bf8","type":"ui_numeric","z":"1e878673.29136a","name":"","label":"K𝗉","tooltip":"","group":"f3e4e5c9.37f76","order":4,"width":"4","height":"1","wrap":false,"passthru":true,"topic":"","format":"{{value | number:1}}","min":0,"max":"99.8","step":"0.2","x":430,"y":880,"wires":[["8413d749.f67dd"]]},{"id":"a72bad9f.2b8f58","type":"ui_numeric","z":"1e878673.29136a","name":"","label":"K𝗂","tooltip":"","group":"f3e4e5c9.37f76","order":6,"width":"4","height":"1","wrap":false,"passthru":true,"topic":"","format":"{{value | number:1}}","min":0,"max":"100","step":"0.2","x":430,"y":980,"wires":[["83e362d5.df1928"]]},{"id":"c11d5a46.884ae8","type":"ui_numeric","z":"1e878673.29136a","name":"","label":"K𝖽","tooltip":"","group":"f3e4e5c9.37f76","order":8,"width":"4","height":"1","wrap":false,"passthru":true,"topic":"","format":"{{value | number:1}}","min":0,"max":"100","step":"0.2","x":430,"y":1080,"wires":[["41bb19e8.68968"]]},{"id":"8413d749.f67dd","type":"change","z":"1e878673.29136a","name":"","rules":[{"t":"set","p":"p","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":840,"wires":[[]]},{"id":"83e362d5.df1928","type":"change","z":"1e878673.29136a","name":"set flow.i","rules":[{"t":"set","p":"i","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":940,"wires":[[]]},{"id":"41bb19e8.68968","type":"change","z":"1e878673.29136a","name":"","rules":[{"t":"set","p":"d","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":1040,"wires":[[]]},{"id":"c6145809.208b2","type":"inject","z":"1e878673.29136a","name":"Default P","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"0.1","topic":"","payload":"20.0","payloadType":"num","x":120,"y":840,"wires":[["8413d749.f67dd","fae983fd.dfdc28"]]},{"id":"f015cf49.0765e","type":"inject","z":"1e878673.29136a","name":"Default I","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"0.1","topic":"","payload":"1","payloadType":"num","x":120,"y":940,"wires":[["83e362d5.df1928","d5eaa004.acc588"]]},{"id":"bc1104a1.bb44","type":"inject","z":"1e878673.29136a","name":"Default D","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"0.1","topic":"","payload":"30","payloadType":"num","x":120,"y":1040,"wires":[["41bb19e8.68968","2ccab8b4.b9fc8"]]},{"id":"3a5d8e4a.d39622","type":"inject","z":"1e878673.29136a","name":"Default BK Target","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"1","topic":"","payload":"72","payloadType":"num","x":150,"y":300,"wires":[["8c14934e.2efe18","add83ecb.fcfaa8"]]},{"id":"90bd87f9.3e6418","type":"function","z":"1e878673.29136a","name":"BK PID","func":"// Note that the algorithm provided below assumes a 1 second iteration time\n// Justin Angevaare\n// May 2018 - Oct 2020\n\n// Set temperature\n//msg.temperature =  global.get('temp-BK')\nmsg.temperature = msg.payload;\n\n// Set output max\nmsg.max_output = 100\n\n// Determine update interval\n// Will be NaN if first iteration\nmsg.epochseconds = new Date() / 1000\nmsg.interval = msg.epochseconds - flow.get('last_calc_time')\nflow.set('last_calc_time', msg.epochseconds)\n\n// Calculate error\nmsg.error = flow.get('bk_target') - msg.temperature;\n\n// Calculate proportional action\nmsg.output = msg.error * flow.get('p');\n\n// Update integrator and calculate integral action\n// Skip for first iteration\nif(!isNaN(msg.interval)){\n    // Calculate integrator max\n    msg.integrator_max = msg.max_output/Math.max(flow.get('i'), 2.0);\n    \n    // Update integrator\n    // For purposes of integrator, bound error by [-1, 1]\n    msg.integrator = flow.get('integrator');\n    msg.integrator += msg.interval * Math.max(Math.min(msg.error, 1), -1);\n    \n    // Bound total integrator by absolute maximum\n    msg.integrator = Math.max(Math.min(msg.integrator, msg.integrator_max), -msg.integrator_max);\n    \n    // Output updated integrator to flow context\n    flow.set('integrator', msg.integrator);\n    \n    // Calculate intergral action\n    msg.output += msg.integrator * flow.get('i');\n}\n\n// Calculate derivative action\n// Skip for first iteration\nif(!isNaN(msg.interval)){\n    msg.derivative = (msg.error - flow.get('last_error'))/msg.interval;\n    msg.output += msg.derivative * flow.get('d');\n}\n\n// Output updated last_error to flow context\nmsg.last_error = msg.error;\nflow.set('last_error', msg.last_error);\n\n// Bound output by [0, max_output]\nmsg.output = Math.max(Math.min(msg.output, msg.max_output), 0);\n\n// Output element output to flow context\nflow.set('output', msg.output);\n\n// Set payload to element output\nmsg.payload = msg.output;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":60,"wires":[["be52847e.467fe8","fd3d823.f4d7d8","fef8865a.aead48"]]},{"id":"eed429e6.df64c8","type":"switch","z":"1e878673.29136a","name":"bk_pid switch","property":"bk_pid","propertyType":"global","rules":[{"t":"true"},{"t":"false"}],"checkall":"false","repair":false,"outputs":2,"x":320,"y":100,"wires":[["90bd87f9.3e6418"],["898bd7d9.a004f"]]},{"id":"898bd7d9.a004f","type":"change","z":"1e878673.29136a","name":"bk_manual_duty","rules":[{"t":"set","p":"payload","pt":"msg","to":"bk_manual_duty","tot":"flow"},{"t":"set","p":"output","pt":"msg","to":"bk_manual_duty","tot":"flow"},{"t":"set","p":"output","pt":"flow","to":"bk_manual_duty","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":140,"wires":[["be52847e.467fe8","fef8865a.aead48"]]},{"id":"8a024057.0ec2b8","type":"link in","z":"1e878673.29136a","name":"BK PID temperature input","links":["737daba5.b4f1e4"],"x":55,"y":100,"wires":[["611bae86.6497c","817523f5.3814c"]]},{"id":"737daba5.b4f1e4","type":"link out","z":"cae39ee2.e2c898","name":"BK raw temperature","links":["89ec63cb.ac191","8a024057.0ec2b8"],"x":675,"y":300,"wires":[]},{"id":"2ede74f0.2bc45c","type":"change","z":"1e878673.29136a","name":"","rules":[{"t":"set","p":"bk_target","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":790,"y":260,"wires":[[]]},{"id":"be52847e.467fe8","type":"link out","z":"1e878673.29136a","name":"BK GPIO","links":["84dd404a.ab7a7"],"x":775,"y":100,"wires":[]},{"id":"60d387fc.ef7d08","type":"change","z":"1e878673.29136a","name":"bk_pid, bk_try = true","rules":[{"t":"set","p":"bk_pid","pt":"global","to":"true","tot":"bool"},{"t":"set","p":"bk_try","pt":"flow","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":320,"y":1300,"wires":[["19bbbdcd.af992a"]]},{"id":"3fab212d.7b19fe","type":"change","z":"1e878673.29136a","name":"bk_pid = false, bk_try = true","rules":[{"t":"set","p":"bk_pid","pt":"global","to":"false","tot":"bool"},{"t":"set","p":"bk_try","pt":"flow","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":1340,"wires":[["89c8425f.410c68"]]},{"id":"9ab73503.8e0a8","type":"change","z":"1e878673.29136a","name":"bk_pid, bk_try = false","rules":[{"t":"set","p":"bk_pid","pt":"global","to":"false","tot":"bool"},{"t":"set","p":"bk_try","pt":"flow","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":320,"y":1260,"wires":[["37ca9313.112484"]]},{"id":"89c8425f.410c68","type":"link out","z":"1e878673.29136a","name":"Boil Try Output","links":["39f5e6bb.c2001a"],"x":535,"y":1340,"wires":[]},{"id":"39f5e6bb.c2001a","type":"link in","z":"1e878673.29136a","name":"Boil Try Input","links":["89c8425f.410c68","19bbbdcd.af992a","37ca9313.112484"],"x":155,"y":1680,"wires":[["b4c8849.8c2ce78"]]},{"id":"611bae86.6497c","type":"switch","z":"1e878673.29136a","name":"bk_on","property":"bk_on","propertyType":"global","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":150,"y":140,"wires":[["eed429e6.df64c8"]]},{"id":"da1a9a4c.d64808","type":"change","z":"1e878673.29136a","name":"","rules":[{"t":"set","p":"bk_manual_duty","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":520,"wires":[[]]},{"id":"af559447.163748","type":"change","z":"1e878673.29136a","name":"payload = 0","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":1500,"wires":[["8a2f00e7.8fabc8"]]},{"id":"8a2f00e7.8fabc8","type":"link out","z":"1e878673.29136a","name":"Off Duty","links":["84dd404a.ab7a7","c3ca6978.572d5"],"x":535,"y":1500,"wires":[]},{"id":"be75bc65.2c4a58","type":"link out","z":"1e878673.29136a","name":"Boil PID display","links":["5285e8f7.b9ad08","eda67ad.0cd1d88","48ae8805.06b6a","533873ab.10d324"],"x":535,"y":1420,"wires":[]},{"id":"e7777c2f.7d6a58","type":"rpi-gpio out","z":"44130c7e.f0c1fc","name":"BK GPIO","pin":"13","set":false,"level":"0","freq":"1","out":"pwm","x":300,"y":220,"wires":[]},{"id":"84dd404a.ab7a7","type":"link in","z":"44130c7e.f0c1fc","name":"BK GPIO","links":["8a2f00e7.8fabc8","be52847e.467fe8"],"x":175,"y":220,"wires":[["e7777c2f.7d6a58"]]},{"id":"d067663f.365a9","type":"link out","z":"cdc1c9a3.021f58","name":"RIMS PID output (GPIO)","links":["24145682.3f917a","9873df80.46702"],"x":655,"y":140,"wires":[]},{"id":"872bc41f.72b268","type":"rpi-gpio out","z":"44130c7e.f0c1fc","name":"RIMS GPIO","pin":"15","set":false,"level":"0","freq":"1","out":"pwm","x":310,"y":60,"wires":[]},{"id":"24145682.3f917a","type":"link in","z":"44130c7e.f0c1fc","name":"RIMS GPIO","links":["d067663f.365a9","f9ae67d0.ea6dc"],"x":175,"y":60,"wires":[["872bc41f.72b268"]]},{"id":"7c7078cd.dce6c","type":"change","z":"cdc1c9a3.021f58","name":"duty = 0","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":1860,"wires":[["f9ae67d0.ea6dc"]]},{"id":"f9ae67d0.ea6dc","type":"link out","z":"cdc1c9a3.021f58","name":"RIMS OFF (GPIO)","links":["24145682.3f917a","9873df80.46702"],"x":575,"y":1860,"wires":[]},{"id":"40c0028.2cc017c","type":"change","z":"cdc1c9a3.021f58","name":"Zero everything","rules":[{"t":"set","p":"last_inner_error","pt":"msg","to":"0.0","tot":"num"},{"t":"set","p":"last_inner_error","pt":"flow","to":"0.0","tot":"num"},{"t":"set","p":"inner_integrator","pt":"msg","to":"0.0","tot":"num"},{"t":"set","p":"inner_integrator","pt":"flow","to":"0.0","tot":"num"},{"t":"set","p":"inner_derivative","pt":"msg","to":"0.0","tot":"num"},{"t":"set","p":"last_outer_error","pt":"msg","to":"0.0","tot":"num"},{"t":"set","p":"last_outer_error","pt":"flow","to":"0.0","tot":"num"},{"t":"set","p":"outer_integrator","pt":"msg","to":"0.0","tot":"num"},{"t":"set","p":"outer_integrator","pt":"flow","to":"0.0","tot":"num"},{"t":"set","p":"outer_derivative","pt":"msg","to":"0.0","tot":"num"},{"t":"set","p":"outer_output","pt":"flow","to":"0.0","tot":"num"},{"t":"set","p":"outer_output","pt":"msg","to":"0.0","tot":"num"},{"t":"set","p":"inner_output","pt":"msg","to":"0.0","tot":"num"},{"t":"set","p":"inner_output","pt":"flow","to":"0.0","tot":"num"},{"t":"set","p":"inner_target","pt":"msg","to":"mash_target","tot":"flow"},{"t":"set","p":"inner_target","pt":"flow","to":"mash_target","tot":"flow"},{"t":"set","p":"outer_target","pt":"msg","to":"mash_target","tot":"flow"},{"t":"delete","p":"last_calc_time","pt":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":320,"y":1820,"wires":[["488e4b0e.1f641c"]]},{"id":"488e4b0e.1f641c","type":"link out","z":"cdc1c9a3.021f58","name":"Mash PID display","links":["3f2878d3.94f4e","9b38e36.91e49a"],"x":575,"y":1820,"wires":[]},{"id":"cfaeaee6.2a6ab","type":"link out","z":"cdc1c9a3.021f58","name":"Mash PID display","links":["3f2878d3.94f4e","9b38e36.91e49a"],"x":655,"y":100,"wires":[]},{"id":"1ed4390c.ecfcff","type":"change","z":"1e878673.29136a","name":"Zero everything","rules":[{"t":"set","p":"last_error","pt":"msg","to":"0.0","tot":"num"},{"t":"set","p":"last_error","pt":"flow","to":"0","tot":"num"},{"t":"set","p":"integrator","pt":"msg","to":"0","tot":"num"},{"t":"set","p":"integrator","pt":"flow","to":"0","tot":"num"},{"t":"set","p":"derivative","pt":"msg","to":"0","tot":"num"},{"t":"set","p":"output","pt":"msg","to":"0","tot":"num"},{"t":"set","p":"output","pt":"flow","to":"0","tot":"num"},{"t":"set","p":"target","pt":"msg","to":"bk_target","tot":"flow"},{"t":"delete","p":"last_calc_time","pt":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":1420,"wires":[["be75bc65.2c4a58"]]},{"id":"fd3d823.f4d7d8","type":"link out","z":"1e878673.29136a","name":"Boil PID display + logging","links":["48ae8805.06b6a","533873ab.10d324"],"x":775,"y":60,"wires":[]},{"id":"909fce1e.6368d","type":"ui_text","z":"44130c7e.f0c1fc","group":"f3e4e5c9.37f76","order":3,"width":"2","height":"1","name":"BK element output","label":"Output","format":"{{payload | number:0}}﹪","layout":"col-center","x":330,"y":300,"wires":[]},{"id":"4530fdb0.e1c884","type":"ui_text","z":"44130c7e.f0c1fc","group":"3664e4b.5830a9c","order":3,"width":2,"height":1,"name":"RIMS element output","label":"Output","format":"{{payload | number:0}}٪","layout":"col-center","x":340,"y":140,"wires":[]},{"id":"b64090c1.73319","type":"link in","z":"cdc1c9a3.021f58","name":"Button click","links":["15d83e9d.b3ff21","2625d95d.2ed98e"],"x":175,"y":1980,"wires":[["3d6a8f69.ac96"]]},{"id":"b3e11a30.e34f4","type":"link in","z":"cdc1c9a3.021f58","name":"Off button","links":["15d83e9d.b3ff21","83772e32.d03bd"],"x":175,"y":1820,"wires":[["40c0028.2cc017c"]]},{"id":"83772e32.d03bd","type":"link out","z":"cdc1c9a3.021f58","name":"Initializations","links":["123ff4f9.df085b","987c2900.a5a87","ac538d8e.a1ade8","b3e11a30.e34f4","47363a29.23e8a4","d51ff474.a48fe"],"x":335,"y":1580,"wires":[]},{"id":"cdda2c94.7b455","type":"change","z":"28484198.eb083e","name":"pid - off colour","rules":[{"t":"set","p":"colour","pt":"msg","to":"grey","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":360,"wires":[["dec1e90e.4f61d8"]]},{"id":"16c19a69.97a5ce","type":"change","z":"28484198.eb083e","name":"pid - on colour","rules":[{"t":"set","p":"colour","pt":"msg","to":"#424242","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":320,"wires":[["dec1e90e.4f61d8"]]},{"id":"debb8cb1.a556c","type":"switch","z":"28484198.eb083e","name":"","property":"rims_on","propertyType":"global","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":330,"y":340,"wires":[["16c19a69.97a5ce"],["cdda2c94.7b455"]]},{"id":"dec1b3f8.d47b88","type":"delay","z":"28484198.eb083e","name":"delay","pauseType":"delay","timeout":"0.2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":290,"y":300,"wires":[["debb8cb1.a556c"]]},{"id":"dec1e90e.4f61d8","type":"link out","z":"28484198.eb083e","name":"PID button colour","links":["3f94bf0f.96a108"],"x":635,"y":340,"wires":[]},{"id":"ce284fe7.1336c","type":"change","z":"28484198.eb083e","name":"off colour","rules":[{"t":"set","p":"colour","pt":"msg","to":"#424242","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":560,"wires":[["14559bfb.7a00fc"]]},{"id":"675f200d.3f3d7","type":"change","z":"28484198.eb083e","name":"on colour","rules":[{"t":"set","p":"colour","pt":"msg","to":"grey","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":520,"wires":[["14559bfb.7a00fc"]]},{"id":"fe56cee0.8eff5","type":"switch","z":"28484198.eb083e","name":"","property":"rims_on","propertyType":"global","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":330,"y":540,"wires":[["675f200d.3f3d7"],["ce284fe7.1336c"]]},{"id":"df71f8cd.61f3a","type":"delay","z":"28484198.eb083e","name":"delay","pauseType":"delay","timeout":"0.2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":290,"y":500,"wires":[["fe56cee0.8eff5"]]},{"id":"14559bfb.7a00fc","type":"link out","z":"28484198.eb083e","name":"Off button colour","links":["1935f939.d4427f","6757c9a6.827aa"],"x":595,"y":540,"wires":[]},{"id":"d8dd142c.9e7828","type":"link in","z":"28484198.eb083e","name":"Button click","links":["15d83e9d.b3ff21","2625d95d.2ed98e","2aa6a038.2a82b"],"x":175,"y":500,"wires":[["df71f8cd.61f3a"]]},{"id":"248d281f.81767","type":"ui_button","z":"28484198.eb083e","name":"","group":"f6e1ef23.f6f118","order":8,"width":2,"height":1,"passthru":false,"label":"Off","tooltip":"","color":"","bgcolor":"{{colour}}","icon":"","payload":"false","payloadType":"bool","topic":"","x":290,"y":120,"wires":[["15d83e9d.b3ff21"]]},{"id":"70f94901.25c828","type":"ui_button","z":"28484198.eb083e","name":"","group":"f6e1ef23.f6f118","order":3,"width":2,"height":1,"passthru":false,"label":"PID","tooltip":"","color":"","bgcolor":"{{colour}}","icon":"","payload":"true","payloadType":"bool","topic":"","x":290,"y":40,"wires":[["2625d95d.2ed98e"]]},{"id":"15d83e9d.b3ff21","type":"link out","z":"28484198.eb083e","name":"Off button","links":["ac538d8e.a1ade8","b3e11a30.e34f4","b53ebaf1.4996f","b64090c1.73319","b962c91e.b3c32","d8dd142c.9e7828"],"x":415,"y":120,"wires":[]},{"id":"2625d95d.2ed98e","type":"link out","z":"28484198.eb083e","name":"PID button","links":["54c27116.f0fbb8","65b11f55.0036b","966c3ae9.d0b678","6fd789be.f20e6","67fe4219.31feac","d8dd142c.9e7828","ac9b0385.1a096","1163aa6f.a466a6","ac5a3184.ad004","c443490d.703ff","4aeae28e.9f0d7c","b962c91e.b3c32","b64090c1.73319","b53ebaf1.4996f"],"x":415,"y":40,"wires":[]},{"id":"3f94bf0f.96a108","type":"link in","z":"28484198.eb083e","name":"PID button colour","links":["1b75113e.ca613f","dec1e90e.4f61d8","f531277b.da7808","32f18cc9.4aa03c","e7895fc9.f785","58885f0e.86303"],"x":175,"y":40,"wires":[["70f94901.25c828"]]},{"id":"6757c9a6.827aa","type":"link in","z":"28484198.eb083e","name":"Off button colour","links":["14559bfb.7a00fc"],"x":175,"y":120,"wires":[["248d281f.81767"]]},{"id":"33933972.9ffc16","type":"link in","z":"1e878673.29136a","name":"PID button","links":["89ce3e25.3ad2f8","d888b85c.c0ab6"],"x":155,"y":1300,"wires":[["60d387fc.ef7d08"]]},{"id":"19bbbdcd.af992a","type":"link out","z":"1e878673.29136a","name":"Boil Try Output","links":["39f5e6bb.c2001a"],"x":535,"y":1300,"wires":[]},{"id":"37ca9313.112484","type":"link out","z":"1e878673.29136a","name":"Boil Try Output","links":["39f5e6bb.c2001a"],"x":535,"y":1260,"wires":[]},{"id":"480aa2e0.59a21c","type":"link in","z":"1e878673.29136a","name":"Manual button","links":["ed41478a.5a2028","1777733d.a2553d"],"x":155,"y":1340,"wires":[["3fab212d.7b19fe"]]},{"id":"5b459ac7.37d744","type":"link in","z":"1e878673.29136a","name":"Manual button","links":["ed41478a.5a2028","1777733d.a2553d"],"x":155,"y":1380,"wires":[["1ed4390c.ecfcff"]]},{"id":"f142f115.fa1378","type":"link in","z":"1e878673.29136a","name":"Off button","links":["308e6b59.254394","11c18a22.2ff07e","fd8c477a.99a1a"],"x":155,"y":1260,"wires":[["9ab73503.8e0a8"]]},{"id":"7d106986.7fb6f","type":"link in","z":"1e878673.29136a","name":"Off button","links":["badc88d8.0fe308","d068c868.178e4","308e6b59.254394","11c18a22.2ff07e","fd8c477a.99a1a"],"x":155,"y":1500,"wires":[["af559447.163748"]]},{"id":"af6b29fe.fa767","type":"inject","z":"1e878673.29136a","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"0.1","topic":"","payload":"","payloadType":"date","x":130,"y":1160,"wires":[["badc88d8.0fe308"]]},{"id":"344f76f6.ebc892","type":"link in","z":"1e878673.29136a","name":"Off button","links":["308e6b59.254394","badc88d8.0fe308","11c18a22.2ff07e","fd8c477a.99a1a"],"x":155,"y":1420,"wires":[["1ed4390c.ecfcff"]]},{"id":"badc88d8.0fe308","type":"link out","z":"1e878673.29136a","name":"Off button - initialization","links":["7d106986.7fb6f","1ae66216.83043e","344f76f6.ebc892","d7f4e02f.a6d098","1ec9332.c622acd","b357b24f.255c68"],"x":295,"y":1160,"wires":[]},{"id":"b88cba12.513d28","type":"ui_button","z":"70d4070b.e447b8","name":"","group":"9fe30f36.92cc2","order":5,"width":2,"height":1,"passthru":false,"label":"Manual","tooltip":"","color":"","bgcolor":"{{colour}}","icon":"","payload":"true","payloadType":"bool","topic":"","x":300,"y":100,"wires":[["1777733d.a2553d"]]},{"id":"1e35f86a.7e2a1","type":"ui_button","z":"70d4070b.e447b8","name":"","group":"9fe30f36.92cc2","order":3,"width":2,"height":1,"passthru":false,"label":"PID","tooltip":"","color":"","bgcolor":"{{colour}}","icon":"","payload":"true","payloadType":"bool","topic":"","x":290,"y":60,"wires":[["d888b85c.c0ab6"]]},{"id":"8bc792af.daced","type":"ui_button","z":"70d4070b.e447b8","name":"","group":"9fe30f36.92cc2","order":8,"width":2,"height":1,"passthru":false,"label":"Off","tooltip":"","color":"","bgcolor":"{{colour}}","icon":"","payload":"false","payloadType":"bool","topic":"","x":290,"y":140,"wires":[["308e6b59.254394"]]},{"id":"21b9adad.6a31aa","type":"link in","z":"70d4070b.e447b8","name":"PID button colour","links":["d09e22b.7beaee","cd8fd53.01d4928"],"x":175,"y":60,"wires":[["1e35f86a.7e2a1"]]},{"id":"fb88d45f.879888","type":"link in","z":"70d4070b.e447b8","name":"Manual button colour","links":["d4afc2dc.99b19"],"x":175,"y":100,"wires":[["b88cba12.513d28"]]},{"id":"3973098.f4c3476","type":"link in","z":"70d4070b.e447b8","name":"Off button colour","links":["8caf0a44.8225e8"],"x":175,"y":140,"wires":[["8bc792af.daced"]]},{"id":"d888b85c.c0ab6","type":"link out","z":"70d4070b.e447b8","name":"PID button","links":["33933972.9ffc16","42c201b8.408ae","5c7f7e7d.580358","bc121ca4.f4dcb"],"x":415,"y":60,"wires":[]},{"id":"1777733d.a2553d","type":"link out","z":"70d4070b.e447b8","name":"Manual button","links":["42c201b8.408ae","480aa2e0.59a21c","5b459ac7.37d744","5c7f7e7d.580358","bc121ca4.f4dcb"],"x":415,"y":100,"wires":[]},{"id":"308e6b59.254394","type":"link out","z":"70d4070b.e447b8","name":"Off button","links":["344f76f6.ebc892","42c201b8.408ae","5c7f7e7d.580358","7d106986.7fb6f","bc121ca4.f4dcb","f142f115.fa1378"],"x":415,"y":140,"wires":[]},{"id":"ac538d8e.a1ade8","type":"link in","z":"cdc1c9a3.021f58","name":"Off button","links":["15d83e9d.b3ff21","83772e32.d03bd"],"x":175,"y":1860,"wires":[["7c7078cd.dce6c"]]},{"id":"eb2a7a8.6e8a388","type":"delay","z":"70d4070b.e447b8","name":"delay","pauseType":"delay","timeout":"0.2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":290,"y":300,"wires":[["a9b48397.bd1d6"]]},{"id":"d09e22b.7beaee","type":"link out","z":"70d4070b.e447b8","name":"PID button colour","links":["21b9adad.6a31aa"],"x":735,"y":320,"wires":[]},{"id":"42c201b8.408ae","type":"link in","z":"70d4070b.e447b8","name":"Button click","links":["1777733d.a2553d","308e6b59.254394","d888b85c.c0ab6","11c18a22.2ff07e","fd8c477a.99a1a"],"x":175,"y":300,"wires":[["eb2a7a8.6e8a388"]]},{"id":"52abed07.da9014","type":"change","z":"70d4070b.e447b8","name":"off colour","rules":[{"t":"set","p":"colour","pt":"msg","to":"grey","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":440,"wires":[["d4afc2dc.99b19"]]},{"id":"cd261b4c.bceff","type":"change","z":"70d4070b.e447b8","name":"on colour","rules":[{"t":"set","p":"colour","pt":"msg","to":"#424242","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":400,"wires":[["d4afc2dc.99b19"]]},{"id":"307effd0.9d5ad8","type":"switch","z":"70d4070b.e447b8","name":"","property":"bk_on","propertyType":"global","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":330,"y":440,"wires":[["363dc3d2.07ca2c"],["52abed07.da9014"]]},{"id":"b82abc3.485d64","type":"delay","z":"70d4070b.e447b8","name":"delay","pauseType":"delay","timeout":"0.2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":290,"y":400,"wires":[["307effd0.9d5ad8"]]},{"id":"d4afc2dc.99b19","type":"link out","z":"70d4070b.e447b8","name":"Manual button colour","links":["fb88d45f.879888"],"x":715,"y":420,"wires":[]},{"id":"eb77bcef.798078","type":"change","z":"70d4070b.e447b8","name":"off colour","rules":[{"t":"set","p":"colour","pt":"msg","to":"#424242","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":560,"wires":[["8caf0a44.8225e8"]]},{"id":"a6b86af0.976658","type":"change","z":"70d4070b.e447b8","name":"on colour","rules":[{"t":"set","p":"colour","pt":"msg","to":"grey","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":520,"wires":[["8caf0a44.8225e8"]]},{"id":"41dc7d89.cd143c","type":"switch","z":"70d4070b.e447b8","name":"","property":"bk_on","propertyType":"global","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":310,"y":540,"wires":[["a6b86af0.976658"],["eb77bcef.798078"]]},{"id":"238dec24.1a0fb4","type":"delay","z":"70d4070b.e447b8","name":"delay","pauseType":"delay","timeout":"0.2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":290,"y":500,"wires":[["41dc7d89.cd143c"]]},{"id":"8caf0a44.8225e8","type":"link out","z":"70d4070b.e447b8","name":"Off button colour","links":["3973098.f4c3476","3e0efd1.4d98882","c98ea849.baf91"],"x":575,"y":540,"wires":[]},{"id":"363dc3d2.07ca2c","type":"switch","z":"70d4070b.e447b8","name":"","property":"bk_pid","propertyType":"global","rules":[{"t":"false"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":450,"y":420,"wires":[["cd261b4c.bceff"],["52abed07.da9014"]]},{"id":"a9b48397.bd1d6","type":"switch","z":"70d4070b.e447b8","name":"","property":"bk_on","propertyType":"global","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":330,"y":340,"wires":[["835c1ca.3f2fae"],["7dfcdd32.cd104c"]]},{"id":"835c1ca.3f2fae","type":"switch","z":"70d4070b.e447b8","name":"","property":"bk_pid","propertyType":"global","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":470,"y":320,"wires":[["929d9b44.2019c"],["7dfcdd32.cd104c"]]},{"id":"929d9b44.2019c","type":"change","z":"70d4070b.e447b8","name":"on colour","rules":[{"t":"set","p":"colour","pt":"msg","to":"#424242","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":300,"wires":[["d09e22b.7beaee"]]},{"id":"7dfcdd32.cd104c","type":"change","z":"70d4070b.e447b8","name":"off colour","rules":[{"t":"set","p":"colour","pt":"msg","to":"grey","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":340,"wires":[["d09e22b.7beaee"]]},{"id":"1ae66216.83043e","type":"link in","z":"1e878673.29136a","name":"Off button - initialization","links":["badc88d8.0fe308"],"x":155,"y":1220,"wires":[["e3b8324b.0dcfb8"]]},{"id":"e3b8324b.0dcfb8","type":"change","z":"1e878673.29136a","name":"bk_lock, bk_on, bk_pid, bk_try = false","rules":[{"t":"set","p":"bk_lock","pt":"global","to":"false","tot":"bool"},{"t":"set","p":"bk_on","pt":"global","to":"false","tot":"bool"},{"t":"set","p":"bk_pid","pt":"global","to":"false","tot":"bool"},{"t":"set","p":"bk_try","pt":"flow","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":370,"y":1220,"wires":[[]]},{"id":"bc121ca4.f4dcb","type":"link in","z":"70d4070b.e447b8","name":"Button click","links":["1777733d.a2553d","308e6b59.254394","d888b85c.c0ab6","11c18a22.2ff07e","fd8c477a.99a1a"],"x":175,"y":400,"wires":[["b82abc3.485d64"]]},{"id":"5c7f7e7d.580358","type":"link in","z":"70d4070b.e447b8","name":"Button click","links":["1777733d.a2553d","308e6b59.254394","d888b85c.c0ab6","11c18a22.2ff07e","fd8c477a.99a1a"],"x":175,"y":500,"wires":[["238dec24.1a0fb4"]]},{"id":"b962c91e.b3c32","type":"link in","z":"28484198.eb083e","name":"Button click","links":["15d83e9d.b3ff21","2625d95d.2ed98e","2aa6a038.2a82b"],"x":175,"y":300,"wires":[["dec1b3f8.d47b88"]]},{"id":"ab75cafe.2d25a8","type":"link in","z":"28484198.eb083e","name":"Button initialization","links":["343a6d3e.3643d2","e63a332.88bf8d","f51c265.a6e8358"],"x":175,"y":540,"wires":[["fe56cee0.8eff5"]]},{"id":"8f9871f2.d7aad","type":"link in","z":"28484198.eb083e","name":"Button initialization","links":["dad1a3f8.75b93","e63a332.88bf8d","343a6d3e.3643d2"],"x":175,"y":340,"wires":[["debb8cb1.a556c"]]},{"id":"29bf3a90.6f689e","type":"link in","z":"70d4070b.e447b8","name":"Button initialization","links":["a902d194.51df48","e9e1efef.4781b8"],"x":175,"y":340,"wires":[["a9b48397.bd1d6"]]},{"id":"d2bbd25b.20f7b8","type":"inject","z":"cdc1c9a3.021f58","name":"","props":[{"p":"payload","v":"","vt":"date"},{"p":"topic","v":"","vt":"string"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":1580,"wires":[["83772e32.d03bd"]]},{"id":"987c2900.a5a87","type":"link in","z":"cdc1c9a3.021f58","name":"Global initializations","links":["83772e32.d03bd"],"x":175,"y":1740,"wires":[["5bc7112c.6ca358"]]},{"id":"ab3bed93.7ae2b8","type":"link in","z":"70d4070b.e447b8","name":"Button initialization","links":["a902d194.51df48","e9e1efef.4781b8"],"x":175,"y":440,"wires":[["307effd0.9d5ad8"]]},{"id":"560b31e4.4f485","type":"link in","z":"70d4070b.e447b8","name":"Button initialization","links":["a902d194.51df48","e9e1efef.4781b8"],"x":175,"y":540,"wires":[["41dc7d89.cd143c"]]},{"id":"e9e1efef.4781b8","type":"link out","z":"70d4070b.e447b8","name":"Button initialization on connection","links":["29bf3a90.6f689e","560b31e4.4f485","ab3bed93.7ae2b8"],"x":415,"y":220,"wires":[]},{"id":"556117de.9a5b9","type":"ui_ui_control","z":"28484198.eb083e","name":"Dashboard connection","x":260,"y":220,"wires":[["343a6d3e.3643d2"]]},{"id":"343a6d3e.3643d2","type":"link out","z":"28484198.eb083e","name":"Button initialization on connection","links":["8f9871f2.d7aad","ab75cafe.2d25a8","4ea434d4.c6662c"],"x":415,"y":220,"wires":[]},{"id":"159ea120.ea187f","type":"ui_slider","z":"cdc1c9a3.021f58","name":"Mash target slider","label":"","tooltip":"","group":"f6e1ef23.f6f118","order":20,"width":4,"height":1,"passthru":true,"outs":"all","topic":"","min":"20","max":"90","step":"1","x":370,"y":500,"wires":[["cd6d1a4c.17c818"]]},{"id":"8c14934e.2efe18","type":"ui_slider","z":"1e878673.29136a","name":"BK target slider","label":"","tooltip":"","group":"9fe30f36.92cc2","order":15,"width":"4","height":"1","passthru":true,"outs":"all","topic":"","min":"20","max":"100","step":"1","x":380,"y":260,"wires":[["add83ecb.fcfaa8"]]},{"id":"91b3f0e4.35708","type":"ui_slider","z":"1e878673.29136a","name":"BK manual slider","label":"","tooltip":"","group":"9fe30f36.92cc2","order":17,"width":"4","height":"1","passthru":true,"outs":"all","topic":"","min":"20","max":"100","step":"1","x":390,"y":480,"wires":[["6284d63a.be6d48"]]},{"id":"3ccc6b9b.d55534","type":"ui_button","z":"28484198.eb083e","name":"","group":"f6e1ef23.f6f118","order":5,"width":2,"height":1,"passthru":false,"label":"Limiter","tooltip":"","color":"","bgcolor":"{{colour}}","icon":"","payload":"true","payloadType":"bool","topic":"","x":290,"y":80,"wires":[["2aa6a038.2a82b"]]},{"id":"ad91c055.7c31f8","type":"change","z":"28484198.eb083e","name":"limiter - off colour","rules":[{"t":"set","p":"colour","pt":"msg","to":"grey","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":510,"y":460,"wires":[["5d11d351.7dbcac"]]},{"id":"f67d7d29.d0ffd8","type":"change","z":"28484198.eb083e","name":"limiter - on colour","rules":[{"t":"set","p":"colour","pt":"msg","to":"#424242","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":510,"y":420,"wires":[["5d11d351.7dbcac"]]},{"id":"343c1e35.bd01f2","type":"switch","z":"28484198.eb083e","name":"","property":"rims_limiter","propertyType":"global","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":330,"y":440,"wires":[["f67d7d29.d0ffd8"],["ad91c055.7c31f8"]]},{"id":"ab4cba05.ef49f","type":"delay","z":"28484198.eb083e","name":"delay","pauseType":"delay","timeout":"0.2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":290,"y":400,"wires":[["343c1e35.bd01f2"]]},{"id":"5d11d351.7dbcac","type":"link out","z":"28484198.eb083e","name":"Limiter button colour","links":["fb19ac57.a0c95"],"x":655,"y":440,"wires":[]},{"id":"b53ebaf1.4996f","type":"link in","z":"28484198.eb083e","name":"Button click","links":["15d83e9d.b3ff21","2625d95d.2ed98e","2aa6a038.2a82b"],"x":175,"y":400,"wires":[["ab4cba05.ef49f"]]},{"id":"4ea434d4.c6662c","type":"link in","z":"28484198.eb083e","name":"Button initialization","links":["343a6d3e.3643d2","f51c265.a6e8358"],"x":175,"y":440,"wires":[["343c1e35.bd01f2"]]},{"id":"2aa6a038.2a82b","type":"link out","z":"28484198.eb083e","name":"PID limiter","links":["b53ebaf1.4996f","b962c91e.b3c32","d8dd142c.9e7828","ef3399af.f4985"],"x":415,"y":80,"wires":[]},{"id":"fb19ac57.a0c95","type":"link in","z":"28484198.eb083e","name":"Limiter button colour","links":["5d11d351.7dbcac"],"x":175,"y":80,"wires":[["3ccc6b9b.d55534"]]},{"id":"ef3399af.f4985","type":"link in","z":"cdc1c9a3.021f58","name":"rims_limiter switcher","links":["2aa6a038.2a82b"],"x":175,"y":1680,"wires":[["2b5d25cf.4ea10a"]]},{"id":"2b5d25cf.4ea10a","type":"switch","z":"cdc1c9a3.021f58","name":"","property":"rims_limiter","propertyType":"global","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":290,"y":1680,"wires":[["460819bf.fa184"],["5890006d.b3eeb8"]]},{"id":"5890006d.b3eeb8","type":"change","z":"cdc1c9a3.021f58","name":"","rules":[{"t":"set","p":"rims_limiter","pt":"global","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":1700,"wires":[["60f7dfe2.9a8ba"]]},{"id":"123ff4f9.df085b","type":"link in","z":"cdc1c9a3.021f58","name":"RIMS try","links":["83772e32.d03bd","3cad8f0a.a02778","48d58022.99f848"],"x":175,"y":1780,"wires":[["30ac2870.766ad"]]},{"id":"30ac2870.766ad","type":"change","z":"cdc1c9a3.021f58","name":"flow.rims_try = false","rules":[{"t":"set","p":"rims_try","pt":"flow","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":1780,"wires":[[]]},{"id":"9f92ccc0.54cce","type":"ui_ui_control","z":"b764cb6a.5d4448","name":"UI navigation","x":670,"y":400,"wires":[[]]},{"id":"76a6c3b3.a8018c","type":"ui_button","z":"b764cb6a.5d4448","name":"","group":"cafd8af.6569df8","order":3,"width":"6","height":1,"passthru":false,"label":"Mash PID","tooltip":"","color":"#757575","bgcolor":"white","icon":"","payload":"2","payloadType":"num","topic":"","x":140,"y":360,"wires":[["9f92ccc0.54cce"]]},{"id":"11a16114.5fa03f","type":"ui_button","z":"b764cb6a.5d4448","name":"","group":"cafd8af.6569df8","order":4,"width":"6","height":1,"passthru":false,"label":"Boil PID","tooltip":"","color":"#757575","bgcolor":"white","icon":"","payload":"3","payloadType":"num","topic":"","x":140,"y":440,"wires":[["9f92ccc0.54cce"]]},{"id":"99276d4d.ae5df","type":"ui_button","z":"b764cb6a.5d4448","name":"","group":"3664e4b.5830a9c","order":12,"width":0,"height":0,"passthru":false,"label":"Back to menu","tooltip":"","color":"#757575","bgcolor":"#e0e0e0","icon":"","payload":"1","payloadType":"num","topic":"","x":130,"y":400,"wires":[["9f92ccc0.54cce"]]},{"id":"25280e6f.05c2ca","type":"ui_button","z":"b764cb6a.5d4448","name":"","group":"f3e4e5c9.37f76","order":11,"width":0,"height":0,"passthru":false,"label":"Back to menu","tooltip":"","color":"#757575","bgcolor":"#e0e0e0","icon":"","payload":"1","payloadType":"num","topic":"","x":120,"y":480,"wires":[["9f92ccc0.54cce"]]},{"id":"6a1e701c.88014","type":"ui_numeric","z":"cdc1c9a3.021f58","name":"","label":"K𝖽","tooltip":"","group":"3664e4b.5830a9c","order":8,"width":4,"height":1,"wrap":false,"passthru":true,"topic":"","format":"{{value | number:1}}","min":0,"max":"100","step":"0.2","x":490,"y":1360,"wires":[["93be5173.c7aa2"]]},{"id":"97c18bd5.c5eb58","type":"ui_numeric","z":"cdc1c9a3.021f58","name":"","label":"K𝗂","tooltip":"","group":"3664e4b.5830a9c","order":6,"width":4,"height":1,"wrap":false,"passthru":true,"topic":"","format":"{{value | number:1}}","min":0,"max":"100","step":"0.2","x":490,"y":1260,"wires":[["ad2f3a20.1034f"]]},{"id":"6d5d45c8.ade6ec","type":"ui_numeric","z":"cdc1c9a3.021f58","name":"","label":"K𝗉","tooltip":"","group":"3664e4b.5830a9c","order":4,"width":4,"height":1,"wrap":false,"passthru":true,"topic":"","format":"{{value | number:1}}","min":0,"max":"99","step":"0.2","x":490,"y":1160,"wires":[["7bc5e770.8a03d"]]},{"id":"926f5889.b91ce8","type":"ui_template","z":"b764cb6a.5d4448","group":"7311bc5c.585f8c","name":"Ensure dashboard is displayed as 1 or 2 columns","order":7,"width":0,"height":0,"format":"<style>\n@media only screen and (min-width: 800px) { .masonry-container {\n    width: 800px;\n}\n</style>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"global","x":230,"y":60,"wires":[[]]},{"id":"5e61a321.7c951c","type":"change","z":"2d8e58d.7555ca8","name":"pump - off colour","rules":[{"t":"set","p":"colour","pt":"msg","to":"grey","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":550,"y":400,"wires":[["6e56aa5a.45e99c"]]},{"id":"1b274766.986de9","type":"change","z":"2d8e58d.7555ca8","name":"pump - on colour","rules":[{"t":"set","p":"colour","pt":"msg","to":"#66cc00","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":550,"y":360,"wires":[["6e56aa5a.45e99c"]]},{"id":"6d9279e3.4e789","type":"switch","z":"2d8e58d.7555ca8","name":"Pump state","property":"pump","propertyType":"global","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":350,"y":380,"wires":[["1b274766.986de9"],["5e61a321.7c951c"]]},{"id":"2f00a82.69115d8","type":"delay","z":"2d8e58d.7555ca8","name":"delay","pauseType":"delay","timeout":"0.2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":290,"y":340,"wires":[["6d9279e3.4e789"]]},{"id":"6e56aa5a.45e99c","type":"link out","z":"2d8e58d.7555ca8","name":"Pump button colour","links":["76c943b.e874a3c"],"x":695,"y":380,"wires":[]},{"id":"1d4ca40a.7d8c24","type":"link in","z":"2d8e58d.7555ca8","name":"Pump update","links":["c73cf0fd.6177a8"],"x":175,"y":340,"wires":[["2f00a82.69115d8"]]},{"id":"f9c9ab63.f152d","type":"inject","z":"2d8e58d.7555ca8","name":"","repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"0","payloadType":"num","x":210,"y":40,"wires":[["d74042e7.9d1d18"]]},{"id":"52851ec8.0ec6b","type":"change","z":"2d8e58d.7555ca8","name":"Pump update","rules":[{"t":"set","p":"payload","pt":"msg","to":"pump","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":320,"y":480,"wires":[["32fe6811.8055a8"]]},{"id":"3e55809f.6615e8","type":"ui_button","z":"2d8e58d.7555ca8","name":"","group":"7311bc5c.585f8c","order":2,"width":4,"height":1,"passthru":false,"label":"Pump","tooltip":"","color":"","bgcolor":"{{colour}}","icon":"","payload":"true","payloadType":"bool","topic":"","x":230,"y":120,"wires":[["fc940ae2.9a3088"]]},{"id":"76c943b.e874a3c","type":"link in","z":"2d8e58d.7555ca8","name":"Pump button colour","links":["6e56aa5a.45e99c"],"x":115,"y":120,"wires":[["3e55809f.6615e8"]]},{"id":"fc940ae2.9a3088","type":"switch","z":"2d8e58d.7555ca8","name":"Pump state","property":"pump","propertyType":"global","rules":[{"t":"eq","v":"0","vt":"str"},{"t":"eq","v":"1","vt":"num"}],"checkall":"false","repair":false,"outputs":2,"x":290,"y":160,"wires":[["f0386117.e8b958"],["a03929a0.75dd5"]]},{"id":"2cf5b012.61cca","type":"change","z":"2d8e58d.7555ca8","name":"Turn off","rules":[{"t":"set","p":"pump","pt":"global","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":660,"y":160,"wires":[["c73cf0fd.6177a8"]]},{"id":"f0386117.e8b958","type":"change","z":"2d8e58d.7555ca8","name":"Turn on","rules":[{"t":"set","p":"pump","pt":"global","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":660,"y":120,"wires":[["c73cf0fd.6177a8"]]},{"id":"c73cf0fd.6177a8","type":"link out","z":"2d8e58d.7555ca8","name":"Pump update","links":["1d4ca40a.7d8c24","55245a21.c9d0bc"],"x":775,"y":140,"wires":[]},{"id":"d74042e7.9d1d18","type":"change","z":"2d8e58d.7555ca8","name":"","rules":[{"t":"set","p":"pump","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":380,"y":40,"wires":[[]]},{"id":"55245a21.c9d0bc","type":"link in","z":"2d8e58d.7555ca8","name":"Pump update","links":["c73cf0fd.6177a8"],"x":175,"y":480,"wires":[["52851ec8.0ec6b"]]},{"id":"a03929a0.75dd5","type":"switch","z":"2d8e58d.7555ca8","name":"RIMS on?","property":"rims_on","propertyType":"global","rules":[{"t":"false"},{"t":"true"}],"checkall":"false","repair":false,"outputs":2,"x":460,"y":180,"wires":[["2cf5b012.61cca"],["62dadac5.d90074"]]},{"id":"62dadac5.d90074","type":"change","z":"2d8e58d.7555ca8","name":"Conflict message","rules":[{"t":"set","p":"payload","pt":"msg","to":"Can not turn off pump while RIMS element is active","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":220,"wires":[["10b9b346.4371b5"]]},{"id":"10b9b346.4371b5","type":"ui_toast","z":"2d8e58d.7555ca8","position":"top right","displayTime":"5","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"","name":"","x":570,"y":260,"wires":[]},{"id":"e82101b5.32efb8","type":"ui_text","z":"4ef08725.8fbdd","group":"3664e4b.5830a9c","order":7,"width":2,"height":1,"name":"Inner PID Integrator","label":"Integral","format":"{{inner_integrator | number:1}}°C⦁s","layout":"col-center","x":630,"y":160,"wires":[]},{"id":"527896c3.acf218","type":"ui_text","z":"4ef08725.8fbdd","group":"3664e4b.5830a9c","order":5,"width":2,"height":1,"name":"Inner PID Error","label":"Error","format":"{{last_inner_error | number:1}}°C","layout":"col-center","x":620,"y":120,"wires":[]},{"id":"fba1b06.ac1075","type":"ui_text","z":"4ef08725.8fbdd","group":"3664e4b.5830a9c","order":9,"width":2,"height":1,"name":"Inner PID Derivative","label":"Derivative","format":"{{inner_derivative | number:1}}°C/s","layout":"col-center","x":630,"y":200,"wires":[]},{"id":"3f2878d3.94f4e","type":"link in","z":"4ef08725.8fbdd","name":"Mash PID display","links":["488e4b0e.1f641c","cfaeaee6.2a6ab"],"x":375,"y":320,"wires":[["527896c3.acf218","e82101b5.32efb8","fba1b06.ac1075","2aae55db.648c0a","b4a403cc.f45e58","b627264.9440ad8","204b1bc3.f8ebdc","b8578d41.4523a","f3c1dcd7.a969d"]]},{"id":"331f0c30.0eaf84","type":"ui_text","z":"4ef08725.8fbdd","group":"f3e4e5c9.37f76","order":7,"width":"2","height":"1","name":"BK PID Integrator","label":"Integral","format":"{{integrator | number:1}}°C⦁s","layout":"col-center","x":630,"y":600,"wires":[]},{"id":"6d1b4227.4e146c","type":"ui_text","z":"4ef08725.8fbdd","group":"f3e4e5c9.37f76","order":5,"width":"2","height":"1","name":"BK PID Error","label":"Error","format":"{{last_error | number:1}}°C","layout":"col-center","x":610,"y":560,"wires":[]},{"id":"834663e4.c08d7","type":"ui_text","z":"4ef08725.8fbdd","group":"f3e4e5c9.37f76","order":9,"width":"2","height":"1","name":"BK PID Derivative","label":"Derivative","format":"{{derivative | number:1}}°C/s","layout":"col-center","x":630,"y":640,"wires":[]},{"id":"48ae8805.06b6a","type":"link in","z":"4ef08725.8fbdd","name":"Boil PID display","links":["be75bc65.2c4a58","fd3d823.f4d7d8"],"x":375,"y":600,"wires":[["6d1b4227.4e146c","834663e4.c08d7","331f0c30.0eaf84"]]},{"id":"25ac40a0.3587f8","type":"switch","z":"cdc1c9a3.021f58","name":"Check pump","property":"pump","propertyType":"global","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":390,"y":2100,"wires":[["253becb4.eb09fc"],["930d09d2.af36","48d58022.99f848"]]},{"id":"930d09d2.af36","type":"change","z":"cdc1c9a3.021f58","name":"Lock message","rules":[{"t":"set","p":"payload","pt":"msg","to":"Can not access RIMS element controls while pump is off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":2160,"wires":[["fd32f589.3deb28"]]},{"id":"fd32f589.3deb28","type":"ui_toast","z":"cdc1c9a3.021f58","position":"top right","displayTime":"5","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"","name":"","x":670,"y":2220,"wires":[]},{"id":"3cad8f0a.a02778","type":"link out","z":"cdc1c9a3.021f58","name":"RIMS try reset","links":["123ff4f9.df085b"],"x":555,"y":2040,"wires":[]},{"id":"48d58022.99f848","type":"link out","z":"cdc1c9a3.021f58","name":"RIMS try reset","links":["123ff4f9.df085b"],"x":555,"y":2120,"wires":[]},{"id":"2928a691.1c2ee2","type":"ui_template","z":"b764cb6a.5d4448","group":"7311bc5c.585f8c","name":"Centre group titles","order":6,"width":0,"height":0,"format":"<style>\n.nr-dashboard-theme ui-card-panel p.nr-dashboard-cardtitle {\n  text-align: center;\n}\nbody {\n  overflow: hidden; /* Hide scrollbars */\n}\n.nr-dashboard-theme ng-scope layout-column {\n  overflow: hidden; /* Hide scrollbars */\n}\n</style>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"global","x":130,"y":100,"wires":[[]]},{"id":"71168df0.a00dac","type":"change","z":"cdc1c9a3.021f58","name":"","rules":[{"t":"set","p":"outer_p","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":620,"wires":[[]]},{"id":"32eed7cd.ebb7e","type":"change","z":"cdc1c9a3.021f58","name":"","rules":[{"t":"set","p":"outer_i","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":720,"wires":[["3d8c1d38.bf5382"]]},{"id":"b9d3db75.fa5268","type":"change","z":"cdc1c9a3.021f58","name":"","rules":[{"t":"set","p":"outer_d","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":820,"wires":[[]]},{"id":"a5dfe23a.f0acb8","type":"inject","z":"cdc1c9a3.021f58","name":"Default Outer Kp","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"0.1","topic":"","payload":"1","payloadType":"num","x":150,"y":620,"wires":[["71168df0.a00dac","c1afd32b.04eb4"]]},{"id":"a7d53803.59368","type":"inject","z":"cdc1c9a3.021f58","name":"Default Outer Ki","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"0.1","topic":"","payload":"1","payloadType":"num","x":140,"y":720,"wires":[["32eed7cd.ebb7e","2488380a.ad5d4"]]},{"id":"621a411.9e695c","type":"inject","z":"cdc1c9a3.021f58","name":"Default Outer Kd","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"0.1","topic":"","payload":"0","payloadType":"num","x":150,"y":820,"wires":[["b9d3db75.fa5268","f5ff531f.119248"]]},{"id":"556564b9.22dd04","type":"inject","z":"cdc1c9a3.021f58","name":"Default Outer Max","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"0.1","topic":"","payload":"8","payloadType":"num","x":150,"y":920,"wires":[["94c71243.a555c","b2606f68.5ad9d"]]},{"id":"45f99cbb.a41e74","type":"ui_numeric","z":"cdc1c9a3.021f58","name":"","label":"Max output","tooltip":"","group":"321aaa6a.377d5e","order":12,"width":5,"height":1,"wrap":false,"passthru":true,"topic":"","format":"{{value | number:1}} Δ°C","min":"1","max":"15","step":1,"x":510,"y":960,"wires":[["94c71243.a555c"]]},{"id":"94c71243.a555c","type":"change","z":"cdc1c9a3.021f58","name":"","rules":[{"t":"set","p":"outer_max","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":770,"y":920,"wires":[["26ffe308.94498c"]]},{"id":"f1b523f2.089028","type":"ui_numeric","z":"cdc1c9a3.021f58","name":"","label":"K𝖽","tooltip":"","group":"321aaa6a.377d5e","order":8,"width":4,"height":1,"wrap":false,"passthru":true,"topic":"","format":"{{value | number:1}}","min":0,"max":"100","step":"0.2","x":490,"y":860,"wires":[["b9d3db75.fa5268"]]},{"id":"221f49aa.464856","type":"ui_numeric","z":"cdc1c9a3.021f58","name":"","label":"K𝗂","tooltip":"","group":"321aaa6a.377d5e","order":6,"width":4,"height":1,"wrap":false,"passthru":true,"topic":"","format":"{{value | number:1}}","min":0,"max":"100","step":"0.2","x":490,"y":760,"wires":[["32eed7cd.ebb7e"]]},{"id":"2d4a6684.c51be2","type":"ui_numeric","z":"cdc1c9a3.021f58","name":"","label":"K𝗉","tooltip":"","group":"321aaa6a.377d5e","order":4,"width":4,"height":1,"wrap":false,"passthru":false,"topic":"","format":"{{value | number:1}}","min":0,"max":"99","step":"0.2","x":490,"y":660,"wires":[["71168df0.a00dac"]]},{"id":"b4a403cc.f45e58","type":"ui_text","z":"4ef08725.8fbdd","group":"321aaa6a.377d5e","order":7,"width":2,"height":1,"name":"Outer PID Integrator","label":"Integral","format":"{{outer_integrator | number:1}}°C⦁s","layout":"col-center","x":640,"y":280,"wires":[]},{"id":"2aae55db.648c0a","type":"ui_text","z":"4ef08725.8fbdd","group":"321aaa6a.377d5e","order":5,"width":2,"height":1,"name":"Outer PID Error","label":"Error","format":"{{last_outer_error | number:1}}°C","layout":"col-center","x":620,"y":240,"wires":[]},{"id":"b627264.9440ad8","type":"ui_text","z":"4ef08725.8fbdd","group":"321aaa6a.377d5e","order":9,"width":2,"height":1,"name":"Outer PID Derivative","label":"Derivative","format":"{{outer_derivative | number:1}}°C/s","layout":"col-center","x":640,"y":320,"wires":[]},{"id":"86751c96.8bee98","type":"link out","z":"cae39ee2.e2c898","name":"MLT raw temperature","links":["89ec63cb.ac191","e51f03e2.9a55f8"],"x":675,"y":900,"wires":[]},{"id":"dc955b1c.7edea","type":"link in","z":"cdc1c9a3.021f58","name":"Cascade PID trigger","links":["5010ffd6.cabb28","89ee3653.084a8","57e24640.1e4668","53bccee6.71df08"],"x":155,"y":140,"wires":[["6c4d238a.3d5554"]]},{"id":"d6a0ec58.b20f1","type":"function","z":"cdc1c9a3.021f58","name":"Cascade PID - integrator max calculation","func":"// brew2 PID algorithm - integrators\n// Justin Angevaare\n// May 2018 - Oct. 2020\n\n// Calculate outer integrator max\n// Output to flow context\nif(flow.get('outer_i')>0.0){\n    flow.set('outer_integrator_max', (flow.get('outer_max')-flow.get('outer_min'))/Math.max(flow.get('outer_i'), 2.0))}else {\n        flow.set('outer_integrator_max', 0.0)}\n\n// Get current output max\n// Output to flow context\nif(global.get('rims_limiter')){\n    flow.set('inner_max', flow.get('inner_limit'))}else {\n        flow.set('inner_max', 100)}\n\n// Calculate inner integrator max\n// Output to flow context\nif(flow.get('inner_i')>0.0){\n    flow.set('inner_integrator_max', flow.get('inner_max')/Math.max(flow.get('inner_i'), 2.0))}else {\n        flow.set('inner_integrator_max', 0.0)}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":360,"y":60,"wires":[[]]},{"id":"ae15465d.e134","type":"link in","z":"cdc1c9a3.021f58","name":"Cascade PID Integrator update","links":["b097c6ec.5fbe5","b1cf141f.84ac9","d75d11e.f8f757","eab00f4b.29e27","2f03decd.c6137a","3d8c1d38.bf5382","668f2b46.52004c","26ffe308.94498c","60f7dfe2.9a8ba","9bd31a5b.f45448","49935c6a.faf4a4"],"x":155,"y":60,"wires":[["d6a0ec58.b20f1"]]},{"id":"b1cf141f.84ac9","type":"link out","z":"cdc1c9a3.021f58","name":"Cascade PID Integrator update","links":["ae15465d.e134"],"x":915,"y":1220,"wires":[]},{"id":"eab00f4b.29e27","type":"link out","z":"cdc1c9a3.021f58","name":"Cascade PID Integrator update","links":["ae15465d.e134"],"x":915,"y":1420,"wires":[]},{"id":"3d8c1d38.bf5382","type":"link out","z":"cdc1c9a3.021f58","name":"Cascade PID Integrator update","links":["ae15465d.e134"],"x":915,"y":720,"wires":[]},{"id":"668f2b46.52004c","type":"link out","z":"cdc1c9a3.021f58","name":"Cascade PID Integrator update","links":["ae15465d.e134"],"x":655,"y":1660,"wires":[]},{"id":"26ffe308.94498c","type":"link out","z":"cdc1c9a3.021f58","name":"Cascade PID Integrator update","links":["ae15465d.e134"],"x":915,"y":920,"wires":[]},{"id":"60f7dfe2.9a8ba","type":"link out","z":"cdc1c9a3.021f58","name":"Cascade PID Integrator update","links":["ae15465d.e134"],"x":655,"y":1700,"wires":[]},{"id":"9bd31a5b.f45448","type":"link out","z":"cdc1c9a3.021f58","name":"Cascade PID Integrator update","links":["ae15465d.e134"],"x":655,"y":1740,"wires":[]},{"id":"6920821b.3fc50c","type":"ui_text","z":"cae39ee2.e2c898","group":"3664e4b.5830a9c","order":1,"width":2,"height":1,"name":"RIMS temperature display (raw)","label":"Heater","format":"{{msg.payload | number:1}}°C","layout":"col-center","x":790,"y":580,"wires":[]},{"id":"5d183b5d.0387cc","type":"ui_text","z":"cae39ee2.e2c898","group":"321aaa6a.377d5e","order":1,"width":2,"height":1,"name":"MLT temperature display (raw)","label":"MLT","format":"{{msg.payload | number:1}}°C","layout":"col-center","x":790,"y":860,"wires":[]},{"id":"b8578d41.4523a","type":"ui_text","z":"4ef08725.8fbdd","group":"3664e4b.5830a9c","order":2,"width":2,"height":1,"name":"Inner Target","label":"Target","format":"{{inner_target | number:1}}°C","layout":"col-center","x":610,"y":400,"wires":[]},{"id":"204b1bc3.f8ebdc","type":"ui_text","z":"4ef08725.8fbdd","group":"321aaa6a.377d5e","order":3,"width":2,"height":1,"name":"Outer Output","label":"Output","format":"{{outer_output | number:1}} Δ°C","layout":"col-center","x":610,"y":360,"wires":[]},{"id":"64f4ecd7.223dac","type":"link out","z":"cdc1c9a3.021f58","name":"Mash target slider output","links":["6ce6448.f7e59bc"],"x":695,"y":440,"wires":[]},{"id":"6188a3dc.9d0a9c","type":"switch","z":"4ef08725.8fbdd","name":"","property":"rims_on","propertyType":"global","rules":[{"t":"false"}],"checkall":"true","repair":true,"outputs":1,"x":230,"y":380,"wires":[["417ad43f.c5b28c"]]},{"id":"6ce6448.f7e59bc","type":"link in","z":"4ef08725.8fbdd","name":"","links":["64f4ecd7.223dac","edaf2c9d.be53"],"x":135,"y":380,"wires":[["6188a3dc.9d0a9c"]]},{"id":"417ad43f.c5b28c","type":"change","z":"4ef08725.8fbdd","name":"Inner target = outer target","rules":[{"t":"set","p":"inner_target","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":330,"y":420,"wires":[["b8578d41.4523a","f3c1dcd7.a969d"]]},{"id":"5fe5d9bc.db8e5","type":"inject","z":"e2318.a76b94e88","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":90,"y":120,"wires":[["8828c976.4356c8"]]},{"id":"4bb70a7b.6fcfbc","type":"change","z":"e2318.a76b94e88","name":"","rules":[{"t":"set","p":"temp_log","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":330,"y":160,"wires":[[]]},{"id":"8828c976.4356c8","type":"ui_switch","z":"e2318.a76b94e88","name":"","label":"Temperature","tooltip":"","group":"8d73628b.8b862","order":2,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":270,"y":120,"wires":[["4bb70a7b.6fcfbc"]]},{"id":"57864630.495bf8","type":"ui_button","z":"b764cb6a.5d4448","name":"","group":"cafd8af.6569df8","order":1,"width":"6","height":1,"passthru":false,"label":"General","tooltip":"","color":"#757575","bgcolor":"white","icon":"","payload":"4","payloadType":"num","topic":"","x":140,"y":200,"wires":[["9f92ccc0.54cce"]]},{"id":"1409493a.3b3617","type":"ui_button","z":"b764cb6a.5d4448","name":"","group":"7311bc5c.585f8c","order":5,"width":6,"height":1,"passthru":false,"label":"Settings","tooltip":"","color":"#757575","bgcolor":"white","icon":"","payload":"1","payloadType":"num","topic":"","x":140,"y":280,"wires":[["9f92ccc0.54cce"]]},{"id":"c5d38faa.daf39","type":"ui_button","z":"b764cb6a.5d4448","name":"","group":"10ebbb77.a2d955","order":2,"width":0,"height":0,"passthru":false,"label":"Back to menu","tooltip":"","color":"#757575","bgcolor":"#e0e0e0","icon":"","payload":"1","payloadType":"num","topic":"","x":130,"y":240,"wires":[["9f92ccc0.54cce"]]},{"id":"9bd5c687.479be","type":"ui_button","z":"b764cb6a.5d4448","name":"","group":"cafd8af.6569df8","order":6,"width":"6","height":"1","passthru":false,"label":"Back to main","tooltip":"","color":"#757575","bgcolor":"#e0e0e0","icon":"","payload":"0","payloadType":"num","topic":"","x":130,"y":320,"wires":[["9f92ccc0.54cce"]]},{"id":"762e7361.5e873c","type":"inject","z":"e2318.a76b94e88","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":90,"y":360,"wires":[["e06a56f5.07555"]]},{"id":"925cc417.202cf8","type":"change","z":"e2318.a76b94e88","name":"","rules":[{"t":"set","p":"pid_log","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":330,"y":400,"wires":[[]]},{"id":"e06a56f5.07555","type":"ui_switch","z":"e2318.a76b94e88","name":"","label":"PID calculation","tooltip":"","group":"8d73628b.8b862","order":5,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":280,"y":360,"wires":[["925cc417.202cf8"]]},{"id":"febd6b09.61a13","type":"ui_text","z":"cae39ee2.e2c898","group":"f3e4e5c9.37f76","order":1,"width":2,"height":1,"name":"BK temperature display (raw)","label":"Kettle","format":"{{msg.payload | number:1}}°C","layout":"col-center","x":790,"y":260,"wires":[]},{"id":"a976caa4.3cc9c8","type":"ui_text","z":"1e878673.29136a","group":"f3e4e5c9.37f76","order":2,"width":2,"height":1,"name":"Kettle target","label":"Target","format":"{{payload | number:1}}°C","layout":"col-center","x":770,"y":300,"wires":[]},{"id":"ba784964.a939d8","type":"inject","z":"e2318.a76b94e88","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"0.25","payloadType":"num","x":90,"y":200,"wires":[["5cd0d2b3.69de94"]]},{"id":"517a35da.a5c324","type":"change","z":"e2318.a76b94e88","name":"","rules":[{"t":"set","p":"temp_log_delta","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":350,"y":240,"wires":[[]]},{"id":"817523f5.3814c","type":"change","z":"1e878673.29136a","name":"","rules":[{"t":"set","p":"temp-BK","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":190,"y":60,"wires":[[]]},{"id":"4ba13c64.7fce34","type":"influxdb in","z":"e2318.a76b94e88","influxdb":"63e15812.768e7","name":"Find last logged temp in influxdb","query":"","rawOutput":false,"precision":"","retentionPolicy":"","x":420,"y":680,"wires":[["112bb0fd.24915f"]]},{"id":"112bb0fd.24915f","type":"function","z":"e2318.a76b94e88","name":"Construct log entry","func":"if(msg.payload.length === 0 || Math.abs(msg.payload[0].last - global.get(msg.topic)) >= global.get(\"temp_log_delta\")){\nmsg.payload = [\n    {\n        measurement: msg.topic,\n        fields: {\n            temperature: global.get(msg.topic),\n            brew: global.get(\"brew-label\")\n        },\n        timestamp: new Date()\n    }\n];\nreturn msg}else {\n    return null\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":410,"y":720,"wires":[["773e9b21.018914"]]},{"id":"e5443a71.7e01c","type":"function","z":"e2318.a76b94e88","name":"Construct query to influxdb","func":"msg.query = `SELECT last(value) FROM \"${msg.topic}\"`\nreturn msg","outputs":1,"noerr":0,"initialize":"","finalize":"","x":360,"y":640,"wires":[["4ba13c64.7fce34"]]},{"id":"283738a.ba96248","type":"switch","z":"e2318.a76b94e88","name":"Temp logging on?","property":"temp_log","propertyType":"global","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":290,"y":600,"wires":[["e5443a71.7e01c"]]},{"id":"89ec63cb.ac191","type":"link in","z":"e2318.a76b94e88","name":"","links":["33b1f220.5f8056","737daba5.b4f1e4","86751c96.8bee98"],"x":155,"y":600,"wires":[["283738a.ba96248"]]},{"id":"533873ab.10d324","type":"link in","z":"e2318.a76b94e88","name":"Boil PID logger","links":["be75bc65.2c4a58","fd3d823.f4d7d8"],"x":155,"y":900,"wires":[["932f0ea8.64df38"]]},{"id":"8a3e8034.22722","type":"switch","z":"e2318.a76b94e88","name":"PID logging on?","property":"pid_log","propertyType":"global","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":520,"y":1040,"wires":[["a2246972.90d548"]]},{"id":"326c6ce6.ae357c","type":"inject","z":"e2318.a76b94e88","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":90,"y":280,"wires":[["a6f2d908.bb244"]]},{"id":"c32f7928.302f","type":"change","z":"e2318.a76b94e88","name":"","rules":[{"t":"set","p":"output_log","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":320,"wires":[[]]},{"id":"a6f2d908.bb244","type":"ui_switch","z":"e2318.a76b94e88","name":"","label":"GPIO Output","tooltip":"","group":"8d73628b.8b862","order":4,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":270,"y":280,"wires":[["c32f7928.302f"]]},{"id":"5cd0d2b3.69de94","type":"ui_numeric","z":"e2318.a76b94e88","name":"","label":"Threshold","tooltip":"","group":"8d73628b.8b862","order":3,"width":0,"height":0,"wrap":false,"passthru":true,"topic":"","format":"{{value}}°C","min":0,"max":"2","step":"0.05","x":260,"y":200,"wires":[["517a35da.a5c324"]]},{"id":"7157ddb4.749094","type":"function","z":"e2318.a76b94e88","name":"Format output for influxdb","func":"msg.payload = [\n    {\n        measurement: \"PID-mash-inner-loop\",\n        fields: {\n            target: msg.inner_target,\n            output: msg.inner_output,\n            error: msg.last_inner_error,\n            integrator: msg.inner_integrator,\n            derivative: msg.inner_derivative,\n            //active: global.get(\"rims_on\"),\n            brew: global.get(\"brew-label\")\n        },\n        timestamp: new Date()\n    }\n];\nreturn msg;","outputs":1,"noerr":0,"x":1250,"y":1020,"wires":[["8f6e90af.f9fed8"]]},{"id":"7a078bd1.e4aee4","type":"switch","z":"e2318.a76b94e88","name":"PID logging on?","property":"pid_log","propertyType":"global","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":520,"y":920,"wires":[["19de2e51.99dcba"]]},{"id":"8f6e90af.f9fed8","type":"influxdb batch","z":"e2318.a76b94e88","influxdb":"63e15812.768e7","precision":"","retentionPolicy":"","name":"","x":1550,"y":1000,"wires":[]},{"id":"da73f766.a02b1","type":"function","z":"e2318.a76b94e88","name":"Format output for influxdb","func":"msg.payload = [\n    {\n        measurement: \"PID-boil-main-loop\",\n        fields: {\n            target: msg.target,\n            output: msg.output,\n            error: msg.last_error,\n            integrator: msg.integrator,\n            derivative: msg.derivative,\n            //active: global.get(\"bk_pid\"),\n            brew: global.get(\"brew-label\")\n        },\n        timestamp: new Date()\n    }\n];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1250,"y":920,"wires":[["8f6e90af.f9fed8"]]},{"id":"1e6856d6.70ca49","type":"influxdb batch","z":"e2318.a76b94e88","influxdb":"63e15812.768e7","precision":"","retentionPolicy":"","name":"","x":540,"y":840,"wires":[]},{"id":"9873df80.46702","type":"link in","z":"e2318.a76b94e88","name":"RIMS PID logger","links":["d067663f.365a9","f9ae67d0.ea6dc"],"x":155,"y":1040,"wires":[["b9f5c71b.306bc"]]},{"id":"77ce551d.64b6e4","type":"switch","z":"e2318.a76b94e88","name":"Output logging on?","property":"output_log","propertyType":"global","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":530,"y":1120,"wires":[["626a53e.51afbac"]]},{"id":"7b27015a.7c3e2","type":"switch","z":"e2318.a76b94e88","name":"Output logging on?","property":"output_log","propertyType":"global","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":530,"y":960,"wires":[["fab36893.d18ce"]]},{"id":"44af71b8.d965b","type":"function","z":"e2318.a76b94e88","name":"Format output for influxdb","func":"msg.payload = [\n    {\n        measurement: \"output-RIMS\",\n        fields: {\n            duty: msg.payload,\n            brew: global.get(\"brew-label\")\n        },\n        timestamp: new Date()\n    }\n];\nreturn msg;","outputs":1,"noerr":0,"x":1250,"y":1120,"wires":[["8f6e90af.f9fed8"]]},{"id":"718d7f81.ae9dd","type":"function","z":"e2318.a76b94e88","name":"Format output for influxdb","func":"msg.payload = [\n    {\n        measurement: \"output-BK\",\n        fields: {\n            duty: msg.payload,\n            brew: global.get(\"brew-label\")\n        },\n        timestamp: new Date()\n    }\n];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1250,"y":960,"wires":[["8f6e90af.f9fed8"]]},{"id":"6789740.1e4250c","type":"ui_text_input","z":"e2318.a76b94e88","name":"","label":"Brew label","tooltip":"","group":"8d73628b.8b862","order":1,"width":0,"height":0,"passthru":true,"mode":"text","delay":300,"topic":"","x":270,"y":40,"wires":[["37393e3b.2805d2"]]},{"id":"b117af3a.845ea","type":"inject","z":"e2318.a76b94e88","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"untitled","payloadType":"str","x":100,"y":40,"wires":[["6789740.1e4250c"]]},{"id":"37393e3b.2805d2","type":"change","z":"e2318.a76b94e88","name":"","rules":[{"t":"set","p":"brew-label","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":80,"wires":[[]]},{"id":"773e9b21.018914","type":"delay","z":"e2318.a76b94e88","name":"","pauseType":"timed","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"10","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":460,"y":760,"wires":[["90401afe.e9bef"]]},{"id":"ae84c0f1.2800e8","type":"delay","z":"e2318.a76b94e88","name":"","pauseType":"rate","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"5","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":990,"y":1040,"wires":[["f52c348.3c13fc8","7157ddb4.749094"]]},{"id":"1b34c54e.9109cb","type":"delay","z":"e2318.a76b94e88","name":"","pauseType":"rate","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"5","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":990,"y":920,"wires":[["da73f766.a02b1"]]},{"id":"626a53e.51afbac","type":"delay","z":"e2318.a76b94e88","name":"","pauseType":"rate","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"5","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":990,"y":1120,"wires":[["44af71b8.d965b"]]},{"id":"fab36893.d18ce","type":"delay","z":"e2318.a76b94e88","name":"","pauseType":"rate","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"5","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":990,"y":960,"wires":[["718d7f81.ae9dd"]]},{"id":"4086bea3.3fd008","type":"inject","z":"cdc1c9a3.021f58","name":"Default Outer Min","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"0.1","topic":"","payload":"-2","payloadType":"num","x":150,"y":1020,"wires":[["5738a6f.e887cd8","22058548.f4e3ba"]]},{"id":"f882b282.0249e","type":"ui_numeric","z":"cdc1c9a3.021f58","name":"","label":"Min output","tooltip":"","group":"321aaa6a.377d5e","order":10,"width":5,"height":1,"wrap":false,"passthru":true,"topic":"","format":"{{value | number:1}} Δ°C","min":"-10","max":"0","step":1,"x":510,"y":1060,"wires":[["5738a6f.e887cd8"]]},{"id":"5738a6f.e887cd8","type":"change","z":"cdc1c9a3.021f58","name":"","rules":[{"t":"set","p":"outer_min","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":770,"y":1020,"wires":[["49935c6a.faf4a4"]]},{"id":"49935c6a.faf4a4","type":"link out","z":"cdc1c9a3.021f58","name":"Cascade PID Integrator update","links":["ae15465d.e134"],"x":915,"y":1020,"wires":[]},{"id":"f52c348.3c13fc8","type":"function","z":"e2318.a76b94e88","name":"Format output for influxdb","func":"msg.payload = [\n    {\n        measurement: \"PID-mash-outer-loop\",\n        fields: {\n            target: msg.outer_target,\n            output: msg.outer_output,\n            error: msg.last_outer_error,\n            integrator: msg.outer_integrator,\n            derivative: msg.outer_derivative,\n            //active: global.get(\"rims_on\"),\n            brew: global.get(\"brew-label\")\n        },\n        timestamp: new Date()\n    }\n];\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1250,"y":1060,"wires":[["8f6e90af.f9fed8"]]},{"id":"f466a1ed.a97838","type":"ui_dropdown","z":"63bf5070.3b5ef","name":"Mash steps","label":"","tooltip":"","place":"","group":"83f17780.f786e8","order":2,"width":"5","height":"1","passthru":false,"options":[{"label":"Disabled","value":0,"type":"num"},{"label":"1 step","value":"1","type":"str"},{"label":"2 step","value":"2","type":"str"},{"label":"3 step","value":"3","type":"str"},{"label":"4 step","value":"4","type":"str"}],"payload":"","topic":"","x":210,"y":360,"wires":[["2ff2d66.3a38c2a"]]},{"id":"d17fb9af.d69c2","type":"ui_numeric","z":"63bf5070.3b5ef","name":"","label":"Rest 1","tooltip":"","group":"1179e97f.bc9af7","order":1,"width":"4","height":"1","wrap":false,"passthru":true,"topic":"","format":"{{value}}m","min":"1","max":"90","step":1,"x":190,"y":780,"wires":[["e5d3c98.cd9d838"]]},{"id":"cb1de413.57295","type":"ui_numeric","z":"63bf5070.3b5ef","name":"","label":"@","tooltip":"","group":"1179e97f.bc9af7","order":2,"width":"3","height":"1","wrap":false,"passthru":true,"topic":"","format":"{{value}}°C","min":"30","max":"80","step":1,"x":630,"y":780,"wires":[["a4e39ef0.c7cf78"]]},{"id":"5e4f1509.405644","type":"function","z":"63bf5070.3b5ef","name":"Show/Hide rests","func":"if(flow.get('mash_steps') === 0){msg.payload = {group:{hide:[\"Mash_Schedule_Control1\", \"Mash_Schedule_Control3\", \"Mash_Schedule_Rest4\", \"Mash_Schedule_Rest3\", \"Mash_Schedule_Rest2\", \"Mash_Schedule_Rest1\", \"Mash_Schedule_Rest4b\", \"Mash_Schedule_Rest3b\", \"Mash_Schedule_Rest2b\", \"Mash_Schedule_Rest1b\"]}}}\nif(flow.get('mash_steps') == 1){msg.payload = {group:{hide:[\"Mash_Schedule_Rest4\", \"Mash_Schedule_Rest3\", \"Mash_Schedule_Rest2\", \"Mash_Schedule_Rest4b\", \"Mash_Schedule_Rest3b\", \"Mash_Schedule_Rest2b\", \"Mash_Schedule_Rest1b\"], show:[\"Mash_Schedule_Control1\", \"Mash_Schedule_Control3\", \"Mash_Schedule_Rest1\"]}}}\nif(flow.get('mash_steps') == 2){msg.payload = {group:{hide:[\"Mash_Schedule_Rest4\", \"Mash_Schedule_Rest3\", \"Mash_Schedule_Rest4b\", \"Mash_Schedule_Rest3b\", \"Mash_Schedule_Rest2b\", \"Mash_Schedule_Rest1b\"], show:[\"Mash_Schedule_Control1\", \"Mash_Schedule_Control3\", \"Mash_Schedule_Rest1\", \"Mash_Schedule_Rest2\"]}}}\nif(flow.get('mash_steps') == 3){msg.payload = {group:{hide:[\"Mash_Schedule_Rest4\", \"Mash_Schedule_Rest4b\", \"Mash_Schedule_Rest3b\", \"Mash_Schedule_Rest2b\", \"Mash_Schedule_Rest1b\"], show:[\"Mash_Schedule_Control1\", \"Mash_Schedule_Control3\", \"Mash_Schedule_Rest1\", \"Mash_Schedule_Rest2\", \"Mash_Schedule_Rest3\"]}}}\nif(flow.get('mash_steps') == 4){msg.payload = {group:{hide:[\"Mash_Schedule_Rest4b\", \"Mash_Schedule_Rest3b\", \"Mash_Schedule_Rest2b\", \"Mash_Schedule_Rest1b\"], show:[\"Mash_Schedule_Control1\", \"Mash_Schedule_Control3\", \"Mash_Schedule_Rest1\", \"Mash_Schedule_Rest2\", \"Mash_Schedule_Rest3\", \"Mash_Schedule_Rest4\"]}}}\nreturn msg;","outputs":1,"noerr":0,"x":660,"y":360,"wires":[["1b46ac12.e4b14c"]]},{"id":"bddadb06.835ee","type":"ui_numeric","z":"63bf5070.3b5ef","name":"","label":"Rest 4","tooltip":"","group":"f84fb672.0531a","order":1,"width":"4","height":"1","wrap":false,"passthru":true,"topic":"","format":"{{value}}m","min":"1","max":"90","step":1,"x":190,"y":1080,"wires":[["ea85b735.214a7"]]},{"id":"bc683a89.760fd8","type":"ui_numeric","z":"63bf5070.3b5ef","name":"","label":"@","tooltip":"","group":"f84fb672.0531a","order":2,"width":"3","height":"1","wrap":false,"passthru":true,"topic":"","format":"{{value}}°C","min":"35","max":"80","step":1,"x":630,"y":1080,"wires":[["cb656be3.4b4d4"]]},{"id":"851501c6.ca2178","type":"ui_numeric","z":"63bf5070.3b5ef","name":"","label":"Rest 3","tooltip":"","group":"9dc5814c.bca5a8","order":1,"width":"4","height":"1","wrap":false,"passthru":true,"topic":"","format":"{{value}}m","min":"1","max":"90","step":1,"x":190,"y":980,"wires":[["90d8dd29.413ec8"]]},{"id":"8cdba786.3fd958","type":"ui_numeric","z":"63bf5070.3b5ef","name":"","label":"@","tooltip":"","group":"9dc5814c.bca5a8","order":2,"width":"3","height":"1","wrap":false,"passthru":true,"topic":"","format":"{{value}}°C","min":"35","max":"80","step":1,"x":630,"y":980,"wires":[["12b1a235.6fa38e"]]},{"id":"2a829cd0.ad4e84","type":"ui_numeric","z":"63bf5070.3b5ef","name":"","label":"Rest 2","tooltip":"","group":"90c79ee1.d905d","order":1,"width":"4","height":"1","wrap":false,"passthru":true,"topic":"","format":"{{value}}m","min":"1","max":"90","step":1,"x":190,"y":880,"wires":[["130db635.61a012"]]},{"id":"467d60ea.f9a788","type":"ui_numeric","z":"63bf5070.3b5ef","name":"","label":"@","tooltip":"","group":"90c79ee1.d905d","order":2,"width":"3","height":"1","wrap":false,"passthru":true,"topic":"","format":"{{value}}°C","min":"35","max":"80","step":1,"x":630,"y":880,"wires":[["13eed2c9.c5297d"]]},{"id":"5a1035e0.c866f4","type":"inject","z":"63bf5070.3b5ef","name":"","repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"0","payloadType":"num","x":150,"y":320,"wires":[["f466a1ed.a97838"]]},{"id":"7df49907.8ed9e","type":"inject","z":"63bf5070.3b5ef","name":"Initialize lengths","repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"10","payloadType":"num","x":180,"y":740,"wires":[["d17fb9af.d69c2","2a829cd0.ad4e84","851501c6.ca2178","bddadb06.835ee"]]},{"id":"89693aef.3ea6e","type":"inject","z":"63bf5070.3b5ef","name":"Initialize temp","repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"35","payloadType":"num","x":620,"y":740,"wires":[["cb1de413.57295","467d60ea.f9a788","8cdba786.3fd958","bc683a89.760fd8"]]},{"id":"2ff2d66.3a38c2a","type":"change","z":"63bf5070.3b5ef","name":"","rules":[{"t":"set","p":"mash_steps","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":440,"y":360,"wires":[["5e4f1509.405644","a847d83d.160238"]]},{"id":"e5d3c98.cd9d838","type":"change","z":"63bf5070.3b5ef","name":"","rules":[{"t":"set","p":"rest1_length","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":280,"y":820,"wires":[["93de0fca.44a678"]]},{"id":"130db635.61a012","type":"change","z":"63bf5070.3b5ef","name":"","rules":[{"t":"set","p":"rest2_length","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":280,"y":920,"wires":[["5f0dbf91.9d856"]]},{"id":"12b1a235.6fa38e","type":"change","z":"63bf5070.3b5ef","name":"","rules":[{"t":"set","p":"rest3_temp","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":710,"y":1020,"wires":[["a1d88e6f.1e26"]]},{"id":"ea85b735.214a7","type":"change","z":"63bf5070.3b5ef","name":"","rules":[{"t":"set","p":"rest4_length","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":280,"y":1120,"wires":[["2c7b5058.6aa4f"]]},{"id":"cb656be3.4b4d4","type":"change","z":"63bf5070.3b5ef","name":"","rules":[{"t":"set","p":"rest4_temp","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":710,"y":1120,"wires":[["c329d3a7.3b88c8"]]},{"id":"90d8dd29.413ec8","type":"change","z":"63bf5070.3b5ef","name":"","rules":[{"t":"set","p":"rest3_length","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":280,"y":1020,"wires":[["d24d96a4.090d1"]]},{"id":"13eed2c9.c5297d","type":"change","z":"63bf5070.3b5ef","name":"","rules":[{"t":"set","p":"rest2_temp","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":710,"y":920,"wires":[["138f8790.83226"]]},{"id":"a4e39ef0.c7cf78","type":"change","z":"63bf5070.3b5ef","name":"","rules":[{"t":"set","p":"rest1_temp","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":710,"y":820,"wires":[["bb0fe482.3f05f"]]},{"id":"f437f9ec.a69108","type":"ui_dropdown","z":"63bf5070.3b5ef","name":"Start time","label":"","tooltip":"","place":"","group":"252bb944.ff43b6","order":2,"width":"5","height":"1","passthru":false,"options":[{"label":"Start now","value":"now","type":"str"},{"label":"Delay start by...","value":"delay","type":"str"},{"label":"Resume at...","value":"resume","type":"str"}],"payload":"","topic":"","x":200,"y":600,"wires":[["cdb1a3bc.df7848"]]},{"id":"4cc8ed06.3ac24c","type":"function","z":"63bf5070.3b5ef","name":"Show/Hide scheduler","func":"if(flow.get('mash_start') == \"now\"){\n    msg.payload = {group:{hide:[\"Mash_Schedule_Control2\"]}}}else {\n        msg.payload = {group:{show:[\"Mash_Schedule_Control2\"]}}}\nreturn msg;","outputs":1,"noerr":0,"x":640,"y":600,"wires":[["7a03f1f6.016058"]]},{"id":"d22a9508.204f58","type":"inject","z":"63bf5070.3b5ef","name":"","repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"now","payloadType":"str","x":150,"y":560,"wires":[["f437f9ec.a69108"]]},{"id":"676ad0fb.e7aff","type":"ui_numeric","z":"63bf5070.3b5ef","name":"Minutes","label":"","tooltip":"","group":"172eb1b5.c3e3ee","order":3,"width":"3","height":"1","wrap":false,"passthru":true,"topic":"","format":"{{value}}m","min":"0","max":"59","step":1,"x":300,"y":680,"wires":[[]]},{"id":"faa8301b.a20c8","type":"ui_numeric","z":"63bf5070.3b5ef","name":"Hours","label":"","tooltip":"","group":"172eb1b5.c3e3ee","order":2,"width":"3","height":"1","wrap":false,"passthru":true,"topic":"","format":"{{value}}h","min":"0","max":"12","step":1,"x":150,"y":680,"wires":[[]]},{"id":"305183a7.126c34","type":"ui_button","z":"63bf5070.3b5ef","name":"","group":"d360e2ce.52a2e","order":2,"width":"5","height":1,"passthru":false,"label":"Run","tooltip":"","color":"","bgcolor":"{{colour}}","icon":"","payload":"true","payloadType":"bool","topic":"","x":210,"y":1340,"wires":[["6a7606c1.17f89"]]},{"id":"9bc84258.87c2c","type":"ui_button","z":"b764cb6a.5d4448","name":"","group":"7311bc5c.585f8c","order":4,"width":6,"height":1,"passthru":false,"label":"Mash Schedule","tooltip":"","color":"#757575","bgcolor":"white","icon":"","payload":"5","payloadType":"num","topic":"","x":120,"y":520,"wires":[["9f92ccc0.54cce"]]},{"id":"29f96ade.94bd76","type":"ui_button","z":"b764cb6a.5d4448","name":"","group":"906481c9.a63c5","order":2,"width":"5","height":"1","passthru":false,"label":"Back","tooltip":"","color":"#757575","bgcolor":"#e0e0e0","icon":"","payload":"0","payloadType":"num","topic":"","x":150,"y":560,"wires":[["9f92ccc0.54cce"]]},{"id":"ab2f155d.1fad9","type":"inject","z":"63bf5070.3b5ef","name":"","repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"false","payloadType":"bool","x":350,"y":1300,"wires":[["ab2cf9d9.d7b608"]]},{"id":"6a7606c1.17f89","type":"switch","z":"63bf5070.3b5ef","name":"","property":"scheduler","propertyType":"global","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":350,"y":1340,"wires":[["ab2cf9d9.d7b608"],["98ac5977.dd62c"]]},{"id":"ab2cf9d9.d7b608","type":"change","z":"63bf5070.3b5ef","name":"Switch off","rules":[{"t":"set","p":"scheduler","pt":"global","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":1320,"wires":[["d185935b.1237e8"]]},{"id":"98ac5977.dd62c","type":"change","z":"63bf5070.3b5ef","name":"Switch on","rules":[{"t":"set","p":"scheduler","pt":"global","to":"true","tot":"bool"},{"t":"set","p":"click_time","pt":"flow","to":"","tot":"date"},{"t":"set","p":"payload","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":1360,"wires":[["d185935b.1237e8"]]},{"id":"66c3f49f.697fc4","type":"change","z":"63bf5070.3b5ef","name":"off colour","rules":[{"t":"set","p":"colour","pt":"msg","to":"grey","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":1560,"wires":[["bffa68a9.568ef"]]},{"id":"becb32d8.0aa158","type":"change","z":"63bf5070.3b5ef","name":"on colour","rules":[{"t":"set","p":"colour","pt":"msg","to":"#66cc00","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":1520,"wires":[["bffa68a9.568ef"]]},{"id":"8779375b.9c212","type":"switch","z":"63bf5070.3b5ef","name":"Scheduler state","property":"scheduler","propertyType":"global","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":320,"y":1540,"wires":[["becb32d8.0aa158"],["66c3f49f.697fc4"]]},{"id":"96329c51.1e017","type":"delay","z":"63bf5070.3b5ef","name":"delay","pauseType":"delay","timeout":"0.2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":250,"y":1500,"wires":[["8779375b.9c212"]]},{"id":"bffa68a9.568ef","type":"link out","z":"63bf5070.3b5ef","name":"Run button colour","links":["170a4f75.2c8519"],"x":615,"y":1540,"wires":[]},{"id":"43a1ff6f.bd228","type":"link in","z":"63bf5070.3b5ef","name":"Scheduler update","links":["d185935b.1237e8"],"x":135,"y":1500,"wires":[["96329c51.1e017"]]},{"id":"d185935b.1237e8","type":"link out","z":"63bf5070.3b5ef","name":"Scheduler update","links":["43a1ff6f.bd228","338b293b.ddf14e","f162ab2d.ccb918"],"x":615,"y":1340,"wires":[]},{"id":"170a4f75.2c8519","type":"link in","z":"63bf5070.3b5ef","name":"Run button colour","links":["bffa68a9.568ef"],"x":115,"y":1340,"wires":[["305183a7.126c34"]]},{"id":"ab79b997.48a6a8","type":"ui_ui_control","z":"63bf5070.3b5ef","name":"Dashboard connection","events":"all","x":220,"y":60,"wires":[["ceec1878.64cb48"]]},{"id":"ceec1878.64cb48","type":"link out","z":"63bf5070.3b5ef","name":"Connection established","links":["24eab2c8.807e0e","36cca10a.399796","93ea0cbc.43c118"],"x":355,"y":60,"wires":[]},{"id":"93ea0cbc.43c118","type":"link in","z":"63bf5070.3b5ef","name":"initialization","links":["ceec1878.64cb48"],"x":175,"y":1540,"wires":[["8779375b.9c212"]]},{"id":"cdb1a3bc.df7848","type":"change","z":"63bf5070.3b5ef","name":"","rules":[{"t":"set","p":"mash_start","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":600,"wires":[["4cc8ed06.3ac24c"]]},{"id":"24eab2c8.807e0e","type":"link in","z":"63bf5070.3b5ef","name":"Initialization","links":["ceec1878.64cb48"],"x":475,"y":560,"wires":[["4cc8ed06.3ac24c"]]},{"id":"36cca10a.399796","type":"link in","z":"63bf5070.3b5ef","name":"Initialization","links":["ceec1878.64cb48"],"x":515,"y":320,"wires":[["5e4f1509.405644"]]},{"id":"4385db5d.12e2ac","type":"link in","z":"63bf5070.3b5ef","name":"UI dynamics","links":["1b46ac12.e4b14c","7a03f1f6.016058","fda473b1.51713","8baaa2a6.c6868","3cbb5cc7.3c7574","56ee58aa.afc3a","3e67f7fe.b049d"],"x":75,"y":60,"wires":[["ab79b997.48a6a8"]]},{"id":"1b46ac12.e4b14c","type":"link out","z":"63bf5070.3b5ef","name":"Rest # selector","links":["4385db5d.12e2ac"],"x":775,"y":360,"wires":[]},{"id":"7a03f1f6.016058","type":"link out","z":"63bf5070.3b5ef","name":"Scheduler visibility","links":["4385db5d.12e2ac"],"x":775,"y":600,"wires":[]},{"id":"595dd666.827888","type":"ui_text","z":"63bf5070.3b5ef","group":"beea0165.6e28f8","order":5,"width":0,"height":0,"name":"","label":"Current time","format":"{{msg.payload}}","layout":"row-spread","x":650,"y":2160,"wires":[]},{"id":"8e92816a.86ec5","type":"inject","z":"63bf5070.3b5ef","name":"","repeat":"1","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":290,"y":2160,"wires":[["595dd666.827888"]]},{"id":"66aa9601.7f4808","type":"inject","z":"63bf5070.3b5ef","name":"","repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":210,"y":1960,"wires":[["6875bf28.6e1f08"]]},{"id":"6875bf28.6e1f08","type":"change","z":"63bf5070.3b5ef","name":"","rules":[{"t":"set","p":"step","pt":"flow","to":"3","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":390,"y":1960,"wires":[[]]},{"id":"5cc4c3e2.4a43ac","type":"ui_text","z":"63bf5070.3b5ef","group":"beea0165.6e28f8","order":6,"width":0,"height":0,"name":"","label":"Current target temperature","format":"{{msg.payload}}","layout":"row-spread","x":700,"y":2200,"wires":[]},{"id":"d6038c5b.75264","type":"inject","z":"63bf5070.3b5ef","name":"","repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"50","payloadType":"num","x":310,"y":2200,"wires":[["5cc4c3e2.4a43ac"]]},{"id":"26dc6d59.e9d762","type":"ui_text","z":"63bf5070.3b5ef","group":"beea0165.6e28f8","order":1,"width":0,"height":0,"name":"Process stage","label":"","format":"{{msg.payload}}","layout":"col-center","x":660,"y":2000,"wires":[]},{"id":"20cb7530.3e331a","type":"ui_template","z":"364af11b.32788e","group":"f6e1ef23.f6f118","name":"Mash Bolt","order":2,"width":3,"height":2,"format":"<div style=\"overflow-y:visible !important; position:absolute; left:10px\">\n<ng-md-icon icon=\"{{(msg.bk_lock || false) ? 'flash_off' : 'flash_on'}}\" size=115 style=\"{{(msg.rims_on || false) ? 'fill: gold' : 'fill: grey'}}; margin-top:-34px\"></ng-md-icon>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":530,"y":80,"wires":[[]]},{"id":"f6b4b919.bce3c","type":"link in","z":"364af11b.32788e","name":"BK bolt","links":["395c51b.611aa2e","45708f26.3186e","7eb452a8.843114","9ae6b3bc.013dd8"],"x":55,"y":80,"wires":[["7dac4729.853eb"]]},{"id":"7dac4729.853eb","type":"change","z":"364af11b.32788e","name":"Bolt updates","rules":[{"t":"set","p":"bk_lock","pt":"msg","to":"bk_lock","tot":"global"},{"t":"set","p":"rims_lock","pt":"msg","to":"rims_lock","tot":"global"},{"t":"set","p":"rims_on","pt":"msg","to":"rims_on","tot":"global"},{"t":"set","p":"bk_on","pt":"msg","to":"bk_on","tot":"global"},{"t":"delete","p":"socketid","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":350,"y":60,"wires":[["20cb7530.3e331a","1a3af3f1.488dec"]]},{"id":"1a3af3f1.488dec","type":"ui_template","z":"364af11b.32788e","group":"9fe30f36.92cc2","name":"Boil Bolt","order":2,"width":3,"height":2,"format":"<div style=\"overflow-y:visible !important; position:absolute; left:10px\">\n<ng-md-icon icon=\"{{(msg.rims_lock || false) ? 'flash_off' : 'flash_on'}}\" size=115 style=\"{{(msg.bk_on || false) ? 'fill: gold' : 'fill: grey'}}; margin-top:-34px\"></ng-md-icon>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":520,"y":40,"wires":[[]]},{"id":"55dd882f.b9595","type":"ui_template","z":"63bf5070.3b5ef","group":"beea0165.6e28f8","name":"Progress bar","order":2,"width":"7","height":"1","format":"<div>\n<md-progress-linear md-mode=\"{{msg.wait ? 'indeterminate' : 'determinate'}}\" value={{msg.payload}}></md-progress-linear>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":650,"y":2040,"wires":[[]]},{"id":"a7b6ba2d.069708","type":"function","z":"63bf5070.3b5ef","name":"indeterminate or determinate","func":"if(flow.get('step') in [1, 3, 5, 7]){msg.wait = true} else{\n    msg.wait = false}\nreturn msg;","outputs":1,"noerr":0,"x":440,"y":2040,"wires":[["55dd882f.b9595"]]},{"id":"a847d83d.160238","type":"link out","z":"63bf5070.3b5ef","name":"","links":["90aed32f.aa8cc","d917c6a3.69917"],"x":595,"y":400,"wires":[]},{"id":"23b581b3.6c2396","type":"ui_text","z":"63bf5070.3b5ef","group":"beea0165.6e28f8","order":3,"width":0,"height":0,"name":"","label":"Total schedule length","format":"{{msg.payload}}m","layout":"row-spread","x":680,"y":2120,"wires":[]},{"id":"bf194183.f00a2","type":"function","z":"63bf5070.3b5ef","name":"Schedule length","func":"msg.payload = 0.0\nif(flow.get('mash_steps') >= 1){msg.payload += flow.get('rest1_length')}\nif(flow.get('mash_steps') >= 2){msg.payload += flow.get('rest2_length')}\nif(flow.get('mash_steps') >= 3){msg.payload += flow.get('rest3_length')}\nif(flow.get('mash_steps') >= 4){msg.payload += flow.get('rest4_length')}\nflow.set('schedule_length', msg.payload)\nreturn msg;\n","outputs":1,"noerr":0,"x":280,"y":2120,"wires":[["23b581b3.6c2396"]]},{"id":"90aed32f.aa8cc","type":"link in","z":"63bf5070.3b5ef","name":"Update schedule length","links":["2c7b5058.6aa4f","5f0dbf91.9d856","93de0fca.44a678","a847d83d.160238","d24d96a4.090d1"],"x":135,"y":2120,"wires":[["bf194183.f00a2"]]},{"id":"52ec6585.c890d4","type":"function","z":"63bf5070.3b5ef","name":"Plain text process stage","func":"if(flow.get('step') === 0){msg.payload=\"Not running\"}\nif(flow.get('step') == 1){msg.payload=\"Heating to rest 1\"}\nif(flow.get('step') == 2){msg.payload=\"Rest 1\"}\nif(flow.get('step') == 3){msg.payload=\"Heating to rest 2\"}\nif(flow.get('step') == 4){msg.payload=\"Rest 2\"}\nif(flow.get('step') == 5){msg.payload=\"Heating to rest 3\"}\nif(flow.get('step') == 6){msg.payload=\"Rest 3\"}\nif(flow.get('step') == 7){msg.payload=\"Heating to rest 4\"}\nif(flow.get('step') == 8){msg.payload=\"Rest 4\"}\nif(flow.get('step') == 10){msg.payload=\"Mash schedule completed!\"}\nreturn msg;","outputs":1,"noerr":0,"x":430,"y":2000,"wires":[["26dc6d59.e9d762"]]},{"id":"a25801f5.68434","type":"inject","z":"63bf5070.3b5ef","name":"","repeat":"2","crontab":"","once":true,"onceDelay":"0.5","topic":"","payload":"0","payloadType":"num","x":190,"y":2000,"wires":[["52ec6585.c890d4","a7b6ba2d.069708"]]},{"id":"a5709621.37ba3","type":"ui_template","z":"63bf5070.3b5ef","group":"15398f9f.83813","name":"Read only rest1","order":2,"width":"5","height":"1","format":"<div ng-bind-html=\"msg.payload\" style=\"padding-left: 11px; color: grey\"></div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":680,"y":1740,"wires":[[]]},{"id":"b523d16f.386e18","type":"function","z":"63bf5070.3b5ef","name":"rest1 length and temp","func":"msg.payload = `Rest 1 ${flow.get('rest1_length')}m @ ${flow.get('rest1_temp')}°C`;\nreturn msg;","outputs":1,"noerr":0,"x":420,"y":1740,"wires":[["a5709621.37ba3"]]},{"id":"670119ef.89305","type":"ui_template","z":"63bf5070.3b5ef","group":"29628e25.36ae0a","name":"Read only Mash steps","order":2,"width":"5","height":"1","format":"<div ng-bind-html=\"msg.payload\" style=\"padding-left: 11px; color: grey\"></div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":700,"y":1700,"wires":[[]]},{"id":"9f745603.9b7fc","type":"function","z":"63bf5070.3b5ef","name":"Read only mash steps text","func":"if(flow.get('mash_steps') === 0){msg.payload = \"Disabled\"}\nif(flow.get('mash_steps') == 1){msg.payload = \"1 step\"}\nif(flow.get('mash_steps') == 2){msg.payload = \"2 step\"}\nif(flow.get('mash_steps') == 3){msg.payload = \"3 step\"}\nif(flow.get('mash_steps') == 4){msg.payload = \"4 step\"}\nreturn msg;","outputs":1,"noerr":0,"x":440,"y":1700,"wires":[["670119ef.89305"]]},{"id":"dff8f160.b9eb18","type":"ui_template","z":"63bf5070.3b5ef","group":"410f13bb.574dec","name":"Read only rest2","order":2,"width":"5","height":"1","format":"<div ng-bind-html=\"msg.payload\" style=\"padding-left: 11px; color: grey\"></div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":680,"y":1780,"wires":[[]]},{"id":"cad09b0.1c2b1e8","type":"ui_template","z":"63bf5070.3b5ef","group":"7bfe7533.f2722c","name":"Read only rest3","order":2,"width":"5","height":"1","format":"<div ng-bind-html=\"msg.payload\" style=\"padding-left: 11px; color: grey\"></div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":680,"y":1820,"wires":[[]]},{"id":"4d3cf55c.74a924","type":"ui_template","z":"63bf5070.3b5ef","group":"9ba87c4a.b57c6","name":"Read only rest4","order":2,"width":"5","height":"1","format":"<div ng-bind-html=\"msg.payload\" style=\"padding-left: 11px; color: grey\"></div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":680,"y":1860,"wires":[[]]},{"id":"338b293b.ddf14e","type":"link in","z":"63bf5070.3b5ef","name":"Scheduler update","links":["d185935b.1237e8"],"x":215,"y":1620,"wires":[["a7e3b69b.00d208"]]},{"id":"a7e3b69b.00d208","type":"function","z":"63bf5070.3b5ef","name":"UI updates","func":"if(global.get('scheduler')){\n    msg.payload = {group:{show:[\"Mash_Schedule_Control4\", \"Mash_Schedule_MASH_SCHEDULE2\", \"Mash_Schedule_MASH_SCHEDULE\"], hide:[\"Mash_Schedule_Control1\", \"Mash_Schedule_Control2\"]}}\n    }else {\n    if(flow.get('mash_start')== \"now\"){\n        msg.payload = {group:{show:[\"Mash_Schedule_MASH_SCHEDULE\", \"Mash_Schedule_Control1\"], hide:[\"Mash_Schedule_MASH_SCHEDULE2\", \"Mash_Schedule_Control4\"]}}\n        }else {\n        msg.payload = {group:{show:[\"Mash_Schedule_MASH_SCHEDULE\", \"Mash_Schedule_Control1\", \"Mash_Schedule_Control2\"], hide:[\"Mash_Schedule_MASH_SCHEDULE2\", \"Mash_Schedule_Control4\"]}}\n        }\n    }\nreturn msg;","outputs":1,"noerr":0,"x":390,"y":1620,"wires":[["56ee58aa.afc3a"]]},{"id":"56ee58aa.afc3a","type":"link out","z":"63bf5070.3b5ef","name":"Timer visibility","links":["4385db5d.12e2ac"],"x":615,"y":1620,"wires":[]},{"id":"eb72f913.6cc39","type":"function","z":"63bf5070.3b5ef","name":"rest2 length and temp","func":"msg.payload = `Rest 2 ${flow.get('rest2_length')}m @ ${flow.get('rest2_temp')}°C`;\nreturn msg;","outputs":1,"noerr":0,"x":420,"y":1780,"wires":[["dff8f160.b9eb18"]]},{"id":"8cf50752.ca77f8","type":"function","z":"63bf5070.3b5ef","name":"rest3 length and temp","func":"msg.payload = `Rest 3 ${flow.get('rest3_length')}m @ ${flow.get('rest3_temp')}°C`;\nreturn msg;","outputs":1,"noerr":0,"x":420,"y":1820,"wires":[["cad09b0.1c2b1e8"]]},{"id":"36faf14f.584a66","type":"function","z":"63bf5070.3b5ef","name":"rest4 length and temp","func":"msg.payload = `Rest 4 ${flow.get('rest4_length')}m @ ${flow.get('rest4_temp')}°C`;\nreturn msg;","outputs":1,"noerr":0,"x":420,"y":1860,"wires":[["4d3cf55c.74a924"]]},{"id":"aaa46480.e5f9d8","type":"link in","z":"63bf5070.3b5ef","name":"rest1 read only","links":["93de0fca.44a678","bb0fe482.3f05f"],"x":215,"y":1740,"wires":[["b523d16f.386e18"]]},{"id":"8a1f8a26.5c1dd8","type":"link in","z":"63bf5070.3b5ef","name":"rest2 read only","links":["138f8790.83226","5f0dbf91.9d856"],"x":215,"y":1780,"wires":[["eb72f913.6cc39"]]},{"id":"9e521a87.621e1","type":"link in","z":"63bf5070.3b5ef","name":"rest 3 read only","links":["a1d88e6f.1e26","d24d96a4.090d1"],"x":215,"y":1820,"wires":[["8cf50752.ca77f8"]]},{"id":"a3831aa1.cd8a08","type":"link in","z":"63bf5070.3b5ef","name":"rest4 read only","links":["2c7b5058.6aa4f","c329d3a7.3b88c8"],"x":215,"y":1860,"wires":[["36faf14f.584a66"]]},{"id":"93de0fca.44a678","type":"link out","z":"63bf5070.3b5ef","name":"rest1 length","links":["90aed32f.aa8cc","aaa46480.e5f9d8"],"x":435,"y":820,"wires":[]},{"id":"5f0dbf91.9d856","type":"link out","z":"63bf5070.3b5ef","name":"rest2 length","links":["90aed32f.aa8cc","8a1f8a26.5c1dd8"],"x":435,"y":920,"wires":[]},{"id":"d24d96a4.090d1","type":"link out","z":"63bf5070.3b5ef","name":"rest3 length","links":["90aed32f.aa8cc","9e521a87.621e1"],"x":435,"y":1020,"wires":[]},{"id":"2c7b5058.6aa4f","type":"link out","z":"63bf5070.3b5ef","name":"rest4 length","links":["90aed32f.aa8cc","a3831aa1.cd8a08"],"x":435,"y":1120,"wires":[]},{"id":"bb0fe482.3f05f","type":"link out","z":"63bf5070.3b5ef","name":"rest1 temp","links":["aaa46480.e5f9d8"],"x":855,"y":820,"wires":[]},{"id":"138f8790.83226","type":"link out","z":"63bf5070.3b5ef","name":"rest2 temp","links":["8a1f8a26.5c1dd8"],"x":855,"y":920,"wires":[]},{"id":"a1d88e6f.1e26","type":"link out","z":"63bf5070.3b5ef","name":"rest3 temp","links":["9e521a87.621e1"],"x":855,"y":1020,"wires":[]},{"id":"c329d3a7.3b88c8","type":"link out","z":"63bf5070.3b5ef","name":"rest4 temp","links":["a3831aa1.cd8a08"],"x":855,"y":1120,"wires":[]},{"id":"d917c6a3.69917","type":"link in","z":"63bf5070.3b5ef","name":"Mash step readonly","links":["a847d83d.160238"],"x":215,"y":1700,"wires":[["9f745603.9b7fc"]]},{"id":"e48cc32c.0cdc5","type":"function","z":"63bf5070.3b5ef","name":"Show read only schedule","func":"if(global.get('scheduler')){\n  if(flow.get('mash_steps') === 0){msg.payload = {group:{hide:[\"Mash_Schedule_Control1\", \"Mash_Schedule_Control3\", \"Mash_Schedule_Rest4\", \"Mash_Schedule_Rest3\", \"Mash_Schedule_Rest2\", \"Mash_Schedule_Rest1\", \"Mash_Schedule_Rest4b\", \"Mash_Schedule_Rest3b\", \"Mash_Schedule_Rest2b\", \"Mash_Schedule_Rest1b\"]}}}\n  if(flow.get('mash_steps') == 1){msg.payload = {group:{hide:[\"Mash_Schedule_Rest4\", \"Mash_Schedule_Rest3\", \"Mash_Schedule_Rest2\", \"Mash_Schedule_Rest1\", \"Mash_Schedule_Rest4b\", \"Mash_Schedule_Rest3b\", \"Mash_Schedule_Rest2b\"], show:[\"Mash_Schedule_Control1\", \"Mash_Schedule_Control3\", \"Mash_Schedule_Rest1b\"]}}}\n  if(flow.get('mash_steps') == 2){msg.payload = {group:{hide:[\"Mash_Schedule_Rest4\", \"Mash_Schedule_Rest3\", \"Mash_Schedule_Rest4b\", \"Mash_Schedule_Rest3b\", \"Mash_Schedule_Rest2\", \"Mash_Schedule_Rest1\"], show:[\"Mash_Schedule_Control1\", \"Mash_Schedule_Control3\", \"Mash_Schedule_Rest1b\", \"Mash_Schedule_Rest2b\"]}}}\n  if(flow.get('mash_steps') == 3){msg.payload = {group:{hide:[\"Mash_Schedule_Rest4\", \"Mash_Schedule_Rest4b\", \"Mash_Schedule_Rest3\", \"Mash_Schedule_Rest2\", \"Mash_Schedule_Rest1\"], show:[\"Mash_Schedule_Control1\", \"Mash_Schedule_Control3\", \"Mash_Schedule_Rest1b\", \"Mash_Schedule_Rest2b\", \"Mash_Schedule_Rest3b\"]}}}\n  if(flow.get('mash_steps') == 4){msg.payload = {group:{hide:[\"Mash_Schedule_Rest4\", \"Mash_Schedule_Rest3\", \"Mash_Schedule_Rest2\", \"Mash_Schedule_Rest1\"], show:[\"Mash_Schedule_Control1\", \"Mash_Schedule_Control3\", \"Mash_Schedule_Rest1b\", \"Mash_Schedule_Rest2b\", \"Mash_Schedule_Rest3b\", \"Mash_Schedule_Rest4b\"]}}}}\nreturn msg;\n","outputs":1,"noerr":0,"x":430,"y":1660,"wires":[["3e67f7fe.b049d"]]},{"id":"f162ab2d.ccb918","type":"link in","z":"63bf5070.3b5ef","name":"Scheduler update","links":["d185935b.1237e8"],"x":215,"y":1660,"wires":[["e48cc32c.0cdc5"]]},{"id":"3e67f7fe.b049d","type":"link out","z":"63bf5070.3b5ef","name":"Timer visibility","links":["4385db5d.12e2ac"],"x":615,"y":1660,"wires":[]},{"id":"d1ccc506.3e993","type":"ui_template","z":"63bf5070.3b5ef","group":"e069eb40.1f1bf8","name":"","order":3,"width":0,"height":0,"format":"<div style=\"height=0px\"></div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":380,"y":2300,"wires":[[]]},{"id":"bb561ef8.44b17","type":"ui_template","z":"cae39ee2.e2c898","group":"f6e1ef23.f6f118","name":"Big RIMS temp","order":17,"width":2,"height":1,"format":"<div style=\"text-align:right; position: absolute; bottom: 0px; width: 100px\">\n<div style=\"text-align:right\">Actual</div>\n<div style=\"margin-top:-5px\">\n<span style=\"font-size:22px\" ng-bind-html=\"msg.payload\"></span>\n<span style=\"font-size:22px\">°C</span>\n</div></div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":1100,"y":460,"wires":[[]]},{"id":"305b6929.fe6d16","type":"ui_template","z":"cae39ee2.e2c898","group":"f6e1ef23.f6f118","name":"Big MLT temp","order":14,"width":2,"height":1,"format":"<div style=\"text-align:right; position: absolute; bottom: 0px; width: 100px\">\n<div style=\"text-align:right\">Actual</div>\n<div style=\"margin-top:-5px\">\n<span style=\"font-size:22px\" ng-bind-html=\"msg.payload\"></span>\n<span style=\"font-size:22px\">°C</span>\n</div></div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":1100,"y":740,"wires":[[]]},{"id":"b40a4338.ba0198","type":"ui_template","z":"cae39ee2.e2c898","group":"9fe30f36.92cc2","name":"Big BK temp","order":11,"width":2,"height":1,"format":"<div style=\"text-align:right; position: absolute; bottom: 0px; width: 100px\">\n<div style=\"text-align:right\">Actual</div>\n<div style=\"margin-top:-5px\">\n<span style=\"font-size:22px\" ng-bind-html=\"msg.payload\"></span>\n<span style=\"font-size:22px\">°C</span>\n</div></div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":1090,"y":180,"wires":[[]]},{"id":"fff8af13.08779","type":"ui_template","z":"cdc1c9a3.021f58","group":"f6e1ef23.f6f118","name":"Big MLT target","order":15,"width":2,"height":1,"format":"<div style=\"text-align:right; position: absolute; bottom: 0px; width: 100px\">\n<div style=\"text-align:right\">Target</div>\n<div style=\"margin-top:-5px\">\n<span style=\"font-size:22px\" ng-bind-html=\"msg.payload\"></span>\n<span style=\"font-size:22px\">°C</span>\n</div></div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":1120,"y":380,"wires":[[]]},{"id":"6aea0e8f.a5bc3","type":"ui_template","z":"1e878673.29136a","group":"9fe30f36.92cc2","name":"Big BK target","order":12,"width":2,"height":1,"format":"<div style=\"text-align:right; position: absolute; bottom: 0px; width: 100px\">\n<div style=\"text-align:right\">Target</div>\n<div style=\"margin-top:-5px\">\n<span style=\"font-size:22px\" ng-bind-html=\"msg.payload\"></span>\n<span style=\"font-size:22px\">°C</span>\n</div></div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":820,"y":380,"wires":[[]]},{"id":"80d2bcfc.5e1e08","type":"ui_template","z":"4ef08725.8fbdd","group":"f6e1ef23.f6f118","name":"Big RIMS target","order":18,"width":2,"height":1,"format":"<div style=\"text-align:right; position: absolute; bottom: 0px; width: 100px\">\n<div style=\"text-align:right\">Target</div>\n<div style=\"margin-top:-5px\">\n<span style=\"font-size:22px\" ng-bind-html=\"msg.payload\"></span>\n<span style=\"font-size:22px\">°C</span>\n</div></div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":820,"y":480,"wires":[[]]},{"id":"33d3c3e3.2a410c","type":"ui_template","z":"cae39ee2.e2c898","group":"f6e1ef23.f6f118","name":"Big MLT text","order":13,"width":2,"height":1,"format":"<div style=\"position: absolute; bottom: 0px; right:20px\">\n<span style=\"font-size:26px; font-weight:bold; color:#424242\">MLT</span>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":1090,"y":700,"wires":[[]]},{"id":"fae8434.c9fb94","type":"ui_template","z":"cae39ee2.e2c898","group":"f6e1ef23.f6f118","name":"Big RIMS text","order":16,"width":2,"height":1,"format":"<div style=\"position: absolute; bottom: 0px; right:20px\">\n<span style=\"font-size:26px; font-weight:bold; color:#424242\">RIMS</span>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1100,"y":420,"wires":[[]]},{"id":"5ef482f1.1650fc","type":"ui_template","z":"1e878673.29136a","group":"9fe30f36.92cc2","name":"Big Manual duty","order":13,"width":2,"height":1,"format":"<div style=\"text-align:right; position: absolute; bottom: 0px; width: 100px\">\n<div style=\"text-align:right\">Manual</div>\n<div style=\"margin-top:-5px\">\n<span style=\"font-size:22px\" ng-bind-html=\"msg.payload\"></span>\n<span style=\"font-size:22px\">٪</span>\n</div></div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":820,"y":600,"wires":[[]]},{"id":"d2f52568.24c3e","type":"ui_template","z":"44130c7e.f0c1fc","group":"9fe30f36.92cc2","name":"Big BK duty text","order":7,"width":3,"height":1,"format":"<div style=\"text-align:right; position: absolute; bottom: 0px; width: 100px\">\n<span style=\"font-size:32px\" ng-bind-html=\"msg.payload\"></span>\n<span style=\"font-size:28px\">٪</span>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":320,"y":260,"wires":[[]]},{"id":"e4edb7ed.fdbbf","type":"ui_template","z":"44130c7e.f0c1fc","group":"f6e1ef23.f6f118","name":"Big RIMS duty text","order":7,"width":3,"height":1,"format":"<div style=\"text-align:right; position: absolute; bottom: 0px; width: 100px\">\n<span style=\"font-size:32px\" ng-bind-html=\"msg.payload\"></span>\n<span style=\"font-size:28px\">٪</span>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":330,"y":100,"wires":[[]]},{"id":"2bb4ffc5.7108c","type":"ui_template","z":"b764cb6a.5d4448","group":"f6e1ef23.f6f118","name":"Mash module text","order":1,"width":6,"height":1,"format":"<div style=\"text-align:center\">\n<span style=\"font-size:28px; color:#669900\">MASH</span>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":750,"y":100,"wires":[[]]},{"id":"eca57a1f.19db68","type":"ui_template","z":"b764cb6a.5d4448","group":"9fe30f36.92cc2","name":"Boil module text","order":1,"width":6,"height":1,"format":"<div style=\"text-align:center\">\n<span style=\"font-size:28px; color:#669933\">BOIL</span>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":740,"y":140,"wires":[[]]},{"id":"fd6b4eb9.36e42","type":"ui_template","z":"9a84d01.8fdf3b","group":"cd0d2150.b06378","name":"Tap 1 text","order":2,"width":"5","height":"3","format":"<div style=\"text-align:left\">\n<span style=\"font-size:26px\">2019 Cider</span>\n<span style=\"font-size:18px\">6.5%</span>\n</div>\n<div style=\"text-align:left\">\n<span style=\"font-size:18px\">An intense New World-style cider fermented on the pomace of weird little super tannic, red-fleshed crab apples.</span>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":100,"y":140,"wires":[[]]},{"id":"4cdaedd7.aff0e4","type":"ui_button","z":"b764cb6a.5d4448","name":"","group":"7afb5092.447728","order":4,"width":"6","height":1,"passthru":false,"label":"Show tap list","tooltip":"","color":"#757575","bgcolor":"white","icon":"","payload":"6","payloadType":"num","topic":"","x":130,"y":740,"wires":[["b7f4c0cf.90dc48"]]},{"id":"aef314dc.11e368","type":"ui_button","z":"b764cb6a.5d4448","name":"","group":"24e45ac3.c18436","order":2,"width":"6","height":"1","passthru":false,"label":"Back to menu","tooltip":"","color":"#757575","bgcolor":"white","icon":"","payload":"1","payloadType":"num","topic":"","x":120,"y":640,"wires":[["9f92ccc0.54cce"]]},{"id":"ba16f72a.e371","type":"ui_template","z":"9a84d01.8fdf3b","group":"cd0d2150.b06378","name":"Tap 1 number","order":1,"width":"1","height":"3","format":"<div style=\"overflow-x:visible !important; text-align:left\">\n<span style=\"font-size:80px\">1</span>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":120,"y":100,"wires":[[]]},{"id":"4f83f1e2.f79d2","type":"ui_template","z":"9a84d01.8fdf3b","group":"cd0d2150.b06378","name":"Tap 2 text","order":5,"width":"5","height":"3","format":"<div style=\"text-align:left\">\n<span style=\"font-size:26px\">Pils</span>\n<span style=\"font-size:18px\">5.0%</span>\n</div>\n<div style=\"text-align:left\">\n<span style=\"font-size:18px\">A Czech-style pilsner, kinda. Whirlpool and dry hopped with Mt. Hood. Easy mode malt, hard mode yeast, and soft soft water.</span>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":320,"y":140,"wires":[[]]},{"id":"376b4479.dbbcd4","type":"ui_template","z":"9a84d01.8fdf3b","group":"cd0d2150.b06378","name":"Tap 2 number","order":4,"width":"1","height":"3","format":"<div style=\"overflow-x:visible !important; text-align:left\">\n<span style=\"font-size:80px\">2</span>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":340,"y":100,"wires":[[]]},{"id":"ee8a19e8.d83d6","type":"ui_template","z":"9a84d01.8fdf3b","group":"23a56f9a.194898","name":"Tap 3 text","order":2,"width":"5","height":"3","format":"<div style=\"text-align:left\">\n<span style=\"font-size:26px\">DH Sour</span>\n<span style=\"font-size:18px\">6.5%</span>\n</div>\n<div style=\"text-align:left\">\n<span style=\"font-size:18px\">A blend of well aged golden sours, conditioned on 2nd use crabapple pomace (see tap 1), and dry hopped with tons of Mosaic</span>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":540,"y":140,"wires":[[]]},{"id":"ac0dfeef.a0321","type":"ui_template","z":"9a84d01.8fdf3b","group":"23a56f9a.194898","name":"Tap 3 number","order":1,"width":"1","height":"3","format":"<div style=\"overflow-x:visible !important; text-align:left\">\n<span style=\"font-size:80px\">3</span>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":560,"y":100,"wires":[[]]},{"id":"7fe9975e.ebb858","type":"ui_template","z":"9a84d01.8fdf3b","group":"23a56f9a.194898","name":"Tap 4 text","order":5,"width":"5","height":"3","format":"<div style=\"text-align:left\">\n<span style=\"font-size:26px\">Blueberry Sour</span>\n<span style=\"font-size:18px\">6.5%</span>\n</div>\n<div style=\"text-align:left\">\n<span style=\"font-size:18px\">Stainless aged golden sour base refermented with 200g/l of Costco's finest frozen wild blueberries.</span>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":760,"y":140,"wires":[[]]},{"id":"e3e09197.b0b898","type":"ui_template","z":"9a84d01.8fdf3b","group":"23a56f9a.194898","name":"Tap 4 number","order":4,"width":"1","height":"3","format":"<div style=\"overflow-x:visible !important; text-align:left\">\n<span style=\"font-size:80px\">4</span>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":780,"y":100,"wires":[[]]},{"id":"b7f4c0cf.90dc48","type":"change","z":"b764cb6a.5d4448","name":"","rules":[{"t":"delete","p":"socketid","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":720,"wires":[["9f92ccc0.54cce"]]},{"id":"c0d858f1.50d93","type":"ui_button","z":"b764cb6a.5d4448","name":"","group":"7afb5092.447728","order":4,"width":"6","height":1,"passthru":false,"label":"Show main","tooltip":"","color":"#757575","bgcolor":"white","icon":"","payload":"0","payloadType":"num","topic":"","x":130,"y":700,"wires":[["b7f4c0cf.90dc48"]]},{"id":"18f40966.7d4a37","type":"ui_button","z":"b764cb6a.5d4448","name":"","group":"cafd8af.6569df8","order":2,"width":"6","height":1,"passthru":false,"label":"Tap list","tooltip":"","color":"#757575","bgcolor":"white","icon":"","payload":"6","payloadType":"num","topic":"","x":140,"y":600,"wires":[["9f92ccc0.54cce"]]},{"id":"8f0fb258.41cec8","type":"ui_ui_control","z":"cdc1c9a3.021f58","name":"Initialize UI element","events":"connect","x":150,"y":380,"wires":[["b4b53e68.439df"]]},{"id":"d9a8fc6.51d878","type":"change","z":"cdc1c9a3.021f58","name":"mash_target","rules":[{"t":"set","p":"payload","pt":"msg","to":"mash_target","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":380,"wires":[["edaf2c9d.be53","8d2cbd57.ffc7c8"]]},{"id":"c922a8ce.b6c8e8","type":"change","z":"1e878673.29136a","name":"bk_manual_duty","rules":[{"t":"set","p":"payload","pt":"msg","to":"bk_manual_duty","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":600,"wires":[["5ef482f1.1650fc"]]},{"id":"7ffbe7d8.96f4d8","type":"change","z":"1e878673.29136a","name":"bk_target","rules":[{"t":"set","p":"payload","pt":"msg","to":"bk_target","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":380,"wires":[["6aea0e8f.a5bc3"]]},{"id":"4fe29801.47882","type":"link in","z":"44130c7e.f0c1fc","name":"BK Element display 1","links":["fef8865a.aead48","4262b3a2.405a6c"],"x":175,"y":260,"wires":[["d2f52568.24c3e"]]},{"id":"3bcfd4dd.7dc404","type":"link in","z":"44130c7e.f0c1fc","name":"RIMS element display 1","links":["42931abc.fbf8b4","6d289a6.79280e4"],"x":175,"y":100,"wires":[["e4edb7ed.fdbbf"]]},{"id":"fef8865a.aead48","type":"link out","z":"1e878673.29136a","name":"BK element display","links":["4fe29801.47882","e5862b2d.b56798"],"x":775,"y":140,"wires":[]},{"id":"42931abc.fbf8b4","type":"link out","z":"cdc1c9a3.021f58","name":"RIMS element display","links":["3bcfd4dd.7dc404","d712ce59.19ef1"],"x":655,"y":180,"wires":[]},{"id":"b43cdcc1.456bb8","type":"inject","z":"e2318.a76b94e88","name":"Logging initially off","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"false","payloadType":"bool","x":130,"y":480,"wires":[["29089635.cf898a"]]},{"id":"29089635.cf898a","type":"change","z":"e2318.a76b94e88","name":"","rules":[{"t":"set","p":"logging","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":500,"wires":[[]]},{"id":"727528fd.de45d8","type":"inject","z":"e2318.a76b94e88","name":"Logging on after 10 seconds","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"10","topic":"","payload":"true","payloadType":"bool","x":160,"y":520,"wires":[["29089635.cf898a"]]},{"id":"75647670.c514c8","type":"switch","z":"e2318.a76b94e88","name":"logging on","property":"logging","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":330,"y":940,"wires":[["7a078bd1.e4aee4","7b27015a.7c3e2"]]},{"id":"a925e42f.f53d1","type":"switch","z":"e2318.a76b94e88","name":"logging on","property":"logging","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":330,"y":1080,"wires":[["8a3e8034.22722","77ce551d.64b6e4"]]},{"id":"90401afe.e9bef","type":"switch","z":"e2318.a76b94e88","name":"logging on","property":"logging","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":470,"y":800,"wires":[["1e6856d6.70ca49"]]},{"id":"baf3d7f8.899408","type":"function","z":"cae39ee2.e2c898","name":"1 decimal","func":"msg.payload = msg.payload.toFixed(1)\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":900,"y":780,"wires":[["305b6929.fe6d16"]]},{"id":"18ee3bec.ce8b64","type":"function","z":"cae39ee2.e2c898","name":"1 decimal","func":"msg.payload = msg.payload.toFixed(1)\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":900,"y":500,"wires":[["bb561ef8.44b17"]]},{"id":"6d61f157.2b412","type":"function","z":"4ef08725.8fbdd","name":"1 decimal","func":"msg.payload = msg.inner_target.toFixed(1)\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":600,"y":480,"wires":[["80d2bcfc.5e1e08"]]},{"id":"5a16336b.28e93c","type":"ui_dropdown","z":"a61a257b.7ba4d","name":"Mash steps","label":"","tooltip":"","place":"","group":"83f17780.f786e8","order":1,"width":4,"height":1,"passthru":true,"multiple":false,"options":[{"label":"Disabled","value":0,"type":"num"},{"label":"1 step","value":"1","type":"str"},{"label":"2 steps","value":"2","type":"str"},{"label":"3 steps","value":"3","type":"str"},{"label":"4 steps","value":"4","type":"str"}],"payload":"","topic":"","x":350,"y":300,"wires":[["116a8f83.628b1","cdba7ddd.5ed1f"]]},{"id":"5b66c013.2d773","type":"ui_numeric","z":"a61a257b.7ba4d","name":"","label":"Rest 1","tooltip":"","group":"1179e97f.bc9af7","order":1,"width":4,"height":1,"wrap":false,"passthru":true,"topic":"","format":"{{value}}m","min":"0","max":"90","step":"0.1","x":170,"y":680,"wires":[["4cd9a8c5.bebbf"]]},{"id":"b5eff257.0f9748","type":"ui_numeric","z":"a61a257b.7ba4d","name":"","label":"@","tooltip":"","group":"1179e97f.bc9af7","order":2,"width":3,"height":1,"wrap":false,"passthru":true,"topic":"","format":"{{value}}°C","min":"30","max":"80","step":1,"x":610,"y":680,"wires":[["dbb92d16.2eb848"]]},{"id":"ad58667f.9bc18","type":"function","z":"a61a257b.7ba4d","name":"Show/Hide rests","func":"if (!global.get(\"scheduler\")) {\n    if(flow.get('mash_rests') === 0){msg.payload = {group:{hide:[\"Mash_Schedule_Control1\", \"Mash_Schedule_Control3\", \"Mash_Schedule_Rest4\", \"Mash_Schedule_Rest3\", \"Mash_Schedule_Rest2\", \"Mash_Schedule_Rest1\", \"Mash_Schedule_Rest4b\", \"Mash_Schedule_Rest3b\", \"Mash_Schedule_Rest2b\", \"Mash_Schedule_Rest1b\"]}}}\n    if(flow.get('mash_rests') == 1){msg.payload = {group:{hide:[\"Mash_Schedule_Rest4\", \"Mash_Schedule_Rest3\", \"Mash_Schedule_Rest2\", \"Mash_Schedule_Rest4b\", \"Mash_Schedule_Rest3b\", \"Mash_Schedule_Rest2b\", \"Mash_Schedule_Rest1b\"], show:[\"Mash_Schedule_Control1\", \"Mash_Schedule_Control3\", \"Mash_Schedule_Rest1\"]}}}\n    if(flow.get('mash_rests') == 2){msg.payload = {group:{hide:[\"Mash_Schedule_Rest4\", \"Mash_Schedule_Rest3\", \"Mash_Schedule_Rest4b\", \"Mash_Schedule_Rest3b\", \"Mash_Schedule_Rest2b\", \"Mash_Schedule_Rest1b\"], show:[\"Mash_Schedule_Control1\", \"Mash_Schedule_Control3\", \"Mash_Schedule_Rest1\", \"Mash_Schedule_Rest2\"]}}}\n    if(flow.get('mash_rests') == 3){msg.payload = {group:{hide:[\"Mash_Schedule_Rest4\", \"Mash_Schedule_Rest4b\", \"Mash_Schedule_Rest3b\", \"Mash_Schedule_Rest2b\", \"Mash_Schedule_Rest1b\"], show:[\"Mash_Schedule_Control1\", \"Mash_Schedule_Control3\", \"Mash_Schedule_Rest1\", \"Mash_Schedule_Rest2\", \"Mash_Schedule_Rest3\"]}}}\n    if(flow.get('mash_rests') == 4){msg.payload = {group:{hide:[\"Mash_Schedule_Rest4b\", \"Mash_Schedule_Rest3b\", \"Mash_Schedule_Rest2b\", \"Mash_Schedule_Rest1b\"], show:[\"Mash_Schedule_Control1\", \"Mash_Schedule_Control3\", \"Mash_Schedule_Rest1\", \"Mash_Schedule_Rest2\", \"Mash_Schedule_Rest3\", \"Mash_Schedule_Rest4\"]}}}\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":420,"y":1660,"wires":[["6d76bbc1.3317ac"]]},{"id":"1d455894.d1aaff","type":"ui_numeric","z":"a61a257b.7ba4d","name":"","label":"Rest 4","tooltip":"","group":"f84fb672.0531a","order":1,"width":"4","height":1,"wrap":false,"passthru":true,"topic":"","format":"{{value}}m","min":"0","max":"90","step":"0.1","x":190,"y":980,"wires":[["478c432f.bdb53c"]]},{"id":"af845a07.be8fa8","type":"ui_numeric","z":"a61a257b.7ba4d","name":"","label":"@","tooltip":"","group":"f84fb672.0531a","order":2,"width":"3","height":1,"wrap":false,"passthru":true,"topic":"","format":"{{value}}°C","min":"35","max":"80","step":1,"x":610,"y":980,"wires":[["b44d3169.b3fae8"]]},{"id":"bc1990fc.19def","type":"ui_numeric","z":"a61a257b.7ba4d","name":"","label":"Rest 3","tooltip":"","group":"9dc5814c.bca5a8","order":1,"width":4,"height":1,"wrap":false,"passthru":true,"topic":"","format":"{{value}}m","min":"0","max":"90","step":"0.1","x":190,"y":880,"wires":[["74b7761c.722488"]]},{"id":"885bef6.97f421","type":"ui_numeric","z":"a61a257b.7ba4d","name":"","label":"@","tooltip":"","group":"9dc5814c.bca5a8","order":2,"width":3,"height":1,"wrap":false,"passthru":true,"topic":"","format":"{{value}}°C","min":"35","max":"80","step":1,"x":610,"y":880,"wires":[["521fb5b5.4d0e7c"]]},{"id":"2b966595.cdf652","type":"ui_numeric","z":"a61a257b.7ba4d","name":"","label":"Rest 2","tooltip":"","group":"90c79ee1.d905d","order":1,"width":4,"height":1,"wrap":false,"passthru":true,"topic":"","format":"{{value}}m","min":"0","max":"90","step":"0.1","x":190,"y":780,"wires":[["3cbf0e.83c5b0f2"]]},{"id":"884a5667.b76a6","type":"ui_numeric","z":"a61a257b.7ba4d","name":"","label":"@","tooltip":"","group":"90c79ee1.d905d","order":2,"width":3,"height":1,"wrap":false,"passthru":true,"topic":"","format":"{{value}}°C","min":"35","max":"80","step":1,"x":610,"y":780,"wires":[["1edfd395.087864"]]},{"id":"97ec020c.498a5","type":"inject","z":"a61a257b.7ba4d","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"0","payloadType":"num","x":290,"y":260,"wires":[["5a16336b.28e93c","116a8f83.628b1"]]},{"id":"541c14c2.6b7b0c","type":"inject","z":"a61a257b.7ba4d","name":"Initialize lengths","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"10","payloadType":"num","x":180,"y":640,"wires":[["5b66c013.2d773","2b966595.cdf652","bc1990fc.19def","1d455894.d1aaff","4cd9a8c5.bebbf","3cbf0e.83c5b0f2","74b7761c.722488","478c432f.bdb53c"]]},{"id":"96bc48d0.b77578","type":"inject","z":"a61a257b.7ba4d","name":"Initialize temp","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"35","payloadType":"num","x":600,"y":640,"wires":[["b5eff257.0f9748","884a5667.b76a6","885bef6.97f421","af845a07.be8fa8","1edfd395.087864","dbb92d16.2eb848","521fb5b5.4d0e7c","b44d3169.b3fae8","399839a9.050456"]]},{"id":"116a8f83.628b1","type":"change","z":"a61a257b.7ba4d","name":"","rules":[{"t":"set","p":"mash_rests","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":550,"y":300,"wires":[["46b0cbf.f3c6b34"]]},{"id":"4cd9a8c5.bebbf","type":"change","z":"a61a257b.7ba4d","name":"","rules":[{"t":"set","p":"rest1_length","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":280,"y":720,"wires":[["c99d5a1e.cc48c"]]},{"id":"3cbf0e.83c5b0f2","type":"change","z":"a61a257b.7ba4d","name":"","rules":[{"t":"set","p":"rest2_length","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":280,"y":820,"wires":[["e284ee33.0cc4d"]]},{"id":"521fb5b5.4d0e7c","type":"change","z":"a61a257b.7ba4d","name":"","rules":[{"t":"set","p":"rest3_temp","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":690,"y":920,"wires":[["34ef867c.25476a"]]},{"id":"478c432f.bdb53c","type":"change","z":"a61a257b.7ba4d","name":"","rules":[{"t":"set","p":"rest4_length","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":280,"y":1020,"wires":[["116066f1.b582a9"]]},{"id":"b44d3169.b3fae8","type":"change","z":"a61a257b.7ba4d","name":"","rules":[{"t":"set","p":"rest4_temp","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":690,"y":1020,"wires":[["c9cc7fce.e705f8"]]},{"id":"74b7761c.722488","type":"change","z":"a61a257b.7ba4d","name":"","rules":[{"t":"set","p":"rest3_length","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":280,"y":920,"wires":[["da83298.b63d2d8"]]},{"id":"1edfd395.087864","type":"change","z":"a61a257b.7ba4d","name":"","rules":[{"t":"set","p":"rest2_temp","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":690,"y":820,"wires":[["7a4d4b60.7d6fc4"]]},{"id":"dbb92d16.2eb848","type":"change","z":"a61a257b.7ba4d","name":"","rules":[{"t":"set","p":"rest1_temp","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":690,"y":720,"wires":[["dd804c44.bcb68"]]},{"id":"37f792ff.9c6b6e","type":"ui_dropdown","z":"a61a257b.7ba4d","name":"Start time","label":"","tooltip":"","place":"","group":"252bb944.ff43b6","order":1,"width":7,"height":1,"passthru":false,"multiple":false,"options":[{"label":"Start now","value":"now","type":"str"},{"label":"Delay start by...","value":"delay","type":"str"}],"payload":"","topic":"","x":340,"y":440,"wires":[["53cd1361.e233a4"]]},{"id":"d7dc03c6.a8bde","type":"function","z":"a61a257b.7ba4d","name":"Show/Hide scheduler","func":"if (global.get(\"scheduler\")) {\n    msg.payload = {group:{hide:[\"Mash_Schedule_Control1\", \"Mash_Schedule_Control2\"]}}\n} else {\n    if(flow.get('mash_start') == \"now\") {\n        msg.payload = {group:{hide:[\"Mash_Schedule_Control2\"]}}\n    } else {\n        msg.payload = {group:{show:[\"Mash_Schedule_Control2\"]}}\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":440,"y":1700,"wires":[["b4545b4c.169598"]]},{"id":"1fd5edcc.16215a","type":"inject","z":"a61a257b.7ba4d","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"now","payloadType":"str","x":290,"y":400,"wires":[["37f792ff.9c6b6e","53cd1361.e233a4"]]},{"id":"6ca5afef.8e9598","type":"ui_numeric","z":"a61a257b.7ba4d","name":"Minutes","label":"","tooltip":"","group":"172eb1b5.c3e3ee","order":2,"width":3,"height":1,"wrap":false,"passthru":true,"topic":"","format":"{{value}}m","min":"0","max":"59","step":1,"x":360,"y":580,"wires":[["a4d71607.eb8af"]]},{"id":"2050faad.0381fe","type":"ui_numeric","z":"a61a257b.7ba4d","name":"Hours","label":"","tooltip":"","group":"172eb1b5.c3e3ee","order":1,"width":3,"height":1,"wrap":false,"passthru":true,"topic":"","format":"{{value}}h","min":"0","max":"12","step":1,"x":350,"y":540,"wires":[["9e8a4666.a36d38"]]},{"id":"70b506b3.91135","type":"ui_button","z":"a61a257b.7ba4d","name":"","group":"d360e2ce.52a2e","order":2,"width":5,"height":1,"passthru":false,"label":"Run","tooltip":"","color":"","bgcolor":"{{colour}}","icon":"","payload":"true","payloadType":"bool","topic":"run","x":270,"y":1320,"wires":[["c8a21826.bb0828"]]},{"id":"f24a3f03.f576b8","type":"inject","z":"a61a257b.7ba4d","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"run-init","payload":"false","payloadType":"bool","x":390,"y":1280,"wires":[["5362eb97.fe4904"]]},{"id":"c8a21826.bb0828","type":"switch","z":"a61a257b.7ba4d","name":"","property":"scheduler","propertyType":"global","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":410,"y":1320,"wires":[["5362eb97.fe4904"],["4565a076.8ac75"]]},{"id":"5362eb97.fe4904","type":"change","z":"a61a257b.7ba4d","name":"Switch off","rules":[{"t":"set","p":"scheduler","pt":"global","to":"false","tot":"bool"},{"t":"set","p":"payload","pt":"msg","to":"false","tot":"bool"},{"t":"set","p":"steps","pt":"flow","to":"[]","tot":"json"},{"t":"set","p":"step","pt":"flow","to":"0","tot":"num"},{"t":"set","p":"rest","pt":"flow","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":1280,"wires":[["450a7ee0.a70368","eaf52374.ebf47"]]},{"id":"4565a076.8ac75","type":"change","z":"a61a257b.7ba4d","name":"Switch on","rules":[{"t":"set","p":"scheduler","pt":"global","to":"true","tot":"bool"},{"t":"set","p":"click_time","pt":"flow","to":"","tot":"date"},{"t":"set","p":"payload","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":1320,"wires":[["450a7ee0.a70368"]]},{"id":"deb15d8d.b66d7","type":"change","z":"a61a257b.7ba4d","name":"off colour","rules":[{"t":"set","p":"colour","pt":"msg","to":"grey","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":1220,"wires":[["f685d511.c28d88"]]},{"id":"1b15d642.329492","type":"change","z":"a61a257b.7ba4d","name":"on colour","rules":[{"t":"set","p":"colour","pt":"msg","to":"#66cc00","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":1180,"wires":[["f685d511.c28d88"]]},{"id":"a17aa50.2f6aed8","type":"switch","z":"a61a257b.7ba4d","name":"Scheduler state","property":"scheduler","propertyType":"global","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":380,"y":1200,"wires":[["1b15d642.329492"],["deb15d8d.b66d7"]]},{"id":"d7ae6d21.5c5dc8","type":"delay","z":"a61a257b.7ba4d","name":"delay","pauseType":"delay","timeout":"0.2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":310,"y":1160,"wires":[["a17aa50.2f6aed8"]]},{"id":"f685d511.c28d88","type":"link out","z":"a61a257b.7ba4d","name":"Run button colour","links":["2e005137.8751c6"],"x":675,"y":1200,"wires":[]},{"id":"e44fe4f5.f1d9f","type":"link in","z":"a61a257b.7ba4d","name":"Scheduler update","links":["450a7ee0.a70368"],"x":195,"y":1160,"wires":[["d7ae6d21.5c5dc8"]]},{"id":"450a7ee0.a70368","type":"link out","z":"a61a257b.7ba4d","name":"Scheduler update","links":["17974d16.ef0813","e44fe4f5.f1d9f","f162ab2d.ccb918","d5ce5255.11e7f","c118cf32.7e3be","1d5b4c82.a575d3","225a6837.a0226","115285c0.360dca","f7b4edd0.89c428"],"x":675,"y":1300,"wires":[]},{"id":"2e005137.8751c6","type":"link in","z":"a61a257b.7ba4d","name":"Run button colour","links":["f685d511.c28d88"],"x":175,"y":1320,"wires":[["70b506b3.91135"]]},{"id":"9930298d.64fa88","type":"ui_ui_control","z":"a61a257b.7ba4d","name":"Dashboard connection","events":"all","x":340,"y":40,"wires":[["d1228e7.cad437"]]},{"id":"d1228e7.cad437","type":"link out","z":"a61a257b.7ba4d","name":"Connection established","links":["225a6837.a0226","115285c0.360dca","16e574c.9ac9c0b","f7b4edd0.89c428"],"x":475,"y":40,"wires":[]},{"id":"16e574c.9ac9c0b","type":"link in","z":"a61a257b.7ba4d","name":"initialization","links":["d1228e7.cad437"],"x":235,"y":1200,"wires":[["a17aa50.2f6aed8"]]},{"id":"53cd1361.e233a4","type":"change","z":"a61a257b.7ba4d","name":"","rules":[{"t":"set","p":"mash_start","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":550,"y":440,"wires":[["86fd9a77.d324d"]]},{"id":"225a6837.a0226","type":"link in","z":"a61a257b.7ba4d","name":"Initialization","links":["d1228e7.cad437","450a7ee0.a70368","86fd9a77.d324d"],"x":275,"y":1700,"wires":[["d7dc03c6.a8bde"]]},{"id":"115285c0.360dca","type":"link in","z":"a61a257b.7ba4d","name":"Initialization","links":["d1228e7.cad437","450a7ee0.a70368","46b0cbf.f3c6b34"],"x":275,"y":1660,"wires":[["ad58667f.9bc18"]]},{"id":"9e432651.9031e8","type":"link in","z":"a61a257b.7ba4d","name":"UI dynamics","links":["6d76bbc1.3317ac","b4545b4c.169598","fda473b1.51713","8baaa2a6.c6868","3cbb5cc7.3c7574","17ffbc99.0e1683","3e67f7fe.b049d","d82a1728.adb84","f1b97e65.8adc","ff465666.897698"],"x":195,"y":40,"wires":[["9930298d.64fa88"]]},{"id":"6d76bbc1.3317ac","type":"link out","z":"a61a257b.7ba4d","name":"Rest # selector","links":["9e432651.9031e8"],"x":595,"y":1660,"wires":[]},{"id":"b4545b4c.169598","type":"link out","z":"a61a257b.7ba4d","name":"Scheduler visibility","links":["9e432651.9031e8"],"x":595,"y":1700,"wires":[]},{"id":"e4a43166.f7ca8","type":"ui_text","z":"a61a257b.7ba4d","group":"beea0165.6e28f8","order":4,"width":0,"height":0,"name":"","label":"Time left","format":"{{msg.payload}}","layout":"row-spread","x":660,"y":2000,"wires":[]},{"id":"f111ee74.e92c8","type":"inject","z":"a61a257b.7ba4d","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":210,"y":1800,"wires":[["d84a889a.26a7c","2a0c9f9e.f86b48","6aea6734.7417c"]]},{"id":"d84a889a.26a7c","type":"change","z":"a61a257b.7ba4d","name":"","rules":[{"t":"set","p":"step","pt":"flow","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":1840,"wires":[[]]},{"id":"a3012bf1.28bfc8","type":"ui_text","z":"a61a257b.7ba4d","group":"beea0165.6e28f8","order":5,"width":0,"height":0,"name":"","label":"Target","format":"{{msg.payload}}","layout":"row-spread","x":650,"y":2040,"wires":[]},{"id":"14076f5f.09b519","type":"ui_text","z":"a61a257b.7ba4d","group":"beea0165.6e28f8","order":1,"width":0,"height":0,"name":"Process stage","label":"","format":"{{msg.payload}}","layout":"col-center","x":680,"y":1880,"wires":[]},{"id":"e63d67f5.9c9d98","type":"ui_template","z":"a61a257b.7ba4d","group":"beea0165.6e28f8","name":"Progress bar","order":2,"width":0,"height":0,"format":"<div>\n<md-progress-linear md-mode=\"{{msg.wait ? 'indeterminate' : 'determinate'}}\" value={{msg.payload}}></md-progress-linear>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":670,"y":1920,"wires":[[]]},{"id":"824663e5.496e4","type":"function","z":"a61a257b.7ba4d","name":"indeterminate or determinate","func":"if (msg.topic === \"timer-count\") {\n    var secLeft = msg.payload;\n    var stepLengthSec = flow.get('stepLengthSec');\n    msg.payload = (1 - (secLeft / stepLengthSec)) * 100; \n}\n\nif (msg.topic === \"temp-BK\" || msg.topic === \"temp-MLT\") {\n    return null;\n}\n/*\nif([1, 3, 5, 7, 9].includes(flow.get('step'))){msg.wait = true} else{\n    msg.wait = false}\n    */\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":460,"y":1920,"wires":[["e63d67f5.9c9d98"]]},{"id":"46b0cbf.f3c6b34","type":"link out","z":"a61a257b.7ba4d","name":"","links":["90aed32f.aa8cc","d917c6a3.69917","115285c0.360dca"],"x":735,"y":300,"wires":[]},{"id":"7cc178e3.b99db","type":"function","z":"a61a257b.7ba4d","name":"Plain text process stage","func":"if (msg.topic === \"timer-count\") {\n    return null;\n}\nmsg.payload = msg.stepText;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":450,"y":1880,"wires":[["14076f5f.09b519"]]},{"id":"d78d9e63.042b98","type":"inject","z":"a61a257b.7ba4d","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"0.5","topic":"","payload":"0","payloadType":"num","x":210,"y":1860,"wires":[["7cc178e3.b99db","824663e5.496e4"]]},{"id":"17974d16.ef0813","type":"link in","z":"a61a257b.7ba4d","name":"Scheduler update","links":["450a7ee0.a70368"],"x":275,"y":1580,"wires":[["bb2fdbd5.7d291"]]},{"id":"bb2fdbd5.7d291","type":"function","z":"a61a257b.7ba4d","name":"UI updates","func":"if(global.get('scheduler')){\n    msg.payload = {\n        group: {\n            show:[\n                \"Mash_Schedule_Control4\",\n                \"Mash_Schedule_MASH_SCHEDULE\"\n                ],\n            hide:[\n                \"Mash_Schedule_Control0\",\n                \"Mash_Schedule_Control1\",\n                \"Mash_Schedule_Control2\",\n                \"Mash_Schedule_Strike\",\n                \"Mash_Schedule_Rest1\",\n                \"Mash_Schedule_Rest2\",\n                \"Mash_Schedule_Rest3\",\n                \"Mash_Schedule_Rest4\"\n                ]\n            \n        }\n    };\n} else {\n    if(flow.get('mash_start')== \"now\"){\n        msg.payload = {\n            group:{\n                show:[\n                    \"Mash_Schedule_MASH_SCHEDULE\",\n                    \"Mash_Schedule_Control0\",\n                    \"Mash_Schedule_Control1\"\n                    ],\n                hide:[\n                    \"Mash_Schedule_Control4\"\n                    ]\n            }\n        }\n    } else {\n        msg.payload = {\n            group: {\n                show:[\n                    \"Mash_Schedule_MASH_SCHEDULE\",\n                    \"Mash_Schedule_Control0\",\n                    \"Mash_Schedule_Control1\",\n                    \"Mash_Schedule_Control2\"\n                    ],\n                hide:[\n                    \"Mash_Schedule_Control4\"\n                    ]\n            }\n        }\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":410,"y":1580,"wires":[["17ffbc99.0e1683"]]},{"id":"17ffbc99.0e1683","type":"link out","z":"a61a257b.7ba4d","name":"Timer visibility","links":["9e432651.9031e8"],"x":595,"y":1580,"wires":[]},{"id":"c99d5a1e.cc48c","type":"link out","z":"a61a257b.7ba4d","name":"rest1 length","links":["90aed32f.aa8cc","aaa46480.e5f9d8","a618b96c.531b28"],"x":435,"y":720,"wires":[]},{"id":"e284ee33.0cc4d","type":"link out","z":"a61a257b.7ba4d","name":"rest2 length","links":["90aed32f.aa8cc","8a1f8a26.5c1dd8"],"x":435,"y":820,"wires":[]},{"id":"da83298.b63d2d8","type":"link out","z":"a61a257b.7ba4d","name":"rest3 length","links":["90aed32f.aa8cc","9e521a87.621e1"],"x":435,"y":920,"wires":[]},{"id":"116066f1.b582a9","type":"link out","z":"a61a257b.7ba4d","name":"rest4 length","links":["90aed32f.aa8cc","a3831aa1.cd8a08"],"x":435,"y":1020,"wires":[]},{"id":"dd804c44.bcb68","type":"link out","z":"a61a257b.7ba4d","name":"rest1 temp","links":["aaa46480.e5f9d8","a618b96c.531b28"],"x":835,"y":720,"wires":[]},{"id":"7a4d4b60.7d6fc4","type":"link out","z":"a61a257b.7ba4d","name":"rest2 temp","links":["8a1f8a26.5c1dd8"],"x":835,"y":820,"wires":[]},{"id":"34ef867c.25476a","type":"link out","z":"a61a257b.7ba4d","name":"rest3 temp","links":["9e521a87.621e1"],"x":835,"y":920,"wires":[]},{"id":"c9cc7fce.e705f8","type":"link out","z":"a61a257b.7ba4d","name":"rest4 temp","links":["a3831aa1.cd8a08"],"x":835,"y":1020,"wires":[]},{"id":"dcef47a.6cef338","type":"link in","z":"a61a257b.7ba4d","name":"mash steps","links":["d1857de1.6142"],"x":195,"y":300,"wires":[["5a16336b.28e93c"]]},{"id":"676ca880.33825","type":"link in","z":"a61a257b.7ba4d","name":"","links":["5fb42070.3f70d","e6fff4c2.6e6538"],"x":55,"y":680,"wires":[["5b66c013.2d773"]]},{"id":"f497d136.7ca008","type":"link in","z":"a61a257b.7ba4d","name":"","links":["e2d538b4.03ee98","af936a3e.c9ea38"],"x":55,"y":780,"wires":[["2b966595.cdf652"]]},{"id":"799d55c.28e29ac","type":"link in","z":"a61a257b.7ba4d","name":"","links":["d332f25.ecbef1","cfeb030d.3f87d"],"x":55,"y":880,"wires":[["bc1990fc.19def"]]},{"id":"87136f7f.543e28","type":"link in","z":"a61a257b.7ba4d","name":"","links":["c67a14ee.a6d5a8","863631cd.169bb"],"x":55,"y":980,"wires":[["1d455894.d1aaff"]]},{"id":"d25750d8.cdbb4","type":"link in","z":"a61a257b.7ba4d","name":"","links":["3255ff95.2acfb","85ce049b.1a57f8"],"x":495,"y":680,"wires":[["b5eff257.0f9748"]]},{"id":"c3f6cce4.a2b6b","type":"link in","z":"a61a257b.7ba4d","name":"","links":["1642a376.00d4fd","46cde51c.10be4c"],"x":495,"y":780,"wires":[["884a5667.b76a6"]]},{"id":"d7cbcfbf.53d9e8","type":"link in","z":"a61a257b.7ba4d","name":"","links":["e84942c1.46001","266badcb.a9f002"],"x":495,"y":880,"wires":[["885bef6.97f421"]]},{"id":"e86203d5.ef146","type":"link in","z":"a61a257b.7ba4d","name":"","links":["5513fb56.dbb7b4","7ea1043c.90585c"],"x":495,"y":980,"wires":[["af845a07.be8fa8"]]},{"id":"2f006fda.541fe","type":"function","z":"a61a257b.7ba4d","name":"Mash Control","func":"var topic = msg.topic;\nvar scheduler = global.get(\"scheduler\");\nvar payload = msg.payload;\nvar currentStep = flow.get(\"step\");\nvar steps = flow.get(\"steps\");\n\nif (topic === \"timer\") {\n    if (payload) {\n        return null;\n    }\n    \n    if (!payload && !scheduler) {\n        return null;\n    }\n    \n    currentStep++;\n}\n\nif (topic === \"next\") {\n    currentStep++;\n}\n\nvar step = steps[currentStep];\n\nvar currentTemp = global.get(step.tempVariable);\nif (topic === \"temp-BK\" || topic === \"temp-MLT\") {\n    if (!scheduler) {\n        return null;\n    }\n    if (step.tempVariable === topic) {\n        currentTemp = msg.payload;\n    }\n}\n\n\n\nmsg.currentTemp = currentTemp;\nmsg.stepTemp = step.temp;\nmsg.stepLengthSec = step.lengthSec;\nmsg.stepText = step.onText;\nmsg.wait = step.wait;\n\nif (!step.reached && msg.currentTemp < step.temp) {\n    msg.stepText = step.toText;\n    msg.wait = true;\n} else {\n    step.reached = true;\n}\n\nsteps[currentStep] = step;\nmsg.steps = steps;\nmsg.step = step;\nflow.set(\"steps\", steps);\nflow.set(\"step\", currentStep);\nflow.set(\"stepLengthSec\", msg.stepLengthSec);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":410,"y":1500,"wires":[["112d26fe.6dbe89"]]},{"id":"d2a2dfb4.f93728","type":"link in","z":"a61a257b.7ba4d","name":"mash control in","links":["8569ed6d.8bf448","641cdea.50b642","737daba5.b4f1e4","aa8a5663.ab09a","86751c96.8bee98"],"x":275,"y":1500,"wires":[["2f006fda.541fe"]]},{"id":"112d26fe.6dbe89","type":"link out","z":"a61a257b.7ba4d","name":"mash control out","links":["d6f64ef4.6c9e2","be768859.9e1e98","e0861627.494768","23685e1a.828bd2","1d5b4c82.a575d3","759fb05d.f6f678"],"x":595,"y":1500,"wires":[]},{"id":"be768859.9e1e98","type":"link in","z":"a61a257b.7ba4d","name":"current target temp display","links":["34359c9.0a9b664","112d26fe.6dbe89"],"x":155,"y":2040,"wires":[["719840f4.34e258","afbb1293.bb3968"]]},{"id":"2a0c9f9e.f86b48","type":"change","z":"a61a257b.7ba4d","name":"","rules":[{"t":"set","p":"rest","pt":"flow","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":1800,"wires":[[]]},{"id":"e0861627.494768","type":"link in","z":"a61a257b.7ba4d","name":"timer in","links":["d9e8d54b.90ace8","112d26fe.6dbe89"],"x":155,"y":2300,"wires":[["46d82e3a.c3b8b"]]},{"id":"641cdea.50b642","type":"link out","z":"a61a257b.7ba4d","name":"countdown start/stop","links":["d2a2dfb4.f93728"],"x":775,"y":2260,"wires":[]},{"id":"198be90a.09c7af","type":"link out","z":"a61a257b.7ba4d","name":"countdown time left","links":["d6f64ef4.6c9e2"],"x":775,"y":2300,"wires":[]},{"id":"46d82e3a.c3b8b","type":"function","z":"a61a257b.7ba4d","name":"should start timer?","func":"var scheduler = global.get(\"scheduler\");\nvar wait = msg.wait; //[1, 3, 5, 7, 9, 100].includes(flow.get('step'));\nmsg.topic = \"control\";\nif (!scheduler) {\n    msg.payload = 0;\n    return msg;\n}\n\nif (wait) {\n    msg.payload = 0;\n    return msg;\n}\n\nmsg.payload = msg.stepLengthSec;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":370,"y":2300,"wires":[["273ca394.ae99bc"]]},{"id":"d6f64ef4.6c9e2","type":"link in","z":"a61a257b.7ba4d","name":"","links":["198be90a.09c7af","112d26fe.6dbe89"],"x":155,"y":1920,"wires":[["7cc178e3.b99db","824663e5.496e4","1223e1e8.6a68c6","6ed99f00.a1c4a8"]]},{"id":"5beade26.5f6ee","type":"change","z":"a61a257b.7ba4d","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"timer-count","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":710,"y":2340,"wires":[["198be90a.09c7af"]]},{"id":"23685e1a.828bd2","type":"link in","z":"a61a257b.7ba4d","name":"","links":["112d26fe.6dbe89"],"x":155,"y":2140,"wires":[["c1dd37f9.f6ff1"]]},{"id":"c1dd37f9.f6ff1","type":"change","z":"a61a257b.7ba4d","name":"msg.payload = msg.restTemp","rules":[{"t":"set","p":"payload","pt":"msg","to":"stepTemp","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":2140,"wires":[["e94f5254.be2aa8"]]},{"id":"28b7a78a.9f8a9","type":"link out","z":"a61a257b.7ba4d","name":"","links":["e14e9c18.c7d3e"],"x":855,"y":2120,"wires":[]},{"id":"759fb05d.f6f678","type":"link in","z":"a61a257b.7ba4d","name":"","links":["112d26fe.6dbe89"],"x":155,"y":2440,"wires":[["a21d8d5.c388bf"]]},{"id":"a21d8d5.c388bf","type":"function","z":"a61a257b.7ba4d","name":"toggle pid","func":"if (msg.step.type === \"delay\") {\n    return null;\n}\n\nvar bkState = { payload: false };\nvar mltState = { payload: false };\n\nvar tempActor = msg.step.tempActor;\n\nif (tempActor === \"BK\") {\n    bkState.payload = true;\n} else if (tempActor === \"MLT\") {\n    mltState.payload = true;\n}\n\nreturn [bkState, mltState];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":260,"y":2440,"wires":[["7360c4fd.14b504"],["590b76f8.cd6"]]},{"id":"f029b0d5.7f1c9","type":"link out","z":"a61a257b.7ba4d","name":"","links":["db4865c8.351bf8"],"x":655,"y":2380,"wires":[]},{"id":"d17a8953.3bb95","type":"ui_switch","z":"a61a257b.7ba4d","name":"","label":"with strike","tooltip":"","group":"83f17780.f786e8","order":2,"width":3,"height":1,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":340,"y":200,"wires":[["32c7c0e.14b9c4"]]},{"id":"6d7f7429.7552f4","type":"ui_template","z":"a61a257b.7ba4d","group":"f6e1ef23.f6f118","name":"styles","order":21,"width":0,"height":0,"format":"<style>\n    #Mash_Schedule_Control0 .nr-dashboard-switch p {\n        padding: 0;\n    }\n</style>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"global","x":290,"y":100,"wires":[[]]},{"id":"ee454d26.7028d","type":"inject","z":"a61a257b.7ba4d","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"false","payloadType":"bool","x":290,"y":160,"wires":[["d17a8953.3bb95"]]},{"id":"32c7c0e.14b9c4","type":"change","z":"a61a257b.7ba4d","name":"set flow.use_strike","rules":[{"t":"set","p":"use_strike","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":550,"y":200,"wires":[["81d2a934.c90d2"]]},{"id":"82ce61b4.b7b36","type":"function","z":"a61a257b.7ba4d","name":"Show/hide strike","func":"if (global.get(\"scheduler\")) {\n    msg.payload = { group: { hide: [\"Mash_Schedule_Strike\"] } };\n} else {\n    if(flow.get('use_strike'))\n    {\n        msg.payload = { group: { show: [\"Mash_Schedule_Strike\"] } };\n    } else {\n        msg.payload = { group: { hide: [\"Mash_Schedule_Strike\"] } };\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":420,"y":1620,"wires":[["d82a1728.adb84"]]},{"id":"f7b4edd0.89c428","type":"link in","z":"a61a257b.7ba4d","name":"Initialization","links":["d1228e7.cad437","450a7ee0.a70368","81d2a934.c90d2"],"x":275,"y":1620,"wires":[["82ce61b4.b7b36"]]},{"id":"d82a1728.adb84","type":"link out","z":"a61a257b.7ba4d","name":"Rest # selector","links":["9e432651.9031e8"],"x":595,"y":1620,"wires":[]},{"id":"80e7646.5571818","type":"link in","z":"a61a257b.7ba4d","name":"use strike","links":["cf5e9e51.ecb27","85435b13.34401"],"x":195,"y":200,"wires":[["d17a8953.3bb95"]]},{"id":"399839a9.050456","type":"ui_numeric","z":"a61a257b.7ba4d","name":"","label":"Strike","tooltip":"","group":"251416bf.2d8d1a","order":1,"width":4,"height":1,"wrap":false,"passthru":true,"topic":"","format":"{{value}}°C","min":"30","max":"80","step":1,"x":610,"y":1080,"wires":[["1bc16a70.28a7a6"]]},{"id":"cdba7ddd.5ed1f","type":"switch","z":"a61a257b.7ba4d","name":"Is disabled?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":530,"y":340,"wires":[["47fbae42.f8d6c8"]]},{"id":"47fbae42.f8d6c8","type":"change","z":"a61a257b.7ba4d","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":380,"wires":[["85435b13.34401"]]},{"id":"85435b13.34401","type":"link out","z":"a61a257b.7ba4d","name":"","links":["80e7646.5571818"],"x":735,"y":380,"wires":[]},{"id":"1bd9f3b5.ac6c3c","type":"link in","z":"a61a257b.7ba4d","name":"strike temp","links":["c8e95d20.30de4"],"x":495,"y":1080,"wires":[["399839a9.050456"]]},{"id":"1bc16a70.28a7a6","type":"change","z":"a61a257b.7ba4d","name":"","rules":[{"t":"set","p":"strike_temp","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":690,"y":1120,"wires":[["1eaa0a31.208e86"]]},{"id":"1eaa0a31.208e86","type":"link out","z":"a61a257b.7ba4d","name":"","links":["a618b96c.531b28"],"x":835,"y":1120,"wires":[]},{"id":"c89c048a.0e12f8","type":"function","z":"a61a257b.7ba4d","name":"init mash steps","func":"var steps = [];\n\nif (msg.topic === \"run-init\") {\n    return null;\n}\n\nif (flow.get(\"mash_start\") === \"delay\") {\n    var houres = flow.get(\"delay_houres\");\n    var minutes = (houres * 60) + flow.get(\"delay_minutes\");\n    var seconds = minutes * 60 ;\n    steps.push({\n       type: \"delay\",\n       tempActor: \"BK\",\n       tempVariable: \"temp-BK\",\n       temp: -1,\n       lengthMin: minutes,\n       lengthSec: seconds,\n       toText: \"Delayed start\",\n       onText: \"Delayed start\",\n       wait: false,\n       reached: false\n    });\n}\n\nif (flow.get(\"use_strike\")) {\n    steps.push({\n       type: \"strike\",\n       tempActor: \"BK\",\n       tempVariable: \"temp-BK\",\n       temp: flow.get(\"strike_temp\"),\n       lengthMin: -1,\n       lengthSec: -1,\n       toText: \"Heating to strike temp\",\n       onText: \"Strike temp reached\",\n       wait: true,\n       reached: false\n    });\n}\n\nvar numOfRests = flow.get(\"mash_rests\");\nfor (var i = 1; i <= numOfRests; i++) {\n    steps.push({\n       type: \"mash\",\n       tempActor: \"MLT\",\n       tempVariable: \"temp-MLT\",\n       temp: flow.get(\"rest\" + i + \"_temp\"),\n       length: flow.get(\"rest\" + i + \"_length\"),\n       lengthSec: flow.get(\"rest\" + i + \"_length\") * 60,\n       toText: \"Heating to rest \" + i,\n       onText: \"Rest \" + i,\n       wait: false,\n       reached: false\n    });\n}\n\nflow.set(\"steps\", steps);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":420,"y":1460,"wires":[["8569ed6d.8bf448"]]},{"id":"c118cf32.7e3be","type":"link in","z":"a61a257b.7ba4d","name":"","links":["450a7ee0.a70368"],"x":275,"y":1460,"wires":[["c89c048a.0e12f8"]]},{"id":"8569ed6d.8bf448","type":"link out","z":"a61a257b.7ba4d","name":"","links":["d2a2dfb4.f93728"],"x":595,"y":1460,"wires":[]},{"id":"6aea6734.7417c","type":"change","z":"a61a257b.7ba4d","name":"","rules":[{"t":"set","p":"steps","pt":"flow","to":"[]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":1760,"wires":[[]]},{"id":"2f3dfe15.4539aa","type":"ui_button","z":"a61a257b.7ba4d","name":"","group":"c1e75384.e3fe88","order":2,"width":5,"height":1,"passthru":false,"label":"Next","tooltip":"","color":"","bgcolor":"grey","icon":"","payload":"true","payloadType":"bool","topic":"next","x":270,"y":1360,"wires":[["aa8a5663.ab09a"]]},{"id":"aa8a5663.ab09a","type":"link out","z":"a61a257b.7ba4d","name":"","links":["d2a2dfb4.f93728"],"x":375,"y":1360,"wires":[]},{"id":"9a3e857d.ec81e","type":"function","z":"a61a257b.7ba4d","name":"show/hide next","func":"if (msg.topic === \"run-init\" || msg.topic === \"run\") {\n    msg.payload = {group:{hide:[\"Mash_Schedule_NextStep\"]}};\n    return msg;\n}\n\nvar show = msg.step.wait && msg.step.reached;\nif (show) {\n    msg.payload = {group:{show:[\"Mash_Schedule_NextStep\"]}};\n} else {\n    msg.payload = {group:{hide:[\"Mash_Schedule_NextStep\"]}};\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":420,"y":1540,"wires":[["ff465666.897698"]]},{"id":"ff465666.897698","type":"link out","z":"a61a257b.7ba4d","name":"","links":["9e432651.9031e8"],"x":595,"y":1540,"wires":[]},{"id":"1d5b4c82.a575d3","type":"link in","z":"a61a257b.7ba4d","name":"","links":["112d26fe.6dbe89","450a7ee0.a70368"],"x":275,"y":1540,"wires":[["9a3e857d.ec81e"]]},{"id":"eaf52374.ebf47","type":"link out","z":"a61a257b.7ba4d","name":"","links":["ef8fa07c.8bb1a"],"x":675,"y":1260,"wires":[]},{"id":"ef8fa07c.8bb1a","type":"link in","z":"a61a257b.7ba4d","name":"","links":["eaf52374.ebf47"],"x":155,"y":2260,"wires":[["bc5072c0.a0be68"]]},{"id":"bc5072c0.a0be68","type":"change","z":"a61a257b.7ba4d","name":"turn countdown off","rules":[{"t":"set","p":"payload","pt":"msg","to":"false","tot":"bool"},{"t":"set","p":"topic","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":370,"y":2260,"wires":[["273ca394.ae99bc"]]},{"id":"e94f5254.be2aa8","type":"switch","z":"a61a257b.7ba4d","name":"set BK/MLT target temp","property":"step.tempActor","propertyType":"msg","rules":[{"t":"eq","v":"BK","vt":"str"},{"t":"eq","v":"MLT","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":670,"y":2140,"wires":[["28b7a78a.9f8a9"],["d08852fe.5756a"]]},{"id":"d08852fe.5756a","type":"link out","z":"a61a257b.7ba4d","name":"","links":["115956ea.45d519"],"x":855,"y":2160,"wires":[]},{"id":"731f72bc.e9af94","type":"link out","z":"a61a257b.7ba4d","name":"","links":["2d18089d.7395f8"],"x":655,"y":2540,"wires":[]},{"id":"21bafbe2.fe540c","type":"delay","z":"a61a257b.7ba4d","name":"","pauseType":"delay","timeout":"3.1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":510,"y":2380,"wires":[["f029b0d5.7f1c9"]]},{"id":"939ca2d5.595b28","type":"delay","z":"a61a257b.7ba4d","name":"","pauseType":"delay","timeout":"3.1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":510,"y":2500,"wires":[["731f72bc.e9af94"]]},{"id":"e4a5ff3f.85c028","type":"switch","z":"a61a257b.7ba4d","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"false","repair":false,"outputs":2,"x":530,"y":2420,"wires":[["21bafbe2.fe540c","2bfd8bd7.f88b94"],["4cbdeda5.a6e324"]]},{"id":"4cbdeda5.a6e324","type":"link out","z":"a61a257b.7ba4d","name":"","links":["cc7934ba.9d3f08"],"x":655,"y":2460,"wires":[]},{"id":"c8986749.7831c8","type":"switch","z":"a61a257b.7ba4d","name":"","property":"payload","propertyType":"msg","rules":[{"t":"false"},{"t":"true"}],"checkall":"false","repair":false,"outputs":2,"x":530,"y":2460,"wires":[["7c6521b6.d832a8","2bfd8bd7.f88b94"],["939ca2d5.595b28"]]},{"id":"7c6521b6.d832a8","type":"link out","z":"a61a257b.7ba4d","name":"","links":["b507b41b.a3a168"],"x":655,"y":2500,"wires":[]},{"id":"590b76f8.cd6","type":"rbe","z":"a61a257b.7ba4d","name":"","func":"rbei","gap":"","start":"","inout":"out","property":"payload","x":410,"y":2460,"wires":[["c8986749.7831c8"]]},{"id":"7360c4fd.14b504","type":"rbe","z":"a61a257b.7ba4d","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":410,"y":2420,"wires":[["e4a5ff3f.85c028"]]},{"id":"9e8a4666.a36d38","type":"change","z":"a61a257b.7ba4d","name":"","rules":[{"t":"set","p":"delay_houres","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":540,"wires":[[]]},{"id":"a4d71607.eb8af","type":"change","z":"a61a257b.7ba4d","name":"","rules":[{"t":"set","p":"delay_minutes","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":580,"wires":[[]]},{"id":"cb198125.27be5","type":"inject","z":"a61a257b.7ba4d","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"0","payloadType":"num","x":230,"y":560,"wires":[["2050faad.0381fe","6ca5afef.8e9598"]]},{"id":"1223e1e8.6a68c6","type":"function","z":"a61a257b.7ba4d","name":"step time","func":"if (msg.topic === \"temp-BK\" || msg.topic === \"temp-MLT\") {\n    return null;\n}\n\nvar stepLengthSec = msg.stepLengthSec;\nif (msg.topic === \"timer-count\") {\n    stepLengthSec = msg.payload;\n}\n\nif (stepLengthSec === -1) {\n    msg.payload = \"-\";\n    return msg;\n}\n\nvar m = parseInt(stepLengthSec / 60);\nvar s = parseInt(stepLengthSec % 60);\nif (m > 0) {\n    msg.payload = `${m}m ${s}s`;\n} else {\n    msg.payload = `${s}s`;\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":400,"y":2000,"wires":[["e4a43166.f7ca8"]]},{"id":"b3c601a2.5acba8","type":"ui_text","z":"a61a257b.7ba4d","group":"beea0165.6e28f8","order":3,"width":0,"height":0,"name":"","label":"Step","format":"{{msg.payload}}","layout":"row-center","x":650,"y":1960,"wires":[]},{"id":"6ed99f00.a1c4a8","type":"function","z":"a61a257b.7ba4d","name":"steps","func":"var steps = flow.get(\"steps\");\nvar step = flow.get(\"step\") + 1;\nmsg.payload = `${step} of ${steps.length}`;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":390,"y":1960,"wires":[["b3c601a2.5acba8"]]},{"id":"719840f4.34e258","type":"ui_text","z":"a61a257b.7ba4d","group":"beea0165.6e28f8","order":6,"width":0,"height":0,"name":"","label":"Actual","format":"{{msg.currentTemp}}°C","layout":"row-spread","x":650,"y":2080,"wires":[]},{"id":"81d2a934.c90d2","type":"link out","z":"a61a257b.7ba4d","name":"","links":["f7b4edd0.89c428"],"x":735,"y":200,"wires":[]},{"id":"86fd9a77.d324d","type":"link out","z":"a61a257b.7ba4d","name":"","links":["225a6837.a0226"],"x":735,"y":440,"wires":[]},{"id":"afbb1293.bb3968","type":"function","z":"a61a257b.7ba4d","name":"step temp","func":"msg.payload = msg.stepTemp + \"°C\";\nif (msg.stepTemp === -1) {\n    msg.payload = \"-\";\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":400,"y":2040,"wires":[["a3012bf1.28bfc8"]]},{"id":"145d1024.145c5","type":"link out","z":"a61a257b.7ba4d","name":"","links":["636a18ad.8a27c8"],"x":755,"y":2460,"wires":[]},{"id":"2bfd8bd7.f88b94","type":"change","z":"a61a257b.7ba4d","name":"pump on","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":700,"y":2420,"wires":[["145d1024.145c5"]]},{"id":"273ca394.ae99bc","type":"countdown","z":"a61a257b.7ba4d","name":"","topic":"timer","payloadTimerStart":"true","payloadTimerStartType":"bool","payloadTimerStop":"false","payloadTimerStopType":"bool","timer":"60","resetWhileRunning":false,"setTimeToNewWhileRunning":false,"startCountdownOnControlMessage":true,"x":590,"y":2280,"wires":[["641cdea.50b642"],["5beade26.5f6ee"]]},{"id":"cd6d1a4c.17c818","type":"function","z":"cdc1c9a3.021f58","name":"collect","func":"return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":550,"y":460,"wires":[["324b69ce.251146","7eae3e81.46ee88","64f4ecd7.223dac","e90ba260.7fc82"]]},{"id":"add83ecb.fcfaa8","type":"function","z":"1e878673.29136a","name":"collect","func":"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":570,"y":300,"wires":[["2ede74f0.2bc45c","a976caa4.3cc9c8","6751a948.85bd"]]},{"id":"6284d63a.be6d48","type":"function","z":"1e878673.29136a","name":"collect","func":"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":590,"y":520,"wires":[["da1a9a4c.d64808","1dba4ac9.86a1fd"]]},{"id":"e90ba260.7fc82","type":"change","z":"cdc1c9a3.021f58","name":"delete socketid","rules":[{"t":"delete","p":"socketid","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":400,"wires":[["8d2cbd57.ffc7c8"]]},{"id":"8d2cbd57.ffc7c8","type":"function","z":"cdc1c9a3.021f58","name":"1 decimal","func":"msg.payload = msg.payload.toFixed(1)\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":940,"y":380,"wires":[["fff8af13.08779"]]},{"id":"b4b53e68.439df","type":"delay","z":"cdc1c9a3.021f58","name":"1 sec","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":330,"y":380,"wires":[["d9a8fc6.51d878"]]},{"id":"edaf2c9d.be53","type":"link out","z":"cdc1c9a3.021f58","name":"Mash target slider output","links":["6ce6448.f7e59bc"],"x":695,"y":360,"wires":[]},{"id":"d1e99843.f2d56","type":"delay","z":"1e878673.29136a","name":"1 sec","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":330,"y":600,"wires":[["c922a8ce.b6c8e8"]]},{"id":"6751a948.85bd","type":"change","z":"1e878673.29136a","name":"delete socketid","rules":[{"t":"delete","p":"socketid","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":780,"y":340,"wires":[["6aea0e8f.a5bc3"]]},{"id":"1dba4ac9.86a1fd","type":"change","z":"1e878673.29136a","name":"delete socketid","rules":[{"t":"delete","p":"socketid","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":780,"y":560,"wires":[["5ef482f1.1650fc"]]},{"id":"ff95d83b.e42d4","type":"delay","z":"1e878673.29136a","name":"1 sec","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":330,"y":380,"wires":[["7ffbe7d8.96f4d8"]]},{"id":"c90f55.656610a8","type":"switch","z":"cae39ee2.e2c898","name":"is null?","property":"payload","propertyType":"msg","rules":[{"t":"null"},{"t":"else"},{"t":"btwn","v":"-20","vt":"num","v2":"110","v2t":"num"}],"checkall":"true","repair":false,"outputs":3,"x":540,"y":200,"wires":[["530fd866.744e8"],["737daba5.b4f1e4","ba5b776f.cbd1c8","febd6b09.61a13"],["530fd866.744e8"]]},{"id":"f6a82310.6a1e","type":"switch","z":"cae39ee2.e2c898","name":"is null?","property":"payload","propertyType":"msg","rules":[{"t":"null"},{"t":"btwn","v":"-20","vt":"num","v2":"110","v2t":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":540,"y":760,"wires":[["4b08cd7c.d9f164"],["86751c96.8bee98","9af2f9e2.829e98","e34426e3.0824","5d183b5d.0387cc"],["4b08cd7c.d9f164"]]},{"id":"a389a899.753a1","type":"switch","z":"cae39ee2.e2c898","name":"is null?","property":"payload","propertyType":"msg","rules":[{"t":"null"},{"t":"btwn","v":"-20","vt":"num","v2":"110","v2t":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":540,"y":480,"wires":[["7a411f3b.00a518"],["33b1f220.5f8056","e55bb9f2.657bc","2b38bf4e.64a19","6920821b.3fc50c"],["7a411f3b.00a518"]]},{"id":"932f0ea8.64df38","type":"delay","z":"e2318.a76b94e88","name":"","pauseType":"delay","timeout":"500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":290,"y":900,"wires":[["75647670.c514c8"]]},{"id":"b9f5c71b.306bc","type":"delay","z":"e2318.a76b94e88","name":"","pauseType":"delay","timeout":"500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":290,"y":1040,"wires":[["a925e42f.f53d1"]]},{"id":"e55bb9f2.657bc","type":"change","z":"cae39ee2.e2c898","name":"","rules":[{"t":"set","p":"temp-RIMS","pt":"global","to":"payload","tot":"msg"},{"t":"set","p":"temp-RIMS-timestamp","pt":"flow","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":740,"y":540,"wires":[[]]},{"id":"9af2f9e2.829e98","type":"change","z":"cae39ee2.e2c898","name":"","rules":[{"t":"set","p":"temp-MLT","pt":"global","to":"payload","tot":"msg"},{"t":"set","p":"temp-MLT-timestamp","pt":"flow","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":740,"y":820,"wires":[[]]},{"id":"a75098b.40979e8","type":"function","z":"cae39ee2.e2c898","name":"1 decimal","func":"msg.payload = msg.payload.toFixed(1)\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":900,"y":220,"wires":[["b40a4338.ba0198"]]},{"id":"8061abe4.2b47b8","type":"link out","z":"cae39ee2.e2c898","name":"Simulated OFF click","links":["6fc9143b.0f748c"],"x":595,"y":1020,"wires":[]},{"id":"cd172d96.3df1c","type":"function","z":"cae39ee2.e2c898","name":"RIMS temp read safety function","func":"// Safety function that will simulate an off button press\n// if RIMS/MLT temp reading frequency requirements are not being met\n\n// Require at least one reading from each every 10 seconds\nmsg.rimswait = (msg.timestamp - flow.get('temp-RIMS-timestamp'))/1000\n\nmsg.mltwait = (msg.timestamp - flow.get('temp-MLT-timestamp'))/1000\n\nif(global.get('rims_on') & (msg.rimswait > 10 | msg.mltwait > 10)){\n    msg.payload = false\n} else{\nmsg = null\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":420,"y":1020,"wires":[["8061abe4.2b47b8","56f0dc59.3b9134"]]},{"id":"6fc9143b.0f748c","type":"link in","z":"28484198.eb083e","name":"Simulated click","links":["8061abe4.2b47b8"],"x":315,"y":160,"wires":[["15d83e9d.b3ff21"]]},{"id":"56f0dc59.3b9134","type":"change","z":"cae39ee2.e2c898","name":"Error message","rules":[{"t":"set","p":"payload","pt":"msg","to":"Dangerously irregular temperature readings, turning Mash PID off.","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":660,"y":1060,"wires":[["fc6968a0.b6b17"]]},{"id":"fc6968a0.b6b17","type":"ui_toast","z":"cae39ee2.e2c898","position":"top right","displayTime":"30","highlight":"","sendall":true,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":710,"y":1100,"wires":[]},{"id":"f833f4e2.72b6c","type":"ui_template","z":"cdc1c9a3.021f58","group":"f6e1ef23.f6f118","name":"MLT Slider text","order":19,"width":2,"height":1,"format":"<div style=\"text-align:right; position: absolute; bottom: 15px; width: 100px\">\n<div style=\"text-align:right\">Set Target</div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":160,"y":500,"wires":[[]]},{"id":"421ff6d6.efe548","type":"ui_template","z":"1e878673.29136a","group":"9fe30f36.92cc2","name":"BK target slider text","order":14,"width":2,"height":1,"format":"<div style=\"text-align:right; position: absolute; bottom: 15px; width: 100px\">\n<div style=\"text-align:right\">Set Target</div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":140,"y":260,"wires":[[]]},{"id":"fece7f67.12f47","type":"ui_template","z":"1e878673.29136a","group":"9fe30f36.92cc2","name":"BK manual slider text","order":16,"width":2,"height":1,"format":"<div style=\"text-align:right; position: absolute; bottom: 15px; width: 100px\">\n<div style=\"text-align:right\">Set Manual</div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":140,"y":480,"wires":[[]]},{"id":"530fd866.744e8","type":"change","z":"cae39ee2.e2c898","name":"NaN display","rules":[{"t":"set","p":"payload","pt":"msg","to":"NaN","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":730,"y":180,"wires":[["b40a4338.ba0198"]]},{"id":"7a411f3b.00a518","type":"change","z":"cae39ee2.e2c898","name":"NaN display","rules":[{"t":"set","p":"payload","pt":"msg","to":"NaN","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":730,"y":460,"wires":[["bb561ef8.44b17"]]},{"id":"4b08cd7c.d9f164","type":"change","z":"cae39ee2.e2c898","name":"NaN display","rules":[{"t":"set","p":"payload","pt":"msg","to":"NaN","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":730,"y":740,"wires":[["305b6929.fe6d16"]]},{"id":"21ddb3db.40b06c","type":"ui_ui_control","z":"70d4070b.e447b8","name":"Initialize UI element","events":"connect","x":250,"y":220,"wires":[["e9e1efef.4781b8"]]},{"id":"443bc612.77c77","type":"ui_ui_control","z":"1e878673.29136a","name":"Initialize UI element","events":"connect","x":130,"y":380,"wires":[["ff95d83b.e42d4"]]},{"id":"448609b3.108bb","type":"ui_ui_control","z":"1e878673.29136a","name":"Initialize UI element","events":"connect","x":130,"y":600,"wires":[["d1e99843.f2d56"]]},{"id":"9dcc66f3.4ac218","type":"ui_ui_control","z":"2d8e58d.7555ca8","name":"Initialize UI element","events":"connect","x":130,"y":380,"wires":[["6d9279e3.4e789"]]},{"id":"8341a50.1382058","type":"ui_ui_control","z":"364af11b.32788e","name":"Initialize UI element","events":"connect","x":130,"y":40,"wires":[["7dac4729.853eb"]]},{"id":"fae983fd.dfdc28","type":"delay","z":"1e878673.29136a","name":"1 sec","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":290,"y":880,"wires":[["bc1c0af.df72bf8"]]},{"id":"d5eaa004.acc588","type":"delay","z":"1e878673.29136a","name":"1 sec","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":290,"y":980,"wires":[["a72bad9f.2b8f58"]]},{"id":"2ccab8b4.b9fc8","type":"delay","z":"1e878673.29136a","name":"1 sec","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":290,"y":1080,"wires":[["c11d5a46.884ae8"]]},{"id":"1d6efd72.32940b","type":"delay","z":"cdc1c9a3.021f58","name":"1 sec","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":350,"y":1160,"wires":[["6d5d45c8.ade6ec"]]},{"id":"a8a1ab35.09f4b","type":"delay","z":"cdc1c9a3.021f58","name":"1 sec","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":350,"y":1260,"wires":[["97c18bd5.c5eb58"]]},{"id":"2999ac68.84d814","type":"delay","z":"cdc1c9a3.021f58","name":"1 sec","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":350,"y":1360,"wires":[["6a1e701c.88014"]]},{"id":"dcebc6b2.bb8dd8","type":"delay","z":"cdc1c9a3.021f58","name":"1 sec","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":350,"y":1460,"wires":[["15d16967.4afe17"]]},{"id":"c1afd32b.04eb4","type":"delay","z":"cdc1c9a3.021f58","name":"1 sec","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":350,"y":660,"wires":[["2d4a6684.c51be2"]]},{"id":"2488380a.ad5d4","type":"delay","z":"cdc1c9a3.021f58","name":"1 sec","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":350,"y":760,"wires":[["221f49aa.464856"]]},{"id":"f5ff531f.119248","type":"delay","z":"cdc1c9a3.021f58","name":"1 sec","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":350,"y":860,"wires":[["f1b523f2.089028"]]},{"id":"b2606f68.5ad9d","type":"delay","z":"cdc1c9a3.021f58","name":"1 sec","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":350,"y":960,"wires":[["45f99cbb.a41e74"]]},{"id":"22058548.f4e3ba","type":"delay","z":"cdc1c9a3.021f58","name":"1 sec","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":350,"y":1060,"wires":[["f882b282.0249e"]]},{"id":"4e5748ca.52ddd","type":"ui_ui_control","z":"cdc1c9a3.021f58","name":"Initialize UI element","events":"connect","x":150,"y":280,"wires":[["eed979c7.694d28"]]},{"id":"52bc879e.272fe8","type":"change","z":"cdc1c9a3.021f58","name":"inner_output","rules":[{"t":"set","p":"payload","pt":"msg","to":"inner_output","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":280,"wires":[["6d289a6.79280e4"]]},{"id":"eed979c7.694d28","type":"delay","z":"cdc1c9a3.021f58","name":"1 sec","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":330,"y":280,"wires":[["52bc879e.272fe8"]]},{"id":"d712ce59.19ef1","type":"link in","z":"44130c7e.f0c1fc","name":"RIMS element display 2","links":["42931abc.fbf8b4"],"x":175,"y":140,"wires":[["4530fdb0.e1c884"]]},{"id":"e5862b2d.b56798","type":"link in","z":"44130c7e.f0c1fc","name":"BK Element display 2","links":["fef8865a.aead48"],"x":175,"y":300,"wires":[["909fce1e.6368d"]]},{"id":"6d289a6.79280e4","type":"link out","z":"cdc1c9a3.021f58","name":"RIMS element display","links":["3bcfd4dd.7dc404"],"x":695,"y":280,"wires":[]},{"id":"2c71cccc.e7b0cc","type":"ui_ui_control","z":"1e878673.29136a","name":"Initialize UI element","events":"connect","x":130,"y":700,"wires":[["3e0b8f83.5f76a8"]]},{"id":"85b02d97.eace28","type":"change","z":"1e878673.29136a","name":"output","rules":[{"t":"set","p":"payload","pt":"msg","to":"output","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":700,"wires":[["4262b3a2.405a6c"]]},{"id":"4262b3a2.405a6c","type":"link out","z":"1e878673.29136a","name":"","links":["4fe29801.47882"],"x":735,"y":700,"wires":[]},{"id":"d7f4e02f.a6d098","type":"link in","z":"1e878673.29136a","name":"UI initialization","links":["badc88d8.0fe308"],"x":195,"y":740,"wires":[["3e0b8f83.5f76a8"]]},{"id":"3e0b8f83.5f76a8","type":"delay","z":"1e878673.29136a","name":"1 sec","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":330,"y":700,"wires":[["85b02d97.eace28"]]},{"id":"1ec9332.c622acd","type":"link in","z":"1e878673.29136a","name":"UI initialization","links":["badc88d8.0fe308"],"x":195,"y":640,"wires":[["d1e99843.f2d56"]]},{"id":"b357b24f.255c68","type":"link in","z":"1e878673.29136a","name":"UI initialization","links":["badc88d8.0fe308"],"x":195,"y":420,"wires":[["ff95d83b.e42d4"]]},{"id":"47363a29.23e8a4","type":"link in","z":"cdc1c9a3.021f58","name":"Initialize UI Elements","links":["83772e32.d03bd"],"x":215,"y":320,"wires":[["eed979c7.694d28"]]},{"id":"d51ff474.a48fe","type":"link in","z":"cdc1c9a3.021f58","name":"Initialize UI Elements","links":["83772e32.d03bd"],"x":215,"y":420,"wires":[["b4b53e68.439df"]]},{"id":"c2d072e8.a98228","type":"ui_ui_control","z":"cae39ee2.e2c898","name":"Temp display initialization","events":"connect","x":190,"y":60,"wires":[["37d5288e.c8204"]]},{"id":"37d5288e.c8204","type":"delay","z":"cae39ee2.e2c898","name":"1 sec","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":390,"y":60,"wires":[["42d70696.2b0e2"]]},{"id":"42d70696.2b0e2","type":"link out","z":"cae39ee2.e2c898","name":"Temp display initialization","links":["aa5c55e8.9a646","e27ebf90.5f19c8","55fa8f5f.805008"],"x":525,"y":60,"wires":[]},{"id":"aa5c55e8.9a646","type":"link in","z":"cae39ee2.e2c898","name":"Temp display initialization","links":["42d70696.2b0e2"],"x":575,"y":160,"wires":[["530fd866.744e8"]]},{"id":"e27ebf90.5f19c8","type":"link in","z":"cae39ee2.e2c898","name":"Temp display initialization","links":["42d70696.2b0e2"],"x":575,"y":440,"wires":[["7a411f3b.00a518"]]},{"id":"55fa8f5f.805008","type":"link in","z":"cae39ee2.e2c898","name":"Temp display initialization","links":["42d70696.2b0e2"],"x":575,"y":720,"wires":[["4b08cd7c.d9f164"]]},{"id":"f3c1dcd7.a969d","type":"change","z":"4ef08725.8fbdd","name":"delete socketid","rules":[{"t":"delete","p":"socketid","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":440,"wires":[["6d61f157.2b412"]]},{"id":"25d8fdfc.fc41fa","type":"delay","z":"cae39ee2.e2c898","name":"1 sec","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":350,"y":960,"wires":[["53bccee6.71df08"]]},{"id":"53bccee6.71df08","type":"link out","z":"cae39ee2.e2c898","name":"Cascade PID trigger","links":["dc955b1c.7edea"],"x":455,"y":960,"wires":[]},{"id":"19de2e51.99dcba","type":"switch","z":"e2318.a76b94e88","name":"derivative is a number","property":"derivative","propertyType":"msg","rules":[{"t":"istype","v":"number","vt":"number"}],"checkall":"true","repair":false,"outputs":1,"x":740,"y":920,"wires":[["1b34c54e.9109cb"]]},{"id":"a2246972.90d548","type":"switch","z":"e2318.a76b94e88","name":"outer_derivative is a number","property":"outer_derivative","propertyType":"msg","rules":[{"t":"istype","v":"number","vt":"number"}],"checkall":"true","repair":false,"outputs":1,"x":740,"y":1040,"wires":[["ae84c0f1.2800e8"]]}]